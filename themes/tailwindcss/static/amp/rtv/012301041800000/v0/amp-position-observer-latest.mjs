;
(self.AMP=self.AMP||[]).push({m:1,v:"2301041800000",n:"amp-position-observer",ev:"0.1",l:!0,f:function(t,i){(()=>{function i(t,i){const s=[];let n=0;for(let h=0;h<t.length;h++){const e=t[h];i(e,h,t)?s.push(e):(n<h&&(t[n]=e),n++)}return n<t.length&&(t.length=n),s}var{hasOwnProperty:s,toString:n}=Object.prototype;function h(t){return 1==(null==(i=t)?void 0:i.nodeType)?(t=t).tagName.toLowerCase()+(t.id?`#${t.id}`:""):t;var i}function e(t,s,n,e,r,o,l,u,c,a,f){return function(t,s,n="Assertion failed",e){var r,o;if(s)return s;t&&-1==n.indexOf(t)&&(n+=t);let l=3;const u=n.split("%s");let c=u.shift();const a=[c];for(;u.length;){const t=arguments[l++],i=u.shift();c+=h(t)+i,a.push(t,i.trim())}const f=new Error(c);throw f.messageArray=i(a,(t=>""!==t)),null===(r=(o=self).__AMP_REPORT_ERROR)||void 0===r||r.call(o,f),f}("​​​",t,s,n,e,r,o,l,u,c,a,f)}function r(t){return e(/^\d+(\.\d+)?(px|em|rem|vh|vw|vmin|vmax|cm|mm|q|in|pc|pt)$/.test(null!=t?t:""),"Invalid length value: %s",t),t}var o="inside",l="bottom";function u(t,i,s,n){return{left:t,top:i,width:s,height:n,bottom:i+n,right:t+s,x:t,y:i}}function c(t,i){return t.top<i.top?"top":t.bottom>i.bottom?l:o}function a(t,i){return!(!t||!i)&&t.left==i.left&&t.top==i.top&&t.width==i.width&&t.height==i.height}self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var f=self.__AMP_LOG;function _(t,i){throw new Error("failed to call initLogConstructor")}function v(t){return f.user||(f.user=P()),function(t,i){return i&&i.ownerDocument.defaultView!=t}(f.user.win,t)?f.userForEmbed||(f.userForEmbed=P()):f.user}function P(t){return _()}function A(t,i,s,n,h,e,r,o,l,u,c){return t}function d(t,i,s,n,h,e,r,o,l,u,c){return v().assert(t,i,s,n,h,e,r,o,l,u,c)}function p(t,i){return M(t=function(t){return t.__AMP_TOP||(t.__AMP_TOP=t)}(t),i)}function m(t,i){return M(E(R(t)),i)}function R(t){return t.nodeType?(s=t,i=(s.ownerDocument||s).defaultView,p(i,"ampdoc")).getAmpDoc(t):t;var i,s}function E(t){const i=R(t);return i.isSingleDoc()?i.win:i}function M(t,i){A(I(t,i));const s=b(t)[i];return s.obj||(A(s.ctor),A(s.context),s.obj=new s.ctor(s.context),A(s.obj),s.context=null,s.resolve&&s.resolve(s.obj)),s.obj}function b(t){let i=t.__AMP_SERVICES;return i||(i=t.__AMP_SERVICES={}),i}function I(t,i){const s=t.__AMP_SERVICES&&t.__AMP_SERVICES[i];return!(!s||!s.ctor)}var V=t=>m(t,"viewport");function T(t){!function(t,i,s,n){const h=R(t),e=E(h);!function(t,i,s,n,h,e){const r=b(t);let o=r[s];o||(o=r[s]={obj:null,promise:null,resolve:null,reject:null,context:null,ctor:null,sharedInstance:!1}),o.ctor||(o.ctor=n,o.context=i,o.sharedInstance=!1,o.resolve&&M(t,s))}(e,h,i,class{constructor(t){this.ji=t,this.i=t.win,this.tO=[],this.Xh=p(this.i,"vsync"),this.Tc=V(t),this.O_=[],this.iO=!1,this.sO=!1,this.nO=!1,this.hO=function(t,i,s){let n=0,h=0,e=null;function r(){n=0;const o=s-(t.Date.now()-h);var l;o>0?n=t.setTimeout(r,o):(l=e,e=null,i.apply(null,l))}return function(...i){h=t.Date.now(),e=i,n||(n=t.setTimeout(r,s))}}(this.i,(()=>{this.iO=!1}),500)}observe(t,i,s){const n=new class{constructor(t,i,s,n){this.element=i,this.Xe=n,this.fidelity=s,this.turn=0==s?Math.floor(4*Math.random()):0,this.eO=null,this.Tc=V(t)}Ye(t){const i=this.eO;if(i&&a(i.positionRect,t.positionRect)&&a(i.viewportRect,t.viewportRect))return;A(t.positionRect);const s=t.positionRect;var n,h;t.relativePos=c(s,t.viewportRect),n=s,h=t.viewportRect,n.top<=h.bottom&&h.top<=n.bottom&&n.left<=h.right&&h.left<=n.right?(this.eO=t,this.Xe(t)):this.eO&&(this.eO=null,t.positionRect=null,this.Xe(t))}update(t){if(!t){if(0!=this.turn)return void this.turn--;0==this.fidelity&&(this.turn=4)}const i=this.Tc.getSize(),s=u(0,0,i.width,i.height);this.Tc.getClientRectAsync(this.element).then((t=>{this.Ye({positionRect:t,viewportRect:s,relativePos:null})}))}}(this.ji,t,i,s);return this.tO.push(n),this.nO||this.rO(),n.update(),()=>{for(let t=0;t<this.tO.length;t++)if(this.tO[t]==n)return void this.oO(t)}}unobserve(t){for(let i=0;i<this.tO.length;i++)if(this.tO[i].element==t)return void this.oO(i);(f.dev||(f.dev=_())).error("POSITION_OBSERVER","cannot unobserve unobserved element")}oO(t){this.tO.splice(t,1),0==this.tO.length&&this.lO()}rO(){this.nO=!0,this.O_.push(this.Tc.onScroll((()=>{this.uO()}))),this.O_.push(this.Tc.onResize((()=>{this.cO()})))}lO(){for(this.nO=!1;this.O_.length;)this.O_.pop()()}updateAllEntries(t){for(let i=0;i<this.tO.length;i++)this.tO[i].update(t)}uO(){this.hO(),this.iO=!0,this.sO||this.aO()}cO(){this.updateAllEntries(!0)}aO(){this.updateAllEntries(),this.sO=!0,this.iO?this.Xh.measure((()=>{this.aO()})):this.sO=!1}})}(t,"position-observer")}function g(t,i,s,n){const h={detail:s};return Object.assign(h,n),new t.CustomEvent(i,h)}var w="amp-position-observer",x=class extends t.BaseElement{constructor(t){super(t),this.Da=null,this.In=null,this.Tc=null,this.ps=!1,this.fO=0,this._O=0,this.vO="0",this.PO="0",this.AO=0,this.dO=0,this.Nn=null,this.pO=null,this.mO=null,this.RO=0,this.EO=0,this.MO=!1,this.bO=!1}buildCallback(){this.getAmpDoc().whenFirstVisible().then(this.tc.bind(this)),this.MO=this.element.hasAttribute("once")}tc(){this.Ib(),this.Da=function(t,i){const s=E(R(t));return I(s,i)?M(s,i):null}(this.element,"action"),this.Tc=V(this.element),this.IO(),this.getAmpDoc().whenReady().then((()=>{const t=this.VO();this.In.observe(t,1,this.TO.bind(this))}))}gO(){const t=g(this.win,`${w}.enter`,{});this.Da.trigger(this.element,"enter",t,1)}wO(){const t=g(this.win,`${w}.exit`,{});this.Da.trigger(this.element,"exit",t,1)}xO(){const t=this.Tc.getScrollTop(),i={"start-scroll-offset":t,"end-scroll-offset":t+this.EO,"initial-inview-percent":this.RO},s=g(this.win,`${w}.scroll`,{"percent":this.RO,"positionObserverData":i});this.Da.trigger(this.element,"scroll",s,1)}TO(t){if(this.MO&&this.bO)return;const i=this.ps,s=this.Nn&&this.Nn.height;this.yO(t),this.Nn=t.viewportRect,s!=t.viewportRect.height&&this.OO();const n=this.SO(t.viewportRect),{positionRect:h}=t;let e;h?(e=c(h,n),this.Bo(h,n,e)):(this.ps=!1,e=t.relativePos),i&&!this.ps&&(this.RO=e==l?0:1,this.xO(),this.wO(),this.bO=!0),!i&&this.ps&&this.gO(),this.ps&&(this.$O(h,n),this.xO())}Bo(t,i,s){if(s==o)return void(this.ps=!0);const n="top"==s?this.fO:this._O,h=t.height*n;this.ps=s==l?t.top<=i.bottom-h:t.bottom>=i.top+h}$O(t,i){if(!t)return;const s=t.height*this._O+t.height*this.fO,n=i.height+t.height-s,h=Math.abs(t.top-this.AO-(i.height-t.height*this._O));this.RO=h/n,this.EO=n-h}Ib(){const t=this.element.getAttribute("intersection-ratios");if(t){const i=t.trim().split(" ");this.fO=this.FO(i[0]),this._O=this.fO,i[1]&&(this._O=this.FO(i[1]))}const i=this.element.getAttribute("viewport-margins");if(i){const t=i.trim().split(" ");this.vO=t[0],this.PO=this.vO,t[1]&&(this.PO=t[1])}this.pO=this.element.getAttribute("target")}VO(){let t;return t=this.pO?v().assertElement(this.win.document.getElementById(this.pO),"No element found with id:"+this.pO):this.element.parentNode,this.win.document.body===t&&(t=this.win.document.documentElement),t}jO(t){var i;const s=function(t){r(t);const i=/[a-z]+/i.exec(null!=t?t:"");return e(i,"Failed to read units from %s",t),i[0]}(t=r("number"==typeof(i=t)?i+"px":i&&/^\d+(\.\d+)?(px|em|rem|vh|vw|vmin|vmax|cm|mm|q|in|pc|pt)?$/.test(i)?/^\d+(\.\d+)?$/.test(i)?i+"px":i:void 0));let n=function(t){const i=parseFloat(t);return"number"==typeof(s=i)&&isFinite(s)?i:void 0;var s}(t);return n?(d("px"==s||"vh"==s,"Only pixel or vh are valid as units for exclusion margins: "+t),"vh"==s&&(n=n/100*this.Nn.height),n):0}FO(t){const i=parseFloat(t);return d(i>=0&&i<=1,"Ratios must be a decimal between 0 and 1: "+t),i}OO(){A(this.Nn),A(this.PO),A(this.vO),this.AO=this.jO(this.vO),this.dO=this.jO(this.PO)}SO(t){return A(t),u(t.left,t.top+this.AO,t.width,t.height-this.dO-this.AO)}yO(t){this.mO||(this.mO=t.viewportRect.height);const i=this.mO-t.viewportRect.height;let s=0;Math.abs(i)<150?s=i:this.mO=null,t.viewportRect=u(t.viewportRect.left,t.viewportRect.top,t.viewportRect.width,t.viewportRect.height+s)}IO(){this.In||(T(this.getAmpDoc()),this.In=m(this.element,"position-observer"))}CO(){if(this.In){const t=this.VO();this.In.unobserve(t),this.In=null}}};t.registerElement(w,x)})();
/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */}});
//# sourceMappingURL=amp-position-observer-0.1.mjs.map