;
(self.AMP=self.AMP||[]).push({m:1,v:"2301041800000",n:"amp-viewer-integration",ev:"0.1",l:!0,p:"high",f:function(t,s){(()=>{var s;function e(){return s||(s=Promise.resolve(void 0))}function n(t,s){const e=t.length-s.length;return e>=0&&t.indexOf(s,e)==e}var{hasOwnProperty:i,toString:r}=Object.prototype;function o(t){const s=Object.create(null);return t&&Object.assign(s,t),s}function h(t,s,e,n,i,r,o,h,c,u,l){return t}var c=/(?:^[#?]?|&)([^=&]+)(?:=([^&]*))?/g;function u(t,s=""){try{return decodeURIComponent(t)}catch(t){return s}}function l(t){const s=Object.getOwnPropertyDescriptor(t,"message");if(null!=s&&s.writable)return t;const{message:e,stack:n}=t,i=new Error(e);for(const s in t)i[s]=t[s];return i.stack=n,i}function a(t){let s=null,e="";for(const t of arguments)t instanceof Error&&!s?s=l(t):(e&&(e+=" "),e+=t);return s?e&&(s.message=e+": "+s.message):s=new Error(e),s}function f(t,...s){const e=a.apply(null,s);e.name=t||e.name,function(t){var s,e;null===(s=(e=self).__AMP_REPORT_ERROR)||void 0===s||s.call(e,t)}(e)}self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var d=self.__AMP_LOG;function _(t,s){throw new Error("failed to call initLogConstructor")}function p(t){return d.user||(d.user=P()),function(t,s){return s&&s.ownerDocument.defaultView!=t}(d.user.win,t)?d.userForEmbed||(d.userForEmbed=P()):d.user}function P(t){return _()}function A(){return d.dev||(d.dev=_())}function m(t,s,e,n,i,r,o,h,c,u,l){return t}function E(t,s,e,n,i,r,o,h,c,u,l){return p().assert(t,s,e,n,i,r,o,h,c,u,l)}function g(t,s){return M(t=function(t){return t.__AMP_TOP||(t.__AMP_TOP=t)}(t),s)}function T(t,s){return M(w(v(t)),s)}function v(t){return t.nodeType?(e=t,s=(e.ownerDocument||e).defaultView,g(s,"ampdoc")).getAmpDoc(t):t;var s,e}function w(t){const s=v(t);return s.isSingleDoc()?s.win:s}function M(t,s){m(I(t,s));const e=function(t){let s=t.__AMP_SERVICES;return s||(s=t.__AMP_SERVICES={}),s}(t)[s];return e.obj||(m(e.ctor),m(e.context),e.obj=new e.ctor(e.context),m(e.obj),e.context=null,e.resolve&&e.resolve(e.obj)),e.obj}function I(t,s){const e=t.__AMP_SERVICES&&t.__AMP_SERVICES[s];return!(!e||!e.ctor)}var y,R=t=>g(t,"platform"),V=t=>T(t,"viewer"),b=t=>T(t,"viewport"),x=["Webkit","webkit","Moz","moz","ms","O","o"],k={"getPropertyPriority":()=>"","getPropertyValue":()=>""};function S(t){const s=t.replace(/[A-Z]/g,(t=>"-"+t.toLowerCase()));return x.some((t=>s.startsWith(t+"-")))?`-${s}`:s}function F(t,s,e){if(z(s))return s;y||(y=o());let n=y[s];if(!n||e){if(n=s,void 0===t[s]){const e=function(t){return t.charAt(0).toUpperCase()+t.slice(1)}(s),i=function(t,s){for(let e=0;e<x.length;e++){const n=x[e]+s;if(void 0!==t[n])return n}return""}(t,e);void 0!==t[i]&&(n=i)}e||(y[s]=n)}return n}function N(t,s){const{style:e}=t;for(const t in s)e.setProperty(S(F(e,t)),String(s[t]),"important")}function H(t,s,e,n,i){const r=F(t.style,s,i);if(!r)return;const o=n?e+n:e;t.style.setProperty(S(r),o)}function O(t,s,e){const n=F(t.style,s,e);if(n)return z(n)?t.style.getPropertyValue(n):t.style[n]}function C(t,s){for(const e in s)H(t,e,s[e])}function L(t,s){const{style:e}=t;h(""!==s&&"none"!==s),h(!e.display),e.display=s}function U(t,s){return t.getComputedStyle(s)||k}function D(t,s){for(let e=0;e<s.length;e++)H(t,s[e],null)}function z(t){return t.startsWith("--")}var Y=class{static solveYValueFromXValue(t,s,e,n,i,r,o,h,c){return Y.Kh(Y.Yh(t,s,n,r,h),e,i,o,c)}static Yh(t,s,e,n,i){const r=1e-6;let o=(t-s)/(i-s);if(o<=0)return 0;if(o>=1)return 1;let h=0,c=1,u=0;for(let l=0;l<8;l++){u=Y.Jh(o,s,e,n,i);const l=(Y.Jh(o+r,s,e,n,i)-u)/r;if(Math.abs(u-t)<r)return o;if(Math.abs(l)<r)break;u<t?h=o:c=o,o-=(u-t)/l}for(let l=0;Math.abs(u-t)>r&&l<8;l++)u<t?(h=o,o=(o+c)/2):(c=o,o=(o+h)/2),u=Y.Jh(o,s,e,n,i);return o}static Jh(t,s,e,n,i){if(0==t)return s;if(1==t)return i;let r=Y.Qh(s,e,t),o=Y.Qh(e,n,t);const h=Y.Qh(n,i,t);return r=Y.Qh(r,o,t),o=Y.Qh(o,h,t),Y.Qh(r,o,t)}static Kh(t,s,e,n,i){if(0==t)return s;if(1==t)return i;let r=Y.Qh(s,e,t),o=Y.Qh(e,n,t);const h=Y.Qh(n,i,t);return r=Y.Qh(r,o,t),o=Y.Qh(o,h,t),Y.Qh(r,o,t)}static Qh(t,s,e){return t+e*(s-t)}},q={LINEAR:t=>t,EASE:t=>Y.solveYValueFromXValue(t,0,0,.25,.1,.25,1,1,1),EASE_IN:t=>Y.solveYValueFromXValue(t,0,0,.42,0,1,1,1,1),EASE_OUT:t=>Y.solveYValueFromXValue(t,0,0,0,0,.58,1,1,1),EASE_IN_OUT:t=>Y.solveYValueFromXValue(t,0,0,.42,0,.58,1,1,1)},X={"linear":q.LINEAR,"ease":q.EASE,"ease-in":q.EASE_IN,"ease-out":q.EASE_OUT,"ease-in-out":q.EASE_IN_OUT};function K(t){if(!t)return null;if("string"==typeof t){if(-1!=(t=t).indexOf("cubic-bezier")){const r=t.match(/cubic-bezier\((.+)\)/);if(r){const t=r[1].split(",").map(parseFloat);if(4==t.length){for(let s=0;s<4;s++)if(isNaN(t[s]))return null;return s=t[0],e=t[1],n=t[2],i=t[3],t=>Y.solveYValueFromXValue(t,0,0,s,e,n,i,1,1)}}return null}return X[t]}var s,e,n,i;return t}var $,j="Animation",W=function(){},J=class{static animate(t,s,e,n){return new J(t).setCurve(n).add(0,s,1).start(e)}constructor(t,s){this.kt=t,this.Xh=s||g(self,"vsync"),this.Zh=null,this.io=[]}setCurve(t){return t&&(this.Zh=K(t)),this}add(t,s,e,n){return this.io.push({delay:t,func:s,duration:e,curve:K(n)}),this}start(t){return new B(this.Xh,this.kt,this.io,this.Zh,t)}},B=class{constructor(t,s,e,n,i){this.Xh=t,this.kt=s,this.io=[];for(let t=0;t<e.length;t++){const s=e[t];this.io.push({delay:s.delay,func:s.func,duration:s.duration,curve:s.curve||n,started:!1,completed:!1})}this.so=i,this.Ch=Date.now(),this.Ht=!0,this.Ri={};const r=new class{constructor(){this.promise=new Promise(((t,s)=>{this.resolve=t,this.reject=s}))}};this.eo=r.promise,this.Sn=r.resolve,this.no=r.reject,this.ro=this.Xh.createAnimTask(this.kt,{mutate:this.ho.bind(this)}),this.Xh.canAnimate(this.kt)?this.ro(this.Ri):this.oo(!1,0)}then(t,s){return t||s?this.eo.then(t,s):this.eo}thenAlways(t){const s=t||W;return this.then(s,s)}halt(t){this.oo(!1,t||0)}oo(t,s){if(this.Ht){if(this.Ht=!1,0!=s){this.io.length>1&&this.io.sort(((t,s)=>t.delay+t.duration-(s.delay+s.duration)));try{if(s>0)for(let t=0;t<this.io.length;t++)this.io[t].func(1,!0);else for(let t=this.io.length-1;t>=0;t--)this.io[t].func(0,!1)}catch(s){A().error(j,"completion failed: "+s,s),t=!1}}t?this.Sn():this.no()}}ho(t){if(!this.Ht)return;const s=Date.now(),e=Math.min((s-this.Ch)/this.so,1);for(let t=0;t<this.io.length;t++){const s=this.io[t];!s.started&&e>=s.delay&&(s.started=!0)}for(let t=0;t<this.io.length;t++){const s=this.io[t];s.started&&!s.completed&&this.uo(s,e)}1==e?this.oo(!0,0):this.Xh.canAnimate(this.kt)?this.ro(this.Ri):this.oo(!1,0)}uo(t,s){let e,n;if(t.duration>0){if(e=Math.min((s-t.delay)/t.duration,1),n=e,t.curve&&1!=n)try{n=t.curve(e)}catch(t){return A().error(j,"step curve failed: "+t,t),void this.oo(!1,0)}}else e=1,n=1;1==e&&(t.completed=!0);try{t.func(n,t.completed)}catch(t){return A().error(j,"step mutate failed: "+t,t),void this.oo(!1,0)}}},G="FixedLayer",Z="i-amphtml-lightbox",Q="i-amphtml-lightbox-element";function tt(t){return-1!==t.tagName.indexOf("LIGHTBOX")}function st(t,s,e,n){let i=t,r=e,o=t=>{try{return r(t)}catch(t){var s,e;throw null===(s=(e=self).__AMP_REPORT_ERROR)||void 0===s||s.call(e,t),t}};const h=function(){if(void 0!==$)return $;$=!1;try{const t={get capture(){return $=!0,!1}};self.addEventListener("test-options",null,t),self.removeEventListener("test-options",null,t)}catch(t){}return $}(),c=!(null==n||!n.capture);return i.addEventListener(s,o,h?n:c),()=>{null==i||i.removeEventListener(s,o,h?n:c),r=null,i=null,o=null}}function et(t,s,e,n){return st(t,s,e,n)}function nt(t,s,e,n){let i=e;const r=st(t,s,(t=>{try{i(t)}finally{i=null,r()}}),n);return r}function it(t){return"loading"!=t.readyState&&"uninitialized"!=t.readyState}function rt(t,s,e){return 0==s&&0==e||0==t.width&&0==t.height?t:{left:n=t.left+s,top:i=t.top+e,width:r=t.width,height:o=t.height,bottom:i+o,right:n+r,x:n,y:i};var n,i,r,o}function ot(t){return t.node.wholeText[t.offset]}var ht=/[,.\s\u2022()]/;function ct(t){return"’"==t||"‘"==t?"'":"“"==t||"”"==t?'"':t.toLowerCase()}function ut(t){const s=[];for(let e=0;e<t.length;e++){const n=t[e];ht.test(n)||s.push(ct(n))}return s.join("")}var lt=class{constructor(t,s){this.PS=t,this.IS=s,this.matches=[],this.VS={},this.NS=t.length-1;for(let s=0;s<t.length;s++){const e=t[s];this.VS[e]=t.length-1-s}}update(){if(this.NS>0)return void this.NS--;const{IS:t,PS:s}=this,e=t.size();for(let n=0;n<s.length;n++){const i=ct(ot(t.get(e-1-n).pos));if(s[s.length-1-n]==i)continue;let r=this.VS[i];return null==r&&(r=s.length),r-=n,r<1&&(r=1),void(this.NS=r-1)}const n=t.get(e-1),i=n.pos;this.matches.push({start:t.get(e-s.length),end:{pos:{node:i.node,offset:i.offset+1},idx:n.idx+1}})}};function at(t,s,e,n){for(let i=e;i<n.length;i++){const e=n[i];if(t.node!=e.start.node)return;if(e.start.node=s,e.start.offset-=t.offset,t.node!=e.end.node)return;e.end.node=s,e.end.offset-=t.offset}}function ft(t,s,e,n,i,r){for(;;){if(s.node==e.node){const o=dt(t,s.node,s.offset,e.offset,r);return void(o&&at(e,o,i+1,n))}const o=_t(t,s.node);if(dt(t,s.node,s.offset,s.node.wholeText.length,r),!o)break;s={node:o,offset:0}}}function dt(t,s,e,n,i){if(e>=n)return null;const r=t.document,{parentNode:o,wholeText:h}=s;e>0&&o.insertBefore(r.createTextNode(h.substring(0,e)),s);const c=r.createElement("span");c.appendChild(r.createTextNode(h.substring(e,n))),o.insertBefore(c,s),i.push(c);let u=null;return n<h.length&&(u=r.createTextNode(h.substring(n)),o.insertBefore(u,s)),o.removeChild(s),u}function _t(t,s){let e=!0,n=s;for(;;){if(null==n)return null;if(e){const t=n.nextSibling;t?(n=t,e=!1):n=n.parentNode}else{if(n instanceof t.Text)return n;n.firstChild?n=n.firstChild:e=!0}}}var pt=class{constructor(t,s){if(this.i=t,this.HS=s,this.CS=-1,this.LS=null,s instanceof t.Text)this.CS=0;else if(s instanceof t.Element){const{display:e}=U(t,s);if("none"==e)return;const n=s.firstChild;null!=n&&(this.LS=new pt(t,n))}}next(){if(this.CS>=0)return this.US();for(;null!=this.LS;){const t=this.LS.next();if(null!=t)return t;const s=this.LS.HS.nextSibling;this.LS=null!=s?new pt(this.i,s):null}return null}US(){const t=this.HS.wholeText;if(this.CS<t.length){const t=this.CS;return this.CS++,{node:this.HS,offset:t}}return null}},Pt=["key","code","location","ctrlKey","shiftKey","altKey","metaKey","repeat","isComposing","charCode","keyCode","which"],At="amp-viewer-messaging",mt="channelOpen",Et="__AMPHTML__";function gt(t){if("string"!=typeof t)return t;if("{"!=t.charAt(0))return null;try{return JSON.parse(t)}catch(t){return null}}var Tt,vt=class{constructor(t,s,e){this.i=t,this.h=s,this.o=e}addEventListener(t,s){this.i.addEventListener("message",(t=>{t.origin==this.h&&t.source==this.o&&s(t)}))}postMessage(t){const s="null"===this.h?"*":this.h;this.o.postMessage(t,s)}start(){}},wt=class{static initiateHandshakeWithDocument(t,s){return new Promise((e=>{const n=setInterval((()=>{const i=new MessageChannel,r={app:Et,name:"handshake-poll"};t.postMessage(r,"*",[i.port2]);const o=i.port1,h=t=>{const i=gt(t.data);if(i&&i.app===Et&&i.name===mt){clearInterval(n),o.removeEventListener("message",h);const t=new wt(null,o,!1,s,!0);t.t(i.requestid,mt,null),e(t)}};o.addEventListener("message",h),o.start()}),1e3)}))}static waitForHandshakeFromDocument(t,s,e,n,i){return new Promise((r=>{const o=h=>{const c=gt(h.data);if(c&&(h.origin==e||i&&i.test(h.origin))&&(!h.source||h.source==s)&&c.app===Et&&c.name===mt){t.removeEventListener("message",o);const e=new vt(t,h.origin,s),i=new wt(null,e,!1,n,!0);i.t(c.requestid,mt,null),r(i)}};t.addEventListener("message",o)}))}constructor(t,s,e,n,i){this.i=t,this.l=s,this.u=!!e,this._=n||null,this.p=!!i,this.g=0,this.m={},this.P={},this.A=null,this.l.addEventListener("message",this.R.bind(this)),this.l.start()}registerHandler(t,s){this.P[t]=s}unregisterHandler(t){delete this.P[t]}setDefaultHandler(t){this.A=t}R(t){const s=gt(t.data);s&&s.app===Et&&(this._&&this.p&&s.messagingToken!==this._?this.M(At+": handleMessage_ error: ","invalid token"):"q"===s.type?this.q(s):"s"===s.type&&this.v(s))}sendRequest(t,s,e){const n=++this.g;let i;return e&&(i=new Promise(((t,s)=>{this.m[n]={resolve:t,reject:s}}))),this.I({app:Et,requestid:n,type:"q",name:t,data:s,rsvp:e}),i}t(t,s,e){this.I({app:Et,requestid:t,type:"s",name:s,data:e})}T(t,s,e){const n=this.V(e);this.M(At+": sendResponseError_, message name: "+s,n),this.I({app:Et,requestid:t,type:"s",name:s,data:null,error:n})}I(t){const s=Object.assign(t,{});this._&&!this.p&&(s.messagingToken=this._),this.l.postMessage(this.u?JSON.stringify(s):s)}q(t){let s=this.P[t.name];if(s||(s=this.A),!s){const s=new Error("Cannot handle request because no default handler is set!");throw s.args=t.name,s}const e=s(t.name,t.data,!!t.rsvp);if(t.rsvp){const s=t.requestid;if(!e)throw this.T(s,t.name,new Error("no response")),new Error("expected response but none given: "+t.name);e.then((e=>{this.t(s,t.name,e)}),(e=>{this.T(s,t.name,e)}))}}v(t){const s=t.requestid,e=this.m[s];e&&(delete this.m[s],t.error?(this.M(At+": handleResponse_ error: ",t.error),e.reject(new Error(`Request ${t.name} failed: ${t.error}`))):e.resolve(t.data))}M(t,s){if(!this.i)return;let e="amp-messaging-error-logger: "+t;e+=" data: "+this.V(s),this.i.viewerState=e}V(t){return t?t.message?t.message:String(t):"unknown error"}},Mt=["altKey","charCode","ctrlKey","detail","eventPhase","key","layerX","layerY","metaKey","pageX","pageY","returnValue","shiftKey","timeStamp","type","which"],It=["clientX","clientY","force","identifier","pageX","pageY","radiusX","radiusY","screenX","screenY"],yt=(()=>self.AMP.config.urls)(),Rt=new Set(["c","v","a","ad"]),Vt=t=>"string"==typeof t?function(t,s){return Tt||(Tt=self.document.createElement("a")),function(t,s,e){return t.href="",new URL(s,t.href)}(Tt,t)}(t):t;new class{constructor(t){this.win=t,this.YS=!1,this.qS=!1,this.XS=null}init(){const t=v(this.win.document),s=V(t);this.YS="1"==s.getParam("webview"),this.qS=s.hasCapability("handshakepoll");const i=s.getParam("messagingToken"),r=s.getParam("origin")||"";if(!this.YS&&!r)return e();if(b(t).createFixedLayer(class{constructor(t,s,e,n,i){this.ampdoc=t,this.Xh=s,this.KS=e,this.mo=n,this.$S=n,this.WS=i&&t.isSingleDoc(),this.JS=null,this.BS=0,this.L=[],this.GS=new class{constructor(t,s,e){this.Qe=M(t,"timer"),this.Xe=s,this.Ze=e||0,this.pr=-1,this.mr=0,this.Ht=!1,this._r=()=>{this.Ar()}}isPending(){return-1!=this.pr}schedule(t){let s=t||this.Ze;this.Ht&&s<10&&(s=10);const e=Date.now()+s;return(!this.isPending()||e-this.mr<-10)&&(this.cancel(),this.mr=e,this.pr=this.Qe.delay(this._r,s),!0)}Ar(){this.pr=-1,this.mr=0,this.Ht=!0,this.Xe(),this.Ht=!1}cancel(){this.isPending()&&(this.Qe.cancel(this.pr),this.pr=-1)}}(t.win,(()=>this.update())),this.ZS=null,this.QS=[],this.tF=[]}enterLightbox(t,s){const e=this.sF();e&&e.setLightboxMode(!0),t&&s&&s.then((()=>this.eF(t,!0)))}leaveLightbox(){const t=this.sF();t&&t.setLightboxMode(!1);const s=function(t,s){const e=[];let n=0;for(let s=0;s<t.length;s++){const i=t[s];i.lightboxed?e.push(i):(n<s&&(t[n]=i),n++)}return n<t.length&&(t.length=n),e}(this.L);this.nF(s),this.L.length||this.iF()}setup(){if(!V(this.ampdoc).isEmbedded())return!1;const t=this.ampdoc.getRootNode(),s=t.styleSheets;if(!s)return!0;this.QS.length=0,this.tF.length=0;for(let t=0;t<s.length;t++){const e=s[t];if(!e)return A().error(G,"Aborting setup due to null stylesheet."),!0;const{disabled:n,ownerNode:i}=e;n||!i||"STYLE"!=i.tagName||i.hasAttribute("amp-boilerplate")||i.hasAttribute("amp-runtime")||i.hasAttribute("amp-extension")||this.rF(e.cssRules)}this.eF(t),this.L.length>0&&this.observeHiddenMutations();const e=R(this.ampdoc.win);return this.L.length>0&&!this.WS&&e.isIos(),!0}eF(t,s){this.oF(t,s),this.hF(),this.update()}observeHiddenMutations(){this.cF()}iF(){this.GS.cancel();const t=this.ZS;t&&(t(),this.ZS=null)}cF(){if(this.ZS)return;const t=this.ampdoc.getRootNode(),s=(t=>function(t,s){const e=w(v(t));return I(e,s)?M(e,s):null}(t,"hidden-observer"))(t.documentElement||t);this.ZS=s.add((()=>{this.GS.isPending()||this.GS.schedule(16)}))}updatePaddingTop(t,s){this.mo=t,s||(this.$S=t),this.update()}transformMutate(t){t?this.L.forEach((s=>{s.fixedNow&&s.top&&(H(s.element,"transition","none"),s.transform&&"none"!=s.transform?H(s.element,"transform",s.transform+" "+t):H(s.element,"transform",t))})):this.L.forEach((t=>{t.fixedNow&&t.top&&C(t.element,{transform:"",transition:""})}))}addElement(t,s){return this.uF(t,"*","fixed",s)?(this.hF(),this.observeHiddenMutations(),this.update()):e()}removeElement(t){const s=this.lF(t);this.nF(s)}nF(t){t.length>0&&this.JS&&this.Xh.mutate((()=>{for(let s=0;s<t.length;s++){const e=t[s];"fixed"==e.position&&this.JS.returnFrom(e)}}))}isDeclaredFixed(t){return!!t.__AMP_DECLFIXED}isDeclaredSticky(t){return!!t.__AMP_DECLSTICKY}update(){if(this.L.filter((t=>!this.ampdoc.contains(t.element))).forEach((t=>this.lF(t.element))),0==this.L.length)return e();this.GS.cancel();let t=!1;return this.Xh.runPromise({measure:s=>{const e=this.L,i=[],{win:r}=this.ampdoc;for(let t=0;t<e.length;t++)N(e[t].element,{top:"",bottom:"-9999vh",transition:"none"});for(let t=0;t<e.length;t++)i.push(U(r,e[t].element).top);for(let t=0;t<e.length;t++)H(e[t].element,"bottom","");for(let o=0;o<e.length;o++){const h=e[o],{element:c,forceTransfer:u}=h,l=U(r,c),{offsetHeight:a,offsetTop:f,offsetWidth:d}=c,{bottom:_,display:p="",position:P="",zIndex:A}=l,m=parseFloat(l.opacity),E=l[F(l,"transform")];let{top:g}=l;const T="fixed"===P&&(u||d>0&&a>0),v=n(P,"sticky");if("none"===p||!T&&!v){s[h.id]={fixed:!1,sticky:!1,transferrable:!1,top:"",zIndex:""};continue}"auto"!==g&&i[o]===g||(g=T&&f===this.$S+this.KS?"0px":"");let w=!1;T&&(w=!0===u||!1!==u&&m>0&&a<300&&!(!g&&!_)),w&&(t=!0),s[h.id]={fixed:T,sticky:v,transferrable:w,top:g,zIndex:A,transform:E}}},mutate:s=>{t&&this.WS&&this.sF().update();const e=this.L;for(let t=0;t<e.length;t++){const n=e[t],i=s[n.id];H(n.element,"transition","none"),H(n.element,"transition",""),i&&this.aF(n,t,i)}}},{}).catch((t=>{A().error(G,"Failed to mutate fixed elements:",t)}))}oF(t,s){try{this.fF(t,s)}catch(t){A().error(G,"Failed to setup fixed elements:",t)}}fF(t,s){for(let e=0;e<this.QS.length;e++){const n=this.QS[e],i=t.querySelectorAll(n);for(let t=0;t<i.length&&!(this.L.length>10);t++)this.uF(i[t],n,"fixed",void 0,s)}for(let e=0;e<this.tF.length;e++){const n=this.tF[e],i=t.querySelectorAll(n);for(let t=0;t<i.length;t++)this.uF(i[t],n,"sticky",void 0,s)}}dF(t){t.hasAttribute("style")&&(O(t,"top")||O(t,"bottom"))&&p().error(G,"Inline styles with `top`, `bottom` and other CSS rules are not supported yet for fixed or sticky elements (#14186). Unexpected behavior may occur.",t)}uF(t,s,e,n,i){if(n||this.dF(t),tt(t))return!1;const r=function(t,s,e){let n;for(n=t;n&&void 0!==n;n=n.parentElement)if(s(n))return n;return null}(t,tt);if(!i&&r)return!1;const o=this.L,h=[];for(let s=0;s<o.length;s++){const e=o[s].element;if(e===t)break;if(e.contains(t))return!1;t.contains(e)&&h.push(e)}for(let t=0;t<h.length;t++)this.removeElement(h[t]);let c=null;for(let s=0;s<o.length;s++){const n=o[s];if(n.element==t&&n.position==e){c=n;break}}const u="fixed"==e;if(c)c.selectors.includes(s)||c.selectors.push(s);else{const n="F"+this.BS++;t.setAttribute("i-amphtml-fixedid",n),u?t.__AMP_DECLFIXED=!0:t.__AMP_DECLSTICKY=!0,c={id:n,element:t,position:e,selectors:[s],fixedNow:!1,stickyNow:!1,lightboxed:!!r},o.push(c)}return c.forceTransfer=!!u&&n,!0}lF(t){const s=[];for(let e=0;e<this.L.length;e++){const n=this.L[e];n.element===t&&(n.lightboxed||this.Xh.mutate((()=>{H(t,"top","")})),this.L.splice(e,1),s.push(n))}return this.L.length||this.iF(),s}hF(){this.L.sort(((t,s)=>{return(e=t.element)===(n=s.element)?0:e.compareDocumentPosition(n)&(Node.DOCUMENT_POSITION_PRECEDING|Node.DOCUMENT_POSITION_CONTAINS)?1:-1;var e,n}))}aF(t,s,e){const{element:n,fixedNow:i}=t;t.fixedNow=e.fixed,t.stickyNow=e.sticky,t.top=e.fixed||e.sticky?e.top:"",t.transform=e.transform,!i||e.fixed&&e.transferrable||!this.JS||this.JS.returnFrom(t),e.top&&(e.fixed||e.sticky)&&!t.lightboxed&&(e.fixed||!this.WS?H(n,"top",`calc(${e.top} + ${this.mo}px)`):this.$S===this.mo?H(n,"top",e.top):H(n,"top",`calc(${e.top} - ${this.$S}px)`)),this.WS&&e.fixed&&e.transferrable&&this.sF().transferTo(t,s,e)}sF(){if(!this.WS||this.JS)return this.JS;const t=this.ampdoc.win.document;return this.JS=new class{constructor(t,s){var e;this.yf=t,this.Xh=s,this._F=t.body.cloneNode(!1),this._F.removeAttribute("style"),C(this._F,("display"in(e={position:"absolute",top:0,left:0,height:0,width:0,pointerEvents:"none",overflow:"hidden",animation:"none",background:"none",border:"none",borderImage:"none",boxSizing:"border-box",boxShadow:"none",float:"none",margin:0,opacity:1,outline:"none",padding:"none",transform:"none",transition:"none"})&&f("STYLE","`display` style detected. You must use toggle instead."),e)),L(this._F,"block"),t.documentElement.appendChild(this._F)}getRoot(){return this._F}setLightboxMode(t){this.Xh.mutate((()=>{const s=this.getRoot();t?s.setAttribute(Z,""):s.removeAttribute(Z)}))}update(){const{body:t}=this.yf,s=this._F,e=t.attributes,n=s.attributes;for(let t=0;t<e.length;t++){const s=e[t];"style"!==s.name&&n.setNamedItem(s.cloneNode(!1))}for(let e=0;e<n.length;e++){const{name:i}=n[e];"style"===i||i===Z||t.hasAttribute(i)||(s.removeAttribute(i),e--)}}transferTo(t,s,e){const{element:n}=t;if(n.parentElement!=this._F){if(!t.placeholder){H(n,"pointer-events","initial");const s=t.placeholder=this.yf.createElement("i-amphtml-fpa");!function(t,s){void 0===s&&(s=t.hasAttribute("hidden")),s?t.removeAttribute("hidden"):t.setAttribute("hidden","")}(s,!1),s.setAttribute("i-amphtml-fixedid",t.id)}H(n,"zIndex",`calc(${1e4+s} + ${e.zIndex||0})`),t.lightboxed&&n.classList.add(Q),n.parentElement.replaceChild(t.placeholder,n),this._F.appendChild(n),t.selectors.some((t=>this.pF(n,t)))||this.returnFrom(t)}}returnFrom(t){if(!t.placeholder||!this.yf.contains(t.placeholder))return;const{element:s,placeholder:e}=t;t.lightboxed&&s.classList.remove(Q),this.yf.contains(s)?(H(t.element,"zIndex",""),e.parentElement.replaceChild(s,e)):e.parentElement.removeChild(e)}pF(t,s){try{return function(t,s){return t.matches(s)}(t,s)}catch(t){return A().error(G,"Failed to test query match:",t),!1}}}(t,this.Xh),this.JS}rF(t){for(let s=0;s<t.length;s++){const e=t[s];if(4!=e.type&&12!=e.type){if(1==e.type){const{selectorText:t}=e,{position:s}=e.style;if("*"===t||!s)continue;"fixed"===s?this.QS.push(t):n(s,"sticky")&&this.tF.push(t)}}else this.rF(e.cssRules)}}animateFixedElements(t,s,n,i,r){return this.updatePaddingTop(t,r),n<=0?e():J.animate(this.ampdoc.getRootNode(),(e=>{const n=(e=>s-t+(t-s)*e)(e);this.transformMutate(`translateY(${n}px)`)}),n,i).thenAlways((()=>{this.transformMutate(null)}))}}),this.YS||this.qS){const e=(h=this.win).parent&&h.parent!=h?this.win.parent:null;return this.PF(e,r).then((e=>this.AF(s,t,r,new wt(this.win,e,this.YS,i))))}var h;const l=function(t){const s=function(t){const s=o();if(!t)return s;let e;for(;e=c.exec(t);){const t=u(e[1],e[1]),n=e[2]?u(e[2].replace(/\+/g," "),e[2]):"";s[t]=n}return s}(t.win.location.hash).highlight;if(!s||s.length>102400)return null;const e=(n=s,JSON.parse(n));var n;const i=e.s;if(!(i instanceof Array)||i.length>15)return null;let r=0;for(let t=0;t<i.length;t++){const s=i[t];if("string"!=typeof s||!s)return null;if(r+=s.length,r>1500)return null}let h=!1;e.n&&(h=!0);let l=!1;return e.na&&(l=!0),{sentences:i,skipScrollAnimation:l,skipRendering:h}}(t);l&&(this.XS=new class{constructor(t,s){this.ji=t,this.br=V(t),this.Tc=b(this.ji),this.mF=null;const e=R(this.ji.win);var n;"fragmentDirective"in document&&e.isChrome()&&e.getMajorVersion()>=93?t.whenFirstVisible().then((()=>this.EF(s))):(n=t.win.document,new Promise((t=>{!function(t,s){!function(t,s,e){let n=s(t);if(n)e(t);else{const i=()=>{s(t)&&(n||(n=!0,e(t)),t.removeEventListener("readystatechange",i))};t.addEventListener("readystatechange",i)}}(t,it,s)}(n,t)}))).then((()=>{this.gF(s)}))}EF(t){const{sentences:s}=t;if(null==s||!s.length)return;const e=s.map((t=>"text="+encodeURIComponent(t))).join("&");this.TF(e)}TF(t){const{hash:s}=this.ji.win.location;s?this.ji.win.location.replace(s+":~:"+t):this.ji.win.location.replace("#:~:"+t)}vF(t,s){const e={"state":t};for(const t in s)e[t]=s[t];this.br.sendMessage("highlightState",e)}wF(t){const{win:s}=this.ji,e=function(t,s,e){if(e=function(t){const s=[];for(let e=0;e<t.length;e++){const n=ut(t[e]);n&&s.push(n)}return s}(e),e.length<=0)return null;const n=new pt(t,s),i=new class{constructor(t){this.MF=t,this.IF=[],this.Er=0}push(t){this.IF[this.Er]=t,this.Er=(this.Er+1)%this.MF}get(t){return this.IF.length>=this.MF&&(t=(this.Er+t)%this.MF),this.IF[t]}size(){return this.IF.length}}(e.map((t=>t.length)).reduce(((t,s)=>Math.max(t,s)))),r=[new lt(e[0],i)];let o=-1;for(;;){o++;const t=n.next();if(null==t)return null;if(!ht.test(ot(t))){i.push({pos:t,idx:o});for(let t=0;t<r.length;t++)r[t].update();if(0!=r[r.length-1].matches.length){if(r.length==e.length)break;r.push(new lt(e[r.length],i))}}}const h=[];t:for(let t=e.length-1;t>=0;t--){const s=r[t].matches;if(0==h.length){h.push(s[s.length-1]);continue}const e=h[h.length-1];for(let t=s.length-1;t>=0;t--){const n=s[t];if(e.start.idx>=n.end.idx){h.push(n);continue t}}m(!1)}const c=[];for(let t=h.length-1;t>=0;t--){const s=h[t];c.push({start:s.start.pos,end:s.end.pos})}return c}(s,this.ji.getBody(),t.sentences);if(!e)return;const n=function(t,s){s=function(t){const s=[];let e=null;for(let n=0;n<t.length;n++){const i=t[n];e&&e.end.node==i.start.node&&e.end.offset==i.start.offset?e.end=i.end:(e=i,s.push(i))}return s}(s);const e=[];for(let n=0;n<s.length;n++){const i=s[n];ft(t,i.start,i.end,s,n,e)}return e}(s,e);n&&0!=n.length&&(this.mF=n)}onVisibleOnce(t){t=function(t){let s=!1,e=null,n=t;return(...t)=>(s||(e=n.apply(self,t),s=!0,n=null),e)}(t),this.ji.onVisibilityChanged((()=>{"visible"==this.ji.getVisibilityState()&&t()}))}gF(t){if(this.ji.win.document.querySelector('script[id="amp-access"]'))return void this.vF("has_amp_access");if(this.wF(t),!this.mF)return void this.vF("not_found");const s=this.yF();if(this.vF("found",{"scroll":s}),t.skipRendering)return;for(let t=0;t<this.mF.length;t++)C(this.mF[t],{backgroundColor:"#fcff00",color:"#000"});const e=this.ji.getVisibilityState();t.skipScrollAnimation?"visible"==e?this.RF(s):(this.Tc.setScrollTop(s),this.onVisibleOnce((()=>{this.RF(this.yF())}))):"visible"==e?this.VF(s):(this.bF(s),this.onVisibleOnce((()=>{this.VF(this.yF())}))),nt(this.ji.getBody(),"click",this.xF.bind(this))}yF(){const t=this.mF;if(!t)return 0;const s=this.Tc;let e=Number.MAX_VALUE,n=0;const i=s.getPaddingTop();for(let r=0;r<t.length;r++){const{bottom:o,top:h}=rt(s.getLayoutRect(t[r]),0,-i);e=Math.min(e,h),n=Math.max(n,o)}if(e>=n)return 0;let r=(n+e-(s.getHeight()-i))/2;return r>e-80&&(r=e-80),r>0?r:0}RF(t){this.vF("auto_scroll"),this.Tc.setScrollTop(t),this.vF("shown")}bF(t){const s=Math.max(0,t-500);this.Tc.setScrollTop(s)}kF(t){const s=this.yF(),e=this.Tc.getScrollTop();if(e==s&&e==t)return null;const n={};return e!=s&&(this.Tc.setScrollTop(s),n.nd=e-s),e!=t&&(n.od=e-t),n}VF(t){this.bF(t);const s=this.ji.win.document.createElement("div");L(s,"block"),C(s,{"position":"absolute","top":Math.floor(t)+"px","height":"1px","left":"0","width":"1px","pointer-events":"none"});const e=this.ji.getBody();e.appendChild(s),this.vF("auto_scroll"),this.Tc.animateScrollIntoView(s).then((()=>{e.removeChild(s),this.vF("shown",this.kF(t))}))}setupMessaging(t){t.registerHandler("highlightDismiss",this.xF.bind(this))}xF(){if(this.mF)for(let t=0;t<this.mF.length;t++)D(this.mF[t],["backgroundColor","color"])}}(t,l));const a=new vt(this.win,r,this.win.parent);return this.AF(s,t,r,new wt(this.win,a,this.YS,i))}PF(t,s){return new Promise((e=>{const n=et(this.win,"message",(i=>{const r=gt(i.data);if(r&&i.origin===s&&i.source===t&&"__AMPHTML__"==r.app&&"handshake-poll"==r.name){if(this.YS&&(!i.ports||!i.ports.length))throw new Error("Did not receive communication port from the Viewer!");const t=i.ports&&i.ports.length>0?i.ports[0]:new vt(this.win,s,this.win.parent);e(t),n()}}))}))}AF(t,s,e,n){const i=s.getUrl(),r=function(t){if(!function(t){return yt.cdnProxyRegex.test(Vt(t).origin)}(t=Vt(t)))return t.href;const s=t.pathname.split("/"),e=s[1];E(Rt.has(e),"Unknown path prefix in url %s",t.href);const n=s[2],i="s"==n?"https://"+decodeURIComponent(s[3]):"http://"+decodeURIComponent(n);return E(i.indexOf(".")>0,"Expected a . in origin %s",i),s.splice(1,"s"==n?3:2),i+s.join("/")+function(t,s){if(!t||"?"==t)return"";const e=new RegExp("[?&](amp_(js[^&=]*|gsa|r|kit)|usqp)\\b[^&]*","g"),n=t.replace(e,"").replace(/^[?&]/,"");return n?"?"+n:""}(t.search)+(t.hash||"")}(i);return n.sendRequest("channelOpen",{"url":i,"sourceUrl":r},!0).then((()=>{this.Ao(n,t,e)}))}Ao(t,s,e){t.setDefaultHandler(((t,e,n)=>s.receiveMessage(t,e,n))),s.setMessageDeliverer(t.sendRequest.bind(t),e),nt(this.win,"unload",this.SF.bind(this,t)),(s.hasCapability("swipe")||s.hasCapability("touch"))&&this.FF(t),s.hasCapability("keyboard")&&this.NF(t),s.hasCapability("focus-rect")&&this.HF(t),null!=this.XS&&this.XS.setupMessaging(t)}SF(t){return t.sendRequest("unloaded",{},!0)}HF(t){new class{constructor(t,s){this.win=t,this.S=s,this.OF()}OF(){et(this.win.document,"focusin",this.CF.bind(this),{capture:!1})}CF(t){t.defaultPrevented||this.S.sendRequest(t.type,{"focusTargetRect":t.target.getBoundingClientRect()},!1)}}(this.win,t)}FF(t){new class{constructor(t,s){this.win=t,this.S=s,this.LF=!1,this.UF=[],s.registerHandler("scrollLock",this.DF.bind(this)),this.zF()}zF(){const t=this.YF.bind(this),s=this.win.document,e={capture:!1,passive:!this.LF};this.UF.push(et(s,"touchstart",t,e),et(s,"touchend",t,e),et(s,"touchmove",t,e))}nb(){this.UF.forEach((t=>t())),this.UF.length=0}YF(t){switch(t.type){case"touchstart":case"touchend":case"touchmove":this.qF(t);break;default:return}}qF(t){if(null!=t&&t.shouldViewerCancelPropagation)t.stopImmediatePropagation();else{if(t&&t.type){const s=this.XF(t);this.S.sendRequest(t.type,s,!1)}this.LF&&t.cancelable&&t.preventDefault()}}XF(t){const s=this.KF(t,Mt);return t.touches&&(s.touches=this.$F(t.touches)),t.changedTouches&&(s.changedTouches=this.$F(t.changedTouches)),s}$F(t){const s=[];for(let e=0;e<t.length;e++)s.push(this.KF(t[e],It));return s}KF(t,s){const e={};for(let n=0;n<s.length;n++){const i=s[n];void 0!==t[i]&&(e[i]=t[i])}return e}DF(t,s,e){return this.LF=!!s,this.nb(),this.zF(),e?Promise.resolve({}):void 0}}(this.win,t)}NF(t){new class{constructor(t,s){this.win=t,this.S=s,this.jF()}jF(){const t=this.YF.bind(this);et(this.win,"keydown",t),et(this.win,"keypress",t),et(this.win,"keyup",t)}YF(t){(function(t){if(t.defaultPrevented)return!0;if("Escape"==t.key)return!1;switch(t.target.nodeName){case"INPUT":return"checkbox"!=t.target.type||" "==t.key;case"TEXTAREA":case"BUTTON":case"SELECT":case"OPTION":return!0}return t.target.hasAttribute&&t.target.hasAttribute("contenteditable")})(t)||this.CF(t)}CF(t){this.S.sendRequest(t.type,function(t){const s={};return Pt.forEach((e=>{void 0!==t[e]&&(s[e]=t[e])})),s}(t),!1)}}(this.win,t)}}(t.win).init()})();
/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */}});
//# sourceMappingURL=amp-viewer-integration-0.1.mjs.map