;
(()=>{var{hasOwnProperty:t,toString:e}=Object.prototype;function n(t){const e=Object.create(null);return t&&Object.assign(e,t),e}var r=/(?:^[#?]?|&)([^=&]+)(?:=([^&]*))?/g;function i(t,e=""){try{return decodeURIComponent(t)}catch(t){return e}}function s(t){const e=n();if(!t)return e;let s;for(;s=r.exec(t);){const t=i(s[1],s[1]),n=s[2]?i(s[2].replace(/\+/g," "),s[2]):"";e[t]=n}return e}function o(t){const{location:e}=t||self;return s(e.originalHash||e.hash)}var{isArray:c}=Array;function u(t,e){const n=[];let r=0;for(let i=0;i<t.length;i++){const s=t[i];e(s,i,t)?n.push(s):(r<i&&(t[r]=s),r++)}return r<t.length&&(t.length=r),n}function l(t){return"string"==typeof t}function h(t){return 1==(null==t?void 0:t.nodeType)}var a="​​​";function f(t){return h(t)?(t=t).tagName.toLowerCase()+(t.id?`#${t.id}`:""):t}function d(t){return t.indexOf(a)>=0}function g(t,e,n="Assertion failed",r){var i,s;if(e)return e;t&&-1==n.indexOf(t)&&(n+=t);let o=3;const c=n.split("%s");let l=c.shift();const h=[l];for(;c.length;){const t=arguments[o++],e=c.shift();l+=f(t)+e,h.push(t,e.trim())}const a=new Error(l);throw a.messageArray=u(h,(t=>""!==t)),null===(i=(s=self).__AMP_REPORT_ERROR)||void 0===i||i.call(s,a),a}function p(t,e,n,r,i){return c(i)?t(n,i.concat([e])):t(n,`${i||r}: %s`,e),e}function v(t){const e=Object.getOwnPropertyDescriptor(t,"message");if(null!=e&&e.writable)return t;const{message:n,stack:r}=t,i=new Error(n);for(const e in t)i[e]=t[e];return i.stack=r,i}function m(t){let e=null,n="";for(const t of arguments)t instanceof Error&&!e?e=v(t):(n&&(n+=" "),n+=t);return e?n&&(e.message=n+": "+e.message):e=new Error(n),e}function _(t){const e=m.apply(null,arguments);return e.expected=!0,e}var w=t=>self.AMP_CONFIG?self.AMP_CONFIG[t]:null,E=("string"==typeof w("cdnProxyRegex")?new RegExp(w("cdnProxyRegex")):w("cdnProxyRegex"))||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/;function A(t){if(!self.document||!self.document.head)return null;if(self.location&&E.test(self.location.origin))return null;const e=self.document.head.querySelector(`meta[name="${t}"]`);return e&&e.getAttribute("content")||null}var P=w("cdnUrl")||A("runtime-host")||"https://cdn.ampproject.org",R=w("errorReportingUrl")||"https://us-central1-amp-error-reporting.cloudfunctions.net/r",M=w("betaErrorReportingUrl")||"https://us-central1-amp-error-reporting.cloudfunctions.net/r-beta",y="";function T(t){var e;return y||(y=(null===(e=t.AMP_CONFIG)||void 0===e?void 0:e.v)||"012301041800000"),y}function I(t,e){const n=e||o(t);return["1","actions","amp","amp4ads","amp4email"].includes(n.development)||!!t.AMP_DEV_MODE}var S=()=>{},x=(t,e)=>e.reduce(((t,e)=>`${t}&s[]=${O(e)}`),`https://log.amp.dev/?v=012301041800000&id=${encodeURIComponent(t)}`),O=t=>encodeURIComponent(String(f(t))),V=t=>parseInt(o(t).log,10);self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var C,b=self.__AMP_LOG,k=null;function N(t,e){if(!k)throw new Error("failed to call initLogConstructor");return new k(self,t,e)}function W(t){return N(((t,e)=>e||t>=1?4:2),t)}function U(t,e,n,r,i,s,o,c,u,l,h){return t}function $(t){return t.data}function L(t,e){return F(t=function(t){return t.__AMP_TOP||(t.__AMP_TOP=t)}(t),e)}function j(t){return t.nodeType?(n=t,e=(n.ownerDocument||n).defaultView,L(e,"ampdoc")).getAmpDoc(t):t;var e,n}function F(t,e){U(function(t,e){const n=t.__AMP_SERVICES&&t.__AMP_SERVICES[e];return!(!n||!n.ctor)}(t,e));const n=function(t){let e=t.__AMP_SERVICES;return e||(e=t.__AMP_SERVICES={}),e}(t)[e];return n.obj||(U(n.ctor),U(n.context),n.obj=new n.ctor(n.context),U(n.obj),n.context=null,n.resolve&&n.resolve(n.obj)),n.obj}var G;function K(t,e){return G||(G=self.document.createElement("a")),function(t,e,n){return t.href="",new URL(e,t.href)}(G,t)}new Set(["c","v","a","ad"]);var q,z=class{constructor(t){t||(t={debug:!1,windowContext:window}),this.Z={},this.te={},this.ee=t.debug,this.ne=!1,this.re=!1,this.ie=!1,this.se=null,this.oe=null,this.ce=null,this.ue=null,this.le=null,this.he=t.windowContext||window}listen(t){return new Promise(((e,n)=>{this.ie?n(new Error("Already connected.")):this.ne?n(new Error("Already listening for connections.")):Array.isArray(t)?(this.ce=this.ae.bind(this,t,e,n),this.he.addEventListener("message",this.ce),this.ee):n(new Error("allowedOrigins should be a string array of allowed origins to accept messages from. Got:",t))})).then((()=>{this.send(z.Topics.CONNECT_HANDSHAKE,null),this.ie=!0}))}fe(t,e){const n=K(t).origin;for(let t=0;t<e.length;t++)if(K(e[t]).origin===n)return!0;return!1}ae(t,e,n,r){const i=$(r),{origin:s,ports:o}=r;this.ee,this.fe(s,t)&&i&&i.topic===z.Topics.CONNECT_HANDSHAKE&&(this.he.removeEventListener("message",this.ce),this.oe=o[0],this.le=this.de.bind(this),this.oe.addEventListener("message",this.le,!1),this.oe.start(),e())}connect(t,e){return new Promise(((n,r)=>{t||r(new Error("Provide a valid Window context to connect to.")),e||r(new Error("Provide an expected origin for the remote Window or provide the wildcard *.")),this.ie?r(new Error("Already connected.")):this.re?r(new Error("Already connecting.")):(this.se=new MessageChannel,this.oe=this.se.port1,this.ue=this.ge.bind(this,this.oe,e,n),this.oe.addEventListener("message",this.ue),this.oe.start(),t.postMessage({topic:z.Topics.CONNECT_HANDSHAKE},"*"===e?"*":K(e).origin,[this.se.port2]))}))}ge(t,e,n){this.ie=!0,this.ee,t.removeEventListener("message",this.ue),this.le=this.de.bind(this),t.addEventListener("message",this.le,!1),n()}static get Topics(){return{CONNECT_HANDSHAKE:"topic-connect-handshake",NOTIFICATION_PERMISSION_STATE:"topic-notification-permission-state",SERVICE_WORKER_STATE:"topic-service-worker-state",SERVICE_WORKER_REGISTRATION:"topic-service-worker-registration",SERVICE_WORKER_QUERY:"topic-service-worker-query",STORAGE_GET:"topic-storage-get"}}de(t){const e=$(t);if(this.Z[e.id]&&e.isReply){const t=this.Z[e.id];delete this.Z[e.id];const{promiseResolver:n}=t;t.message=e.data,this.ee,n([e.data,this.pe.bind(this,e.id,t.topic)])}else{const t=this.te[e.topic];if(!t)return;this.ee;for(let n=0;n<t.length;n++)(0,t[n])(e.data,this.pe.bind(this,e.id,e.topic))}}on(t,e){this.te[t]?this.te[t].push(e):this.te[t]=[e]}off(t,e){if(e){const n=this.te[t].indexOf(e);-1!==n&&this.te[t].splice(n,1)}else this.te[t]&&delete this.te[t]}pe(t,e,n){const r={id:t,topic:e,data:n,isReply:!0};return this.oe.postMessage(r),new Promise((t=>{this.Z[r.id]={message:n,topic:e,promiseResolver:t}}))}send(t,e){const n={id:crypto.getRandomValues(new Uint8Array(10)).join(""),topic:t,data:e};return this.ee,this.oe.postMessage(n),new Promise((r=>{this.Z[n.id]={message:e,topic:t,promiseResolver:r}}))}},D=["Webkit","webkit","Moz","moz","ms","O","o"];function H(t,e,r,i,s){const o=function(t,e,r){if(e.startsWith("--"))return e;q||(q=n());let i=q[e];if(!i||r){if(i=e,void 0===t[e]){const n=function(t){return t.charAt(0).toUpperCase()+t.slice(1)}(e),r=function(t,e){for(let n=0;n<D.length;n++){const r=D[n]+e;if(void 0!==t[r])return r}return""}(t,n);void 0!==t[r]&&(i=r)}r||(q[e]=i)}return i}(t.style,e,s);if(!o)return;const c=i?r+i:r;t.style.setProperty(function(t){const e=t.replace(/[A-Z]/g,(t=>"-"+t.toLowerCase()));return D.some((t=>e.startsWith(t+"-")))?`-${e}`:e}(o),c)}var J=!1,B=self.__AMP_ERRORS||[];self.__AMP_ERRORS=B;var Q,Z=function(t){return(Z=function(t){const e=function(t){let e=0;return()=>{let t=Math.pow(1.5,e++);return t+=function(t,e){let n=t*(e=e||.3)*Math.random();return Math.random()>.5&&(n*=-1),n}(t),1e3*t}}();return t=>setTimeout(t,e())}())(t)};function X(t,e,n,r,i){var s;!this||!this.document||i&&i.expected||(U((s=this.document).defaultView),J||(J=!0,function(t){!function(t,e){for(const n in e)H(t,n,e[n])}(t.body,{opacity:1,visibility:"visible","animation":"none"})}(s)));let c=!1;try{c=function(t){if(!t.document)return!1;const e=t.document.querySelectorAll("script[src]");for(let t=0;t<e.length;t++)if(n=e[t].src.toLowerCase(),!E.test((t=>"string"==typeof t?K(t):t)(n).origin))return!0;var n;return!1}(self)}catch(t){}if(c&&Math.random()>.01)return;const u=function(t,e,n,r,i,s){t=function(t,e){return e&&(t=e.message?e.message:String(e)),t||(t="Unknown error"),t}(t,i);let c=!(!i||!i.expected);if(/_reported_/.test(t))return;if("CANCELLED"==t)return;const u=!(self&&self.window),l=Math.random();if((function(t){return-1!=t.indexOf("Failed to load:")}(t)||"Script error."==t||u)&&(c=!0,l>.001))return;const h=d(t);if(h&&l>.1)return;const f=Object.create(null);f.v=function(t){const e=t||self;return e.__AMP_MODE?e.__AMP_MODE:e.__AMP_MODE=function(t){return{localDev:!1,development:I(t,o(t)),esm:!0,test:!1,rtvVersion:T(t),ssrReady:!1}}(e)}().rtvVersion,f.noAmp=s?"1":"0",f.m=t.replace(a,""),f.a=h?"1":"0",f.ex=c?"1":"0",f.dw=u?"1":"0";let g="1p";var p,v;if(g="esm",f.esm="1",f.rt="esm",f.ca=null!==(v=self.AMP_CONFIG)&&void 0!==v&&v.canary?"1":"0",f.bt=(null===(p=self.AMP_CONFIG)||void 0===p?void 0:p.type)||"unknown",self.location.ancestorOrigins&&self.location.ancestorOrigins[0]&&(f.or=self.location.ancestorOrigins[0]),self.viewerState&&(f.vs=self.viewerState),self.parent&&self.parent!=self&&(f.iem="1"),self.AMP&&self.AMP.viewer){const t=self.AMP.viewer.getResolvedViewerUrl(),e=self.AMP.viewer.maybeGetMessagingOrigin();t&&(f.rvu=t),e&&(f.mso=e)}const m=[],_=self.__AMP__EXPERIMENT_TOGGLES||null;var w,E,A;for(const t in _){const e=_[t];m.push(`${t}=${e?"1":"0"}`)}return f.exps=m.join(","),i?(f.el=(null===(w=i.associatedElement)||void 0===w?void 0:w.tagName)||"u",i.args&&(f.args=JSON.stringify(i.args)),h||i.ignoreStack||!i.stack||(f.s=i.stack),i.message&&(i.message+=" _reported_")):(f.f=e||"",f.l=n||"",f.c=r||""),f.r=self.document?self.document.referrer:"",f.ae=B.join(","),f.fr=self.location.originalHash||self.location.hash,"production"===f.bt&&(f.pt="1"),A=t,(E=B).length>=25&&E.splice(0,E.length-25+1),E.push(A),f}(t,e,n,r,i,c);u&&Z((()=>{try{return function(t,e){return e.pt&&Math.random()<.9?C||(C=Promise.resolve(void 0)):function(t,e){const n=(t=>L(t,"ampdoc"))(t);if(!n.isSingleDoc())return Promise.resolve(!1);const r=n.getSingleDoc();if(!r.getRootNode().documentElement.hasAttribute("report-errors-to-viewer"))return Promise.resolve(!1);const i=(s="viewer",F(function(t){const e=j(t);return e.isSingleDoc()?e.win:e}(j(r)),s));var s;return i.hasCapability("errorReporter")?i.isTrustedViewer().then((t=>{return!!t&&(i.sendMessage("error",{"m":(n=e).m,"a":n.a,"s":n.s,"el":n.el,"ex":n.ex,"v":n.v,"pt":n.pt}),!0);var n})):Promise.resolve(!1)}(t,e).then((t=>{if(!t){const t=new XMLHttpRequest;t.open("POST",Math.random()<.1?M:R,!0),t.send(JSON.stringify(e))}}))}(this,u).catch((()=>{}))}catch(t){}}))}k=class{constructor(t,e,n=""){this.win=t,this.J=e,this.W=this.X(),this.B=n,this.Z=null,this.K=function(t){let e=!1,n=null,r=t;return(...t)=>(e||(n=r.apply(self,t),e=!0,r=null),n)}((()=>{t.fetch(`${P}/rtv/012301041800000/log-messages.simple.json`).then((t=>t.json()),S).then((t=>{t&&(this.Z=t)}))})),this.Y=this.assert.bind(this)}X(){var t;const{win:e}=this;return null!==(t=e.console)&&void 0!==t&&t.log&&0!=V(e)?this.tt():0}tt(t){return this.J(V(t),!1)}et(t,e,n){var r;if(e>this.W)return!1;const i=this.win.console,s=null!==(r={1:i.error,3:i.info,2:i.warn}[e])&&void 0!==r?r:i.log,o=this.nt(n),c=`[${t}]`;return l(o[0])?o[0]=c+" "+o[0]:o.unshift(c),s.apply(i,o),!0}fine(t,...e){this.et(t,4,e)}info(t,...e){this.et(t,3,e)}warn(t,...e){this.et(t,2,e)}error(t,...e){if(!this.et(t,1,e)){var n,r;const i=this.createError.apply(this,e);i.name=t||i.name,null===(n=(r=self).__AMP_REPORT_ERROR)||void 0===n||n.call(r,i)}}expectedError(t,...e){var n,r;this.et(t,1,e)||null===(n=(r=self).__AMP_REPORT_ERROR)||void 0===n||n.call(r,this.createExpectedError.apply(this,e))}createError(t){return this.ot(m.apply(null,arguments))}createExpectedError(t){return this.ot(_.apply(null,arguments))}ot(t){return t=v(t),this.B?t.message?-1==t.message.indexOf(this.B)&&(t.message+=this.B):t.message=this.B:d(t.message)&&(t.message=t.message.replace(a,"")),t}nt(t){return c(t[0])?this.rt(t[0]):t}rt(t){var e;const n=t.shift();return null!==(e=this.Z)&&void 0!==e&&e[n]?[this.Z[n]].concat(t):[`More info at ${x(n,t)}`]}assert(t,e,n){return c(e)?this.assert.apply(this,[t].concat(this.rt(e))):g.apply(null,[this.B].concat(Array.prototype.slice.call(arguments)))}assertElement(t,e){return function(t,e,n){return p(t,e,h(e),"Element expected",n)}(this.Y,t,e)}assertString(t,e){return function(t,e,n){return p(t,e,l(e),"String expected",n)}(this.Y,t,e)}assertNumber(t,e){return function(t,e,n){return p(t,e,"number"==typeof e,"Number expected",n)}(this.Y,t,e)}assertArray(t,e){return function(t,e,n){return p(t,e,c(e),"Array expected",n)}(this.Y,t,e)}assertBoolean(t,e){return function(t,e,n){return p(t,e,!!e===e,"Boolean expected",n)}(this.Y,t,e)}},b.dev||(b.dev=N((t=>t>=3?4:t>=2?3:0))),b.user||(b.user=W(a)),function(t,e){return e}(b.user.win,undefined)?b.userForEmbed||(b.userForEmbed=W("​​​​")):b.user,Q=function(t,e){try{let n;if(t)if(void 0!==t.message)t=v(t),n=!0;else{const e=t;(t=new Error(function(t){try{return JSON.stringify(t)}catch(e){return String(t)}}(e))).origError=e}else t=new Error("Unknown error");if(t.reported)return t;if(t.reported=!0,t.messageArray){const e=function(t,e){for(let e=0;e<t.length;e++)if(null==(n=t[e])?void 0:n.tagName)return e;var n;return-1}(t.messageArray);e>-1&&(t.associatedElement=t.messageArray[e])}const r=e||t.associatedElement;if(r&&r.classList&&r.classList.add("i-amphtml-error"),self.console&&(d(t.message)||!t.expected)){const e=console.error||console.log;t.messageArray?e.apply(console,t.messageArray):r?e.call(console,t.message,r):e.call(console,t.message)}r&&r.dispatchCustomEventForTesting&&r.dispatchCustomEventForTesting("amp:error",t.message),X.call(self,void 0,void 0,void 0,void 0,t)}catch(t){setTimeout((function(){throw t}))}return t},self.__AMP_REPORT_ERROR=Q,window._ampWebPushHelperFrame=new class{constructor(t){this.ee=t&&t.debug,this.he=t.windowContext||window,this.ve=new z({debug:this.ee,windowContext:this.he}),this.me={}}_e(t,e,n,r){t({success:e,error:e?void 0:n,result:e?r:void 0})}we(t,e){if(t&&t.isQueryTopicSupported){let n=!1;for(const e in z.Topics)t.isQueryTopicSupported===z.Topics[e]&&(n=!0);this._e(e,!0,null,n)}else this._e(e,!0,null,Notification.permission)}Ee(t,e){let n=null;try{t&&t.key&&this.he.localStorage&&(n=this.he.localStorage.getItem(t.key))}catch(t){}this._e(e,!0,null,n)}Ae(t,e){const n={isControllingFrame:!!this.he.navigator.serviceWorker.controller,url:this.he.navigator.serviceWorker.controller?this.he.navigator.serviceWorker.controller.scriptURL:null,state:this.he.navigator.serviceWorker.controller?this.he.navigator.serviceWorker.controller.state:null};this._e(e,!0,null,n)}Pe(t,e){if(!t||!t.workerUrl||!t.registrationOptions)throw new Error("Expected arguments workerUrl and registrationOptions in message, got:",t);this.he.navigator.serviceWorker.register(t.workerUrl,t.registrationOptions).then((()=>{this._e(e,!0,null,null)})).catch((t=>{this._e(e,!0,null,t?t.message||t.toString():null)}))}messageServiceWorker(t){this.he.navigator.serviceWorker.controller.postMessage({command:t.topic,payload:t.payload})}Re(t,e){if(!t||!t.topic)throw new Error("Expected argument topic in message, got:",t);new Promise((e=>{this.me[t.topic]=e,this.waitUntilWorkerControlsPage().then((()=>{this.messageServiceWorker(t)}))})).then((n=>(delete this.me[t.topic],this._e(e,!0,null,n))))}Me(){const t=s(this.he.location.search);if(!t.parentOrigin)throw new Error("Expecting parentOrigin URL query parameter.");return t.parentOrigin}ye(t){const{command:e,payload:n}=t.data,r=this.me[e];"function"==typeof r&&r(n)}Te(){return this.he.navigator.serviceWorker&&this.he.navigator.serviceWorker.controller&&"activated"===this.he.navigator.serviceWorker.controller.state}waitUntilWorkerControlsPage(){return new Promise((t=>{this.Te()?t():this.he.navigator.serviceWorker.addEventListener("controllerchange",(()=>{this.Te()?t():this.he.navigator.serviceWorker.controller.addEventListener("statechange",(()=>{this.Te()&&t()}))}))}))}run(t){this.ve.on(z.Topics.NOTIFICATION_PERMISSION_STATE,this.we.bind(this)),this.ve.on(z.Topics.SERVICE_WORKER_STATE,this.Ae.bind(this)),this.ve.on(z.Topics.SERVICE_WORKER_REGISTRATION,this.Pe.bind(this)),this.ve.on(z.Topics.SERVICE_WORKER_QUERY,this.Re.bind(this)),this.ve.on(z.Topics.STORAGE_GET,this.Ee.bind(this)),this.waitUntilWorkerControlsPage().then((()=>{this.he.navigator.serviceWorker.addEventListener("message",this.ye.bind(this))})),this.ve.listen([t||this.Me()])}}({debug:!1}),window._ampWebPushHelperFrame.run()})();
/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */
//# sourceMappingURL=amp-web-push-helper-frame.mjs.map