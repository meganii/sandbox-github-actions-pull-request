;
(self.AMP=self.AMP||[]).push({m:1,v:"2301041800000",n:"amp-experiment",ev:"0.1",l:!0,f:function(n,t){(()=>{var{hasOwnProperty:t,toString:r}=Object.prototype;function e(n,r){return t.call(n,r)}self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var o,i=self.__AMP_LOG;function s(n){return function(n,t){throw new Error("failed to call initLogConstructor")}()}function u(n,t,r,e,o,i,s,u,c,a,l){return n}function c(n,t,r,e,o,u,c,a,l,f,p){return(i.user||(i.user=s()),void i.user.win?i.userForEmbed||(i.userForEmbed=s()):i.user).assert(n,t,r,e,o,u,c,a,l,f,p)}var a=class{constructor(){this.promise=new Promise(((n,t)=>{this.resolve=n,this.reject=t}))}};function l(n,t){return m(n=function(n){return n.__AMP_TOP||(n.__AMP_TOP=n)}(n),t)}function f(n,t){return function(n,t){const r=v(n,t);if(r)return r;const e=b(n);return e[t]=function(){const n=new a,{promise:t,reject:r,resolve:e}=n;return t.catch((()=>{})),{obj:null,promise:t,resolve:e,reject:r,context:null,ctor:null}}(),e[t].promise}(h(n),t)}function p(n,t){return v(h(n),t)}function d(n){return n.nodeType?(r=n,t=(r.ownerDocument||r).defaultView,l(t,"ampdoc")).getAmpDoc(n):n;var t,r}function h(n){const t=d(n);return t.isSingleDoc()?t.win:t}function m(n,t){u(function(n,t){const r=n.__AMP_SERVICES&&n.__AMP_SERVICES[t];return!(!r||!r.ctor)}(n,t));const r=b(n)[t];return r.obj||(u(r.ctor),u(r.context),r.obj=new r.ctor(r.context),u(r.obj),r.context=null,r.resolve&&r.resolve(r.obj)),r.obj}function v(n,t){const r=b(n)[t];return r?r.promise?r.promise:(m(n,t),r.promise=Promise.resolve(r.obj)):null}function b(n){let t=n.__AMP_SERVICES;return t||(t=n.__AMP_SERVICES={}),t}var g=/^[\w-]+$/;function P(n,t,i){w(t),function(n){const t=n.variants;var o;c((o=t,"[object Object]"===r.call(o)&&Object.keys(t).length>0),"Missing experiment variants config."),n.group&&w(n.group);let i=0;for(const n in t)if(e(t,n)){w(n);const r=t[n];c("number"==typeof r&&r>0&&r<100,"Invalid percentage %s:%s. Has to be greater than 0 and less than 100",n,r),i+=r}c(i.toFixed(6)<=100,"Total percentage is bigger than 100: "+i)}(i);const s=n.getParam("amp-x-"+t);if(s&&e(i.variants,s))return Promise.resolve(s);const u=!1!==i.sticky,a=i.cidScope||"amp-experiment";let h=Promise.resolve(!0);var m;return u&&i.consentNotificationId&&(h=(m=n.getHeadNode(),function(n,t,r,e){return function(n,t,r,e){const o=p(n,t);if(o)return o;const i=d(n);return i.whenExtensionsKnown().then((()=>{const n=i.getExtensionVersion(r);return n?l(i.win,"extensions").waitForExtension(r,n):null})).then((r=>r?e?p(n,t):f(n,t):null))}(n,t,r,e).then((n=>function(n,t,r){return c(n,"Service %s was requested to be provided through %s, but %s is not loaded in the current page. To fix this problem load the JavaScript file for %s in this page.",t,r,r,r)}(n,t,r)))}(m,"userNotificationManager","amp-user-notification")).then((n=>n.getNotification(i.consentNotificationId))).then((n=>(c(n,`Notification not found: ${i.consentNotificationId}`),n.isDismissed())))),h.then((r=>{if(!r)return null;const e=i.group||t;return function(n,t,r){if(!r)return Promise.resolve(100*n.win.Math.random());const e=(i=n,f(i,"cid")).then((n=>n.get({scope:r,createCookieIfNotPresent:!0},o||(o=Promise.resolve(void 0)))));var i,s;return Promise.all([e,(s=n.win,l(s,"crypto"))]).then((n=>n[1].uniform(t+":"+n[0]))).then((n=>100*n))}(n,e,u?a:null).then((n=>{let t=0;const r=Object.keys(i.variants).sort();for(let e=0;e<r.length;e++)if(t+=i.variants[r[e]],n<t)return r[e];return null}))}))}function w(n){c(g.test(n),"Invalid name: %s. Allowed chars are [a-zA-Z0-9-_].",n)}var x=class extends n.BaseElement{static prerenderAllowed(){return!0}isLayoutSupported(n){return"nodisplay"==n||"container"==n}isBuildRenderBlocking(){return!0}buildCallback(){return f(this.getAmpDoc(),"variant").then((n=>{try{const t=this.zA(),r=Object.create(null),e=Object.keys(t).map((n=>P(this.getAmpDoc(),n,t[n]).then((t=>{r[n]=t})))),o=Promise.all(e).then((()=>r)).then(this.nnn.bind(this));n.init(o)}catch(t){throw n.init({}),t}}))}zA(){const{children:n}=this.element;return c(1==n.length&&"SCRIPT"==n[0].tagName&&"APPLICATION/JSON"==n[0].getAttribute("type").toUpperCase(),'<amp-experiment> should contain exactly one <script type="application/json"> child.'),u((t=n[0].textContent,JSON.parse(t)));var t}nnn(n){return this.getAmpDoc().waitForBodyOpen().then((t=>{for(const r in n)n[r]&&t.setAttribute("amp-x-"+r,n[r]);return n}))}};n.registerServiceForDoc("variant",class{constructor(n){this.ampdoc=n,this.kj=new a}init(n){this.kj.resolve(n)}getVariants(){return this.kj.promise}whenReady(){return this.getVariants()}}),n.registerElement("amp-experiment",x)})();
/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */}});
//# sourceMappingURL=amp-experiment-0.1.mjs.map