;
(self.AMP=self.AMP||[]).push({m:1,v:"2301041800000",n:"amp-image-lightbox",ev:"0.1",l:!0,f:function(t,i){(()=>{var i;function s(){return i||(i=Promise.resolve(void 0))}var h=class{constructor(){this.promise=new Promise(((t,i)=>{this.resolve=t,this.reject=i}))}},{isArray:n}=Array;function e(t,i){const s=[];let h=0;for(let n=0;n<t.length;n++){const e=t[n];i(e,n,t)?s.push(e):(h<n&&(t[h]=e),h++)}return h<t.length&&(t.length=h),s}function r(t){return"string"==typeof t}var{hasOwnProperty:o,toString:a}=Object.prototype;function c(t,i,s,h){return n=>u.solveYValueFromXValue(n,0,0,t,i,s,h,1,1)}var u=class{static solveYValueFromXValue(t,i,s,h,n,e,r,o,a){return u.Kh(u.Yh(t,i,h,e,o),s,n,r,a)}static Yh(t,i,s,h,n){const e=1e-6;let r=(t-i)/(n-i);if(r<=0)return 0;if(r>=1)return 1;let o=0,a=1,c=0;for(let l=0;l<8;l++){c=u.Jh(r,i,s,h,n);const l=(u.Jh(r+e,i,s,h,n)-c)/e;if(Math.abs(c-t)<e)return r;if(Math.abs(l)<e)break;c<t?o=r:a=r,r-=(c-t)/l}for(let l=0;Math.abs(c-t)>e&&l<8;l++)c<t?(o=r,r=(r+a)/2):(a=r,r=(r+o)/2),c=u.Jh(r,i,s,h,n);return r}static Jh(t,i,s,h,n){if(0==t)return i;if(1==t)return n;let e=u.Qh(i,s,t),r=u.Qh(s,h,t);const o=u.Qh(h,n,t);return e=u.Qh(e,r,t),r=u.Qh(r,o,t),u.Qh(e,r,t)}static Kh(t,i,s,h,n){if(0==t)return i;if(1==t)return n;let e=u.Qh(i,s,t),r=u.Qh(s,h,t);const o=u.Qh(h,n,t);return e=u.Qh(e,r,t),r=u.Qh(r,o,t),u.Qh(e,r,t)}static Qh(t,i,s){return t+s*(i-t)}},l={LINEAR:t=>t,EASE:t=>u.solveYValueFromXValue(t,0,0,.25,.1,.25,1,1,1),EASE_IN:t=>u.solveYValueFromXValue(t,0,0,.42,0,1,1,1,1),EASE_OUT:t=>u.solveYValueFromXValue(t,0,0,0,0,.58,1,1,1),EASE_IN_OUT:t=>u.solveYValueFromXValue(t,0,0,.42,0,.58,1,1,1)},f={"linear":l.LINEAR,"ease":l.EASE,"ease-in":l.EASE_IN,"ease-out":l.EASE_OUT,"ease-in-out":l.EASE_IN_OUT};function m(t){if(!t)return null;if(r(t)){if(-1!=(t=t).indexOf("cubic-bezier")){const i=t.match(/cubic-bezier\((.+)\)/);if(i){const t=i[1].split(",").map(parseFloat);if(4==t.length){for(let i=0;i<4;i++)if(isNaN(t[i]))return null;return c(t[0],t[1],t[2],t[3])}}return null}return f[t]}return t}function d(t){return 1==(null==(i=t)?void 0:i.nodeType)?(t=t).tagName.toLowerCase()+(t.id?`#${t.id}`:""):t;var i}function _(t,i,s,h,n,e,r,o,a,c,u){return t}function p(t,i,s,h,n,r,o,a,c,u,l){return function(t,i,s="Assertion failed",h){var n,r;if(i)return i;t&&-1==s.indexOf(t)&&(s+=t);let o=3;const a=s.split("%s");let c=a.shift();const u=[c];for(;a.length;){const t=arguments[o++],i=a.shift();c+=d(t)+i,u.push(t,i.trim())}const l=new Error(c);throw l.messageArray=e(u,(t=>""!==t)),null===(n=(r=self).__AMP_REPORT_ERROR)||void 0===n||n.call(r,l),l}("​​​",t,i,s,h,n,r,o,a,c,u,l)}function g(t){return(t.ownerDocument||t).defaultView}function A(t){_(/^[\w-]+$/.test(t))}function M(t,i,s,h){return{left:t,top:i,width:s,height:h,bottom:i+h,right:t+s,x:t,y:i}}function P(t){return M(Number(t.left),Number(t.top),Number(t.width),Number(t.height))}function v(t,i,s,h){const e=n(r=t)?r:[r];var r;for(const t of e){const n=i.getAttribute(t);null!==n?s.setAttribute(t,n):h&&s.removeAttribute(t)}}var E,b=/(\S+)(?:\s+(?:(-?\d+(?:\.\d+)?)([a-zA-Z]*)))?\s*(?:,|$)/g,T=class{constructor(t){p(t.length>0,"Srcset must have at least one source"),this.VT=t;let i=!1,s=!1;for(let h=0;h<t.length;h++){const n=t[h];i=i||!!n.width,s=s||!!n.dpr}p(!(i===s),"Srcset must have width or dpr sources, but not both"),t.sort(i?I:R),this.vS=i}select(t,i){_(t),_(i);let s=0;return s=this.vS?this.bS(t*i):this.wS(i),this.VT[s].url}bS(t){const i=this.VT;let s=0,h=1/0,n=1/0;for(let r=0;r<i.length;r++){var e;const o=null!==(e=i[r].width)&&void 0!==e?e:0,a=Math.abs(o-t);if(!(a<=1.1*h||t/n>1.2))break;s=r,h=a,n=o}return s}wS(t){const i=this.VT;let s=0,h=1/0;for(let n=0;n<i.length;n++){const e=Math.abs(i[n].dpr-t);if(!(e<=h))break;s=n,h=e}return s}getUrls(){return this.VT.map((t=>t.url))}stringify(t){const i=[],s=this.VT;for(let h=0;h<s.length;h++){const n=s[h];let e=n.url;t&&(e=t(e)),this.vS?e+=` ${n.width}w`:e+=` ${n.dpr}x`,i.push(e)}return i.join(", ")}};function I(t,i){return p(t.width!=i.width,"Duplicate width: %s",t.width),t.width-i.width}function R(t,i){return p(t.dpr!=i.dpr,"Duplicate dpr: %s",t.dpr),t.dpr-i.dpr}function V(t){const i=Object.getOwnPropertyDescriptor(t,"message");if(null!=i&&i.writable)return t;const{message:s,stack:h}=t,n=new Error(s);for(const i in t)n[i]=t[i];return n.stack=h,n}function w(t){let i=null,s="";for(const t of arguments)t instanceof Error&&!i?i=V(t):(s&&(s+=" "),s+=t);return i?s&&(i.message=s+": "+i.message):i=new Error(s),i}function y(t,...i){const s=w.apply(null,i);s.name=t||s.name,function(t){var i,s;null===(i=(s=self).__AMP_REPORT_ERROR)||void 0===i||i.call(s,t)}(s)}var x=["Webkit","webkit","Moz","moz","ms","O","o"];function S(t,i,s,h,n){const e=function(t,i,s){if(i.startsWith("--"))return i;E||(E=Object.create(null));let h=E[i];if(!h||s){if(h=i,void 0===t[i]){const s=function(t){return t.charAt(0).toUpperCase()+t.slice(1)}(i),n=function(t,i){for(let s=0;s<x.length;s++){const h=x[s]+i;if(void 0!==t[h])return h}return""}(t,s);void 0!==t[n]&&(h=n)}s||(E[i]=h)}return h}(t.style,i,n);if(!e)return;const r=h?s+h:s;t.style.setProperty(function(t){const i=t.replace(/[A-Z]/g,(t=>"-"+t.toLowerCase()));return x.some((t=>i.startsWith(t+"-")))?`-${i}`:i}(e),r)}function D(t,i){for(const s in i)S(t,s,i[s])}function k(t){return`${t}px`}function C(t,i){return"number"==typeof t?i(t):t}function X(t,i){return null==i?`translate(${C(t,k)})`:`translate(${C(t,k)}, ${C(i,k)})`}function O(t){return`scale(${t})`}function Y(t,i=" "){return(s,h)=>t.map((t=>t(s,h))).filter(r).join(i)}function z(t,i){return(s,h)=>{for(const e in i)S(t,("display"===(n=e)&&y("STYLE","`display` style detected. You must use toggle instead."),n),i[e](s,h));var n}}function $(t,i){return s=>t+(i-t)*s}function Z(t,i){return s=>X(t(s),null==i?void 0:i(s))}function L(t){return i=>O(t(i))}function N(t,i,s){return _(i<=s),Math.min(Math.max(t,i),s)}function B(t,i,s,h){return _(i<=s),N(t,i-h,s+h)}function U(t,i){return Math.sqrt(t*t+i*i)}self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var G=self.__AMP_LOG;function F(t,i){throw new Error("failed to call initLogConstructor")}function H(t){return F()}function j(){return G.dev||(G.dev=F())}function W(t,i,s,h,n,e,r,o,a,c,u){return t}function q(t,i){return Q(t=function(t){return t.__AMP_TOP||(t.__AMP_TOP=t)}(t),i)}function J(t){return t.nodeType?(i=g(t),q(i,"ampdoc")).getAmpDoc(t):t;var i}function K(t){const i=J(t);return i.isSingleDoc()?i.win:i}function Q(t,i){W(tt(t,i));const s=function(t){let i=t.__AMP_SERVICES;return i||(i=t.__AMP_SERVICES={}),i}(t)[i];return s.obj||(W(s.ctor),W(s.context),s.obj=new s.ctor(s.context),W(s.obj),s.context=null,s.resolve&&s.resolve(s.obj)),s.obj}function tt(t,i){const s=t.__AMP_SERVICES&&t.__AMP_SERVICES[i];return!(!s||!s.ctor)}var it,st=t=>Q(t,"timer"),ht=t=>q(t,"vsync"),nt="Animation",et=function(){},rt=class{static animate(t,i,s,h){return new rt(t).setCurve(h).add(0,i,1).start(s)}constructor(t,i){this.kt=t,this.Xh=i||ht(self),this.Zh=null,this.io=[]}setCurve(t){return t&&(this.Zh=m(t)),this}add(t,i,s,h){return this.io.push({delay:t,func:i,duration:s,curve:m(h)}),this}start(t){return new ot(this.Xh,this.kt,this.io,this.Zh,t)}},ot=class{constructor(t,i,s,n,e){this.Xh=t,this.kt=i,this.io=[];for(let t=0;t<s.length;t++){const i=s[t];this.io.push({delay:i.delay,func:i.func,duration:i.duration,curve:i.curve||n,started:!1,completed:!1})}this.so=e,this.Ch=Date.now(),this.Ht=!0,this.Ri={};const r=new h;this.eo=r.promise,this.Sn=r.resolve,this.no=r.reject,this.ro=this.Xh.createAnimTask(this.kt,{mutate:this.ho.bind(this)}),this.Xh.canAnimate(this.kt)?this.ro(this.Ri):this.oo(!1,0)}then(t,i){return t||i?this.eo.then(t,i):this.eo}thenAlways(t){const i=t||et;return this.then(i,i)}halt(t){this.oo(!1,t||0)}oo(t,i){if(this.Ht){if(this.Ht=!1,0!=i){this.io.length>1&&this.io.sort(((t,i)=>t.delay+t.duration-(i.delay+i.duration)));try{if(i>0)for(let t=0;t<this.io.length;t++)this.io[t].func(1,!0);else for(let t=this.io.length-1;t>=0;t--)this.io[t].func(0,!1)}catch(i){j().error(nt,"completion failed: "+i,i),t=!1}}t?this.Sn():this.no()}}ho(t){if(!this.Ht)return;const i=Date.now(),s=Math.min((i-this.Ch)/this.so,1);for(let t=0;t<this.io.length;t++){const i=this.io[t];!i.started&&s>=i.delay&&(i.started=!0)}for(let t=0;t<this.io.length;t++){const i=this.io[t];i.started&&!i.completed&&this.uo(i,s)}1==s?this.oo(!0,0):this.Xh.canAnimate(this.kt)?this.ro(this.Ri):this.oo(!1,0)}uo(t,i){let s,h;if(t.duration>0){if(s=Math.min((i-t.delay)/t.duration,1),h=s,t.curve&&1!=h)try{h=t.curve(s)}catch(t){return j().error(nt,"step curve failed: "+t,t),void this.oo(!1,0)}}else s=1,h=1;1==s&&(t.completed=!0);try{t.func(h,t.completed)}catch(t){return j().error(nt,"step mutate failed: "+t,t),void this.oo(!1,0)}}};function at(t){return!!(t.complete||"complete"==t.readyState||function(t){return"AUDIO"===t.tagName||"VIDEO"===t.tagName}(t)&&t.readyState>0||t.document&&"complete"==t.document.readyState)}var ct=class{constructor(){this.Fn=null}add(t){return this.Fn||(this.Fn=[]),this.Fn.push(t),()=>{this.remove(t)}}remove(t){this.Fn&&function(t,i){const s=t.indexOf(i);-1!=s&&t.splice(s,1)}(this.Fn,t)}removeAll(){this.Fn&&(this.Fn.length=0)}fire(t){if(this.Fn)for(const i of this.Fn.slice())i(t)}getHandlerCount(){var t,i;return null!==(t=null===(i=this.Fn)||void 0===i?void 0:i.length)&&void 0!==t?t:0}},ut="__AMP_Gestures",lt=class{static get(t,i=!1,s=!1){let h=t[ut];return h||(h=new lt(t,i,s),t[ut]=h),h}constructor(t,i=!1,s=!1){this._n=t,this.hI=[],this.t_=[],this.gi=[],this.lI=[],this.pI=null;const h=function(t){if(void 0!==it)return it;it=!1;try{const i={get passive(){return it=!0,!1}};t.addEventListener("test-options",null,i),t.removeEventListener("test-options",null,i)}catch(t){}return it}(t.ownerDocument.defaultView);this.mI=i||h,this.cI=s,this.uI=!1,this.Ar=new class{constructor(t,i,s){this.Qe=st(t),this.Xe=i,this.Ze=s||0,this.pr=-1,this.mr=0,this.Ht=!1,this._r=()=>{this.Ar()}}isPending(){return-1!=this.pr}schedule(t){let i=t||this.Ze;this.Ht&&i<10&&(i=10);const s=Date.now()+i;return(!this.isPending()||s-this.mr<-10)&&(this.cancel(),this.mr=s,this.pr=this.Qe.delay(this._r,i),!0)}Ar(){this.pr=-1,this.mr=0,this.Ht=!0,this.Xe(),this.Ht=!1}cancel(){this.isPending()&&(this.Qe.cancel(this.pr),this.pr=-1)}}(g(t),this.vg.bind(this)),this.dI=new ct,this.fI=Object.create(null),this._I=this.sm.bind(this),this.gI=this.rm.bind(this),this.yI=this.nm.bind(this),this.AI=this.h_.bind(this),this._n.addEventListener("touchstart",this._I,!!h&&{passive:!0}),this._n.addEventListener("touchend",this.gI),this._n.addEventListener("touchmove",this.yI,!!h&&{passive:!0}),this._n.addEventListener("touchcancel",this.AI),this.bI=!1}cleanup(){this._n.removeEventListener("touchstart",this._I),this._n.removeEventListener("touchend",this.gI),this._n.removeEventListener("touchmove",this.yI),this._n.removeEventListener("touchcancel",this.AI),delete this._n[ut],this.Ar.cancel()}onGesture(t,i){const s=new t(this),h=s.getType();let n=this.fI[h];return n||(this.hI.push(s),n=new ct,this.fI[h]=n),n.add(i)}removeGesture(t){const i=new t(this).getType(),s=this.fI[i];if(s){s.removeAll();const t=function(t,s){for(let s=0;s<t.length;s++)if(t[s].getType()==i)return s;return-1}(this.hI);return!(t<0||(this.hI.splice(t,1),this.gi.splice(t,1),this.lI.splice(t,1),this.t_.splice(t,1),delete this.fI[i],0))}return!1}onPointerDown(t){return this.dI.add(t)}sm(t){const i=Date.now();this.uI=!1,this.dI.fire(t);for(let s=0;s<this.hI.length;s++)this.gi[s]||(this.lI[s]&&this.lI[s]<i&&this.o_(s),this.hI[s].onTouchStart(t)&&this.u_(s));this.vI(t)}nm(t){const i=Date.now();for(let s=0;s<this.hI.length;s++)this.t_[s]&&(this.lI[s]&&this.lI[s]<i?this.o_(s):this.hI[s].onTouchMove(t)||this.o_(s));this.vI(t)}rm(t){const i=Date.now();for(let s=0;s<this.hI.length;s++){if(!this.t_[s])continue;if(this.lI[s]&&this.lI[s]<i){this.o_(s);continue}this.hI[s].onTouchEnd(t);const h=!this.lI[s],n=this.lI[s]<i;this.pI==this.hI[s]||!h&&!n||this.o_(s)}this.vI(t)}h_(t){for(let t=0;t<this.hI.length;t++)this.TI(t);this.vI(t)}Wp(t,i){if(this.pI)return void t.acceptCancel();const s=Date.now();for(let h=0;h<this.hI.length;h++)this.hI[h]==t&&(this.gi[h]=s+i,this.lI[h]=0);this.bI=!0}EI(t,i){if(this.pI)return void t.acceptCancel();const s=Date.now();for(let h=0;h<this.hI.length;h++)this.hI[h]==t&&(this.lI[h]=s+i)}xI(t){this.pI==t&&(this.pI=null,this.uI=!0)}MI(t,i,s){_(this.pI==t);const h=this.fI[t.getType()];h&&h.fire(new class{constructor(t,i,s,h){this.type=t,this.data=i,this.time=s,this.event=h}}(t.getType(),i,Date.now(),s))}vI(t){let i=!!this.pI||this.uI;if(this.uI=!1,!i){const t=Date.now();for(let s=0;s<this.hI.length;s++)if(this.gi[s]||this.lI[s]&&this.lI[s]>=t){i=!0;break}}i?(t.stopPropagation(),this.mI||t.preventDefault()):this.cI&&t.stopPropagation(),this.bI&&(this.bI=!1,this.vg())}vg(){const t=Date.now();let i=-1;for(let s=0;s<this.hI.length;s++)this.gi[s]?(-1==i||this.gi[s]>this.gi[i])&&(i=s):this.lI[s]&&this.lI[s]<t&&this.o_(s);if(-1==i)return;let s=0;for(let i=0;i<this.hI.length;i++)!this.gi[i]&&this.t_[i]&&(s=Math.max(s,this.lI[i]-t));s<2?this.wI(i):this.Ar.schedule(s)}wI(t){const i=this.hI[t];for(let i=0;i<this.hI.length;i++)i!=t&&this.TI(i);this.gi[t]=0,this.lI[t]=0,this.pI=i,i.acceptStart()}u_(t){this.t_[t]=!0,this.lI[t]=0}o_(t){this.t_[t]=!1,this.lI[t]=0,this.gi[t]||this.hI[t].acceptCancel()}TI(t){this.gi[t]=0,this.o_(t)}},ft=class{constructor(t,i){this.BV=t,this.S_=i}getType(){return this.BV}signalReady(t){this.S_.Wp(this,t)}signalPending(t){this.S_.EI(this,t)}signalEnd(){this.S_.xI(this)}signalEmit(t,i){this.S_.MI(this,t,i)}acceptStart(){}acceptCancel(){}onTouchStart(t){return!1}onTouchMove(t){return!1}onTouchEnd(t){}},mt=function(){},dt=.02,_t=Math.round(-16.67/Math.log(.95));function pt(t,i,s){i<1&&(i=1);const h=t/i,n=.5+Math.min(i/33.34,.5);return h*n+s*(1-n)}function gt(t,i,s,h,n,e,r){return new At(t,i,s,h,n,e,r).start()}var At=class{constructor(t,i,s,n,e,r,o){this.Xh=o||ht(self),this.kt=t,this.$=r,this.qV=i,this.XV=s,this.VY=n,this.bY=e,this.pk=0,this.mk=0;const a=new h;this.eo=a.promise,this.Sn=a.resolve,this.no=a.reject,this.wY=!1}start(){return this.wY=!0,Math.abs(this.VY)<=dt&&Math.abs(this.bY)<=dt?(this.yY(),this.xY(!0)):this.zY(),this}halt(){this.wY&&this.xY(!1)}then(t,i){return t||i?this.eo.then(t,i):this.eo}thenAlways(t){const i=t||mt;return this.then(i,i)}zY(){this.pk=this.VY,this.mk=this.bY;const t=this.SY.bind(this),i=this.xY.bind(this,!0);return this.Xh.runAnimMutateSeries(this.kt,t,5e3).then(i,i)}SY(t,i){if(!this.wY)return!1;if(this.qV+=i*this.pk,this.XV+=i*this.mk,!this.yY())return!1;const s=Math.exp(-t/_t);return this.pk=this.VY*s,this.mk=this.bY*s,Math.abs(this.pk)>dt||Math.abs(this.mk)>dt}xY(t){this.wY&&(this.wY=!1,this.yY(),t?this.Sn():this.no())}yY(){return this.$(this.qV,this.XV)}},Mt=class extends ft{constructor(t){super("tap",t),this.GV=0,this.WV=0,this.qV=0,this.XV=0,this.o=null}onTouchStart(t){const{touches:i}=t;return this.o=t.target,!(!i||1!=i.length||(this.GV=i[0].clientX,this.WV=i[0].clientY,0))}onTouchMove(t){const i=t.changedTouches||t.touches;if(i&&1==i.length){this.qV=i[0].clientX,this.XV=i[0].clientY;const t=Math.abs(this.qV-this.GV)>=8,s=Math.abs(this.XV-this.WV)>=8;if(t||s)return!1}return!0}onTouchEnd(t){this.signalReady(0)}acceptStart(){this.signalEmit({clientX:this.qV,clientY:this.XV,target:this.o},null),this.signalEnd()}},Pt=class extends ft{constructor(t){super("doubletap",t),this.GV=0,this.WV=0,this.qV=0,this.XV=0,this.tX=0,this.sX=null}onTouchStart(t){if(this.tX>1)return!1;const{touches:i}=t;return!(!i||1!=i.length||(this.GV=i[0].clientX,this.WV=i[0].clientY,this.qV=i[0].clientX,this.XV=i[0].clientY,0))}onTouchMove(t){const{touches:i}=t;if(i&&1==i.length){this.qV=i[0].clientX,this.XV=i[0].clientY;const t=Math.abs(this.qV-this.GV)>=8,s=Math.abs(this.XV-this.WV)>=8;return!t&&!s||(this.acceptCancel(),!1)}return!1}onTouchEnd(t){this.tX++,this.tX<2?this.signalPending(200):(this.sX=t,this.signalReady(0))}acceptStart(){this.tX=0,this.signalEmit({clientX:this.qV,clientY:this.XV},this.sX),this.signalEnd()}acceptCancel(){this.tX=0}},vt=class extends ft{constructor(t,i,s,h){super(t,i),this.HV=s,this.YV=h,this.pI=!1,this.GV=0,this.WV=0,this.qV=0,this.XV=0,this.KV=0,this.ZV=0,this.Ch=0,this.JV=0,this.QV=0,this.pk=0,this.mk=0}onTouchStart(t){const{touches:i}=t;return!!(this.pI&&i&&i.length>1)||!(!i||1!=i.length)&&(this.Ch=Date.now(),this.GV=i[0].clientX,this.WV=i[0].clientY,!0)}onTouchMove(t){const{touches:i}=t;if(i&&i.length>=1){const{clientX:s,clientY:h}=i[0];if(this.qV=s,this.XV=h,this.pI)this.fk(!1,!1,t);else{const t=Math.abs(s-this.GV),i=Math.abs(h-this.WV);if(this.HV&&this.YV)(t>=8||i>=8)&&this.signalReady(-10);else if(this.HV){if(t>=8&&t>i)this.signalReady(-10);else if(i>=8)return!1}else{if(!this.YV)return!1;if(i>=8&&i>t)this.signalReady(-10);else if(t>=8)return!1}}return!0}return!1}onTouchEnd(t){const{touches:i}=t;i&&0==i.length&&this._k(t)}acceptStart(){this.pI=!0,this.KV=this.GV,this.ZV=this.WV,this.QV=this.Ch,this.GV=this.qV,this.WV=this.XV,this.fk(!0,!1,null)}acceptCancel(){this.pI=!1}fk(t,i,s){this.JV=Date.now();const h=this.JV-this.QV;if(!i&&h>4||i&&h>16){const t=pt(this.qV-this.KV,h,this.pk),s=pt(this.XV-this.ZV,h,this.mk);(!i||h>32||0!=t||0!=s)&&(this.pk=Math.abs(t)>1e-4?t:0,this.mk=Math.abs(s)>1e-4?s:0),this.KV=this.qV,this.ZV=this.XV,this.QV=this.JV}this.signalEmit({first:t,last:i,time:this.JV,deltaX:this.qV-this.GV,deltaY:this.XV-this.WV,startX:this.GV,startY:this.WV,lastX:this.qV,lastY:this.XV,velocityX:this.pk,velocityY:this.mk},s)}_k(t){this.pI&&(this.pI=!1,this.fk(!1,!0,t),this.signalEnd())}},Et=class extends vt{constructor(t){super("swipe-xy",t,!0,!0)}},bt=class extends ft{constructor(t){super("tapzoom",t),this.pI=!1,this.GV=0,this.WV=0,this.qV=0,this.XV=0,this.tX=0,this.KV=0,this.ZV=0,this.JV=0,this.QV=0,this.pk=0,this.mk=0}onTouchStart(t){if(this.pI)return!1;const{touches:i}=t;return!(!i||1!=i.length||(this.GV=i[0].clientX,this.WV=i[0].clientY,0))}onTouchMove(t){const{touches:i}=t;if(i&&1==i.length){if(this.qV=i[0].clientX,this.XV=i[0].clientY,this.pI)this.fk(!1,!1,t);else{const t=Math.abs(this.qV-this.GV)>=8,i=Math.abs(this.XV-this.WV)>=8;if(t||i){if(0==this.tX)return this.acceptCancel(),!1;this.signalReady(0)}}return!0}return!1}onTouchEnd(t){this.pI?this._k(t):(this.tX++,1!=this.tX?this.acceptCancel():this.signalPending(400))}acceptStart(){this.tX=0,this.pI=!0,this.fk(!0,!1,null)}acceptCancel(){this.tX=0,this.pI=!1}fk(t,i,s){this.JV=Date.now(),t?this.pk=this.mk=0:this.JV-this.QV>2&&(this.pk=pt(this.qV-this.KV,this.JV-this.QV,this.pk),this.mk=pt(this.XV-this.ZV,this.JV-this.QV,this.mk)),this.KV=this.qV,this.ZV=this.XV,this.QV=this.JV,this.signalEmit({first:t,last:i,centerClientX:this.GV,centerClientY:this.WV,deltaX:this.qV-this.GV,deltaY:this.XV-this.WV,velocityX:this.pk,velocityY:this.mk},s)}_k(t){this.pI&&(this.pI=!1,this.fk(!1,!0,t),this.signalEnd())}},Tt=new Set(["amp-img","amp-anim","img"]),It=["aria-label","aria-describedby","aria-labelledby"],Rt=c(.4,0,.2,1),Vt=c(.4,0,.2,1),wt=c(.4,0,.2,1.4),yt=class extends t.BaseElement{constructor(t){super(t),this.xB=-1,this.nB=!1,this.DY=!1,this.CY=null,this.XY=null,this.OY=null,this.fn=null,this.YY=null,this.$Y=null,this.kB=this.CB.bind(this),this.registerDefaultAction((t=>this.RL(t)),"open")}buildCallback(){var t;(t=this.element,function(t,i){const s=K(J(t));return tt(s,i)?Q(s,i):null}(t,"action")).addToAllowlist("AMP-IMAGE-LIGHTBOX","open",["email"])}ZY(){if(this.fn)return;this.fn=this.element.ownerDocument.createElement("div"),this.fn.classList.add("i-amphtml-image-lightbox-container"),this.element.appendChild(this.fn),this.YY=new class{constructor(t,i,s){this.LY=t,this.win=i,this.Li=s,this.br=t.element.ownerDocument.createElement("div"),this.br.classList.add("i-amphtml-image-lightbox-viewer"),this.NY=t.element.ownerDocument.createElement("img"),this.NY.classList.add("i-amphtml-image-lightbox-viewer-image"),this.br.appendChild(this.NY),this.BY=null,this.mX=0,this.EX=0,this.UY=M(0,0,0,0),this.GY=M(0,0,0,0),this.RX=1,this.IX=1,this.FY=1,this.VX=1,this.bX=2,this.GV=0,this.WV=0,this.zX=0,this.SX=0,this.kX=0,this.CX=0,this.DX=0,this.XX=0,this.OX=null,this.fY()}getElement(){return this.br}getImage(){return this.NY}getViewerBox(){return this.UY}getImageBox(){return this.GY}getImageBoxWithOffset(){return 0==this.zX&&0==this.SX?this.GY:(t=this.GY,i=this.zX,s=this.SX,0==i&&0==s||0==t.width&&0==t.height?t:M(t.left+i,t.top+s,t.width,t.height));var t,i,s}reset(){this.NY.setAttribute("src",""),It.forEach((t=>{this.NY.removeAttribute(t)})),this.NY.removeAttribute("aria-describedby"),this.BY=null,this.GY=M(0,0,0,0),this.mX=0,this.EX=0,this.FY=1,this.RX=1,this.IX=1,this.bX=2,this.GV=0,this.WV=0,this.zX=0,this.SX=0,this.kX=0,this.CX=0,this.DX=0,this.XX=0,this.OX&&this.OX.halt(),this.OX=null}HY(t,i){i?(this.mX=i.naturalWidth||t.offsetWidth,this.EX=i.naturalHeight||t.offsetHeight):(this.mX=t.offsetWidth,this.EX=t.offsetHeight)}init(t,i){this.HY(t,i),this.BY=function(t){const i=t.getAttribute("srcset");if(i)return function(t){const i=[];let s;for(;s=b.exec(t);){const t=s[1];let h,n;if(s[2]){const t=s[3].toLowerCase();if("w"==t)h=parseInt(s[2],10);else{if("x"!=t)continue;n=parseFloat(s[2])}}else n=1;i.push({url:t,width:h,dpr:n})}return new T(i)}(i);const s=t.getAttribute("src");return p(s,'Either non-empty "srcset" or "src" attribute must be specified: %s',t),new T([{url:s,width:void 0,dpr:1}])}(t),"img"===t.tagName.toLowerCase()?v(It,t,this.NY):t.getImpl().then((t=>v(It,t.element,this.NY))),i&&at(i)&&i.src&&this.NY.setAttribute("src",i.src)}measure(){this.UY=P(this.br.getBoundingClientRect());const t=this.mX/this.EX;let i=Math.min(this.UY.width/t,this.UY.height),s=Math.min(this.UY.height*t,this.UY.width);Math.abs(s-this.mX)<=16&&Math.abs(i-this.EX)<=16&&(s=this.mX,i=this.EX),this.GY=M(Math.round((this.UY.width-s)/2),Math.round((this.UY.height-i)/2),Math.round(s),Math.round(i)),D(this.NY,{top:k(this.GY.top),left:k(this.GY.left),width:k(this.GY.width),height:k(this.GY.height)});const h=this.UY.width/this.UY.height,n=Math.max(h/t,t/h);return this.bX=Math.max(2,n),this.IX=this.RX=1,this.GV=this.zX=0,this.WV=this.SX=0,this.WX(this.RX),this.aY(),this.dC()}dC(){if(!this.BY)return s();this.FY=Math.max(this.FY,this.RX);const t=this.GY.width*this.FY,i=this.BY.select(t,class{static getTop(t){return t.top}static getLocation(t){return t.location}static getDocumentReferrer(t){return t.document.referrer}static getHostname(t){return t.location.hostname}static getUserAgent(t){return t.navigator.userAgent}static getUserLanguage(t){return t.navigator.userLanguage||t.navigator.language}static getDevicePixelRatio(){return self.devicePixelRatio||1}static getSendBeacon(t){if(t.navigator.sendBeacon)return t.navigator.sendBeacon.bind(t.navigator)}static getXMLHttpRequest(t){return t.XMLHttpRequest}static getImage(t){return t.Image}}.getDevicePixelRatio());return i==this.NY.getAttribute("src")?s():st(this.win).promise(1).then((()=>(this.NY.setAttribute("src",i),this.Li(this.NY))))}fY(){const t=lt.get(this.NY);t.onGesture(Mt,(()=>{this.LY.toggleViewMode()})),t.onGesture(Et,(t=>{this.MY(t.data.deltaX,t.data.deltaY,!1),t.data.last&&this.TY(t.data.velocityX,t.data.velocityY)})),t.onPointerDown((()=>{this.OX&&this.OX.halt()})),t.onGesture(Pt,(t=>{let i;i=1==this.RX?this.bX:this.VX;const s=this.UY.width/2-t.data.clientX,h=this.UY.height/2-t.data.clientY;this.kY(i,s,h,!0).then((()=>this.KX(0,0,0,0,0,0)))})),t.onGesture(bt,(t=>{this.jY(t.data.centerClientX,t.data.centerClientY,t.data.deltaX,t.data.deltaY),t.data.last&&this.KX(t.data.centerClientX,t.data.centerClientY,t.data.deltaX,t.data.deltaY,t.data.velocityY,t.data.velocityY)}))}RY(t,i){return B(t,this.VX,this.bX,i?.25:0)}FX(t,i){return B(t,this.kX,this.DX,i&&this.RX>1?.25*this.UY.width:0)}qX(t,i){return B(t,this.CX,this.XX,i?.25*this.UY.height:0)}WX(t){let i=0,s=0;const h=this.UY.height-this.GY.height*t;h>=0?s=i=0:(s=h/2,i=-s);let n=0,e=0;const r=this.UY.width-this.GY.width*t;r>=0?e=n=0:(e=r/2,n=-e),this.kX=e,this.CX=s,this.DX=n,this.XX=i}aY(){D(this.NY,{transform:X(this.zX,this.SX)+" "+O(this.RX)}),1!=this.RX&&this.LY.toggleViewMode(!0)}MY(t,i,s){const h=this.FX(this.GV+t,!0),n=this.qX(this.WV+i,!0);this.JX(this.RX,h,n,s)}TY(t,i){const s=this.SX-this.WV;1==this.RX&&Math.abs(s)>10?this.LY.close():(this.OX=gt(this.NY,this.zX,this.SX,t,i,((t,i)=>{const s=this.FX(t,!0),h=this.qX(i,!0);return!(Math.abs(s-this.zX)<1&&Math.abs(h-this.SX)<1||(this.JX(this.RX,s,h,!1),0))})),this.OX.thenAlways((()=>(this.OX=null,this.dY()))))}jY(t,i,s,h){const n=U(s,h),e=Math.abs(h)>Math.abs(s)?Math.sign(h):Math.sign(-s);if(0==e)return;const r=this.IX*(1+e*n/100),o=this.UY.width/2-t,a=this.UY.height/2-i;s=Math.min(o,o*(n/100)),h=Math.min(a,a*(n/100)),this.kY(r,s,h,!1)}kY(t,i,s,h){const n=this.RY(t,!0);if(n==this.RX)return;this.WX(n);const e=this.FX(this.GV+i*n,!1),r=this.qX(this.WV+s*n,!1);return this.JX(n,e,r,h)}KX(t,i,h,n,e,r){let o;o=0==e&&0==r?s():gt(this.NY,h,n,e,r,((s,h)=>(this.jY(t,i,s,h),!0))).thenAlways();const a=this.RX>this.IX;return o.then((()=>this.dY())).then((()=>{a&&this.dC()}))}JX(t,i,h,n){const e=t-this.RX,r=(o=this.zX,a=this.SX,U(i-o,h-a));var o,a;let c,u=0;if(n){const t=250;u=Math.min(t,Math.max(t*r*.01,t*Math.abs(e)))}if(u>16&&n){const s=$(this.RX,t),n=$(this.zX,i),e=$(this.SX,h);c=rt.animate(this.NY,(t=>{this.RX=s(t),this.zX=n(t),this.SX=e(t),this.aY()}),u,wt).thenAlways((()=>{this.RX=t,this.zX=i,this.SX=h,this.aY()}))}else this.RX=t,this.zX=i,this.SX=h,this.aY(),c=n?s():void 0;return c}dY(){const t=this.RY(this.RX,!1);t!=this.RX&&this.WX(t);const i=this.FX(this.zX/this.RX*t,!1),s=this.qX(this.SX/this.RX*t,!1);return this.JX(t,i,s,!0).then((()=>{this.IX=this.RX,this.GV=this.zX,this.WV=this.SX}))}}(this,this.win,this.loadPromise.bind(this)),this.fn.appendChild(this.YY.getElement()),this.$Y=this.element.ownerDocument.createElement("div"),this.$Y.setAttribute("id",this.element.getAttribute("id")+"-caption"),this.$Y.classList.add("amp-image-lightbox-caption"),this.$Y.classList.add("i-amphtml-image-lightbox-caption"),this.fn.appendChild(this.$Y);const t=this.element.ownerDocument.createElement("button"),i=this.element.getAttribute("data-close-button-aria-label")||"Close the lightbox";t.textContent=i,t.classList.add("i-amphtml-screen-reader"),t.tabIndex=-1,t.addEventListener("click",(()=>{this.close()})),this.element.appendChild(t);const h=lt.get(this.element);this.element.addEventListener("click",(t=>{this.DY||this.YY.getImage().contains(t.target)||this.close()})),h.onGesture(Mt,(()=>{this.DY||this.close()})),h.onGesture(Et,(()=>{}))}RL(t){if(this.nB)return;this.ZY();const i=t.caller,s=i.tagName.toLowerCase();var h,n;h=i&&Tt.has(s),n=i.tagName,(G.user||(G.user=H()),void G.user.win?G.userForEmbed||(G.userForEmbed=H()):G.user).assert(h,"Unsupported element: %s",n,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined),this.nB=!0,this.Qs(),this.tc(i),this.win.document.documentElement.addEventListener("keydown",this.kB),this.getViewport().enterLightboxMode(),this.J_(),this.OY=this.getViewport().onChanged((()=>{var t;this.nB&&((t=this.win,q(t,"platform")).getIosVersionString().startsWith("10.3")?st(this.win).delay((()=>{this.YY.measure()}),500):this.YY.measure())})),this.WY().push(this.close.bind(this)).then((t=>{this.xB=t}))}CB(t){"Escape"==t.key&&(t.preventDefault(),this.close())}close(){this.nB&&(this.nB=!1,this.DY=!1,this.G_(),this.OY&&(this.OY(),this.OY=null),this.getViewport().leaveLightboxMode(),-1!=this.xB&&this.WY().pop(this.xB),this.win.document.documentElement.removeEventListener("keydown",this.kB),this.CY&&function(t){try{t.focus()}catch(t){}}(this.CY))}toggleViewMode(t){void 0!==t?this.fn.classList.toggle("i-amphtml-image-lightbox-view-mode",t):this.fn.classList.toggle("i-amphtml-image-lightbox-view-mode")}tc(t){var i;this.CY=t,this.XY=(i=t,A("img"),i.querySelector("> img".replace(/^|,/g,"$&:scope "))),this.YY.init(this.CY,this.XY);let s=null;const h=t.closest("figure");if(h&&(n=h,A(e="figcaption"),s=n.querySelector(e)),!s){const i=t.getAttribute("aria-describedby");s=this.element.ownerDocument.getElementById(i)}var n,e;s&&(function(t,i){const s=i.ownerDocument.createDocumentFragment();for(let i=t.firstChild;i;i=i.nextSibling)s.appendChild(i.cloneNode(!0));i.appendChild(s)}(s,this.$Y),this.YY.getImage().setAttribute("aria-describedby",this.$Y.getAttribute("id"))),this.$Y.classList.toggle("i-amphtml-empty",!s)}Qs(){this.YY.reset(),function(t){for(;t.firstChild;)t.removeChild(t.firstChild)}(this.$Y),this.CY=null,this.XY=null,this.toggleViewMode(!1)}J_(){var t,i;this.DY=!0,t=this.element,void 0===(i=!0)&&(i=t.hasAttribute("hidden")),i?t.removeAttribute("hidden"):t.setAttribute("hidden",""),D(this.element,{opacity:0}),this.YY.measure();const s=new rt(this.element);s.add(0,z(this.element,{opacity:$(0,1)}),.6,Rt);let h=null;if(this.XY&&at(this.XY)&&this.XY.src){h=this.element.ownerDocument.createElement("div"),h.classList.add("i-amphtml-image-lightbox-trans"),this.getAmpDoc().getBody().appendChild(h);const t=P(this.XY.getBoundingClientRect()),i=this.YY.getImageBox(),n=this.XY.cloneNode(!0);n.className="",D(n,{position:"absolute",top:k(t.top),left:k(t.left),width:k(t.width),height:k(t.height),transformOrigin:"top left",willChange:"transform"}),h.appendChild(n),this.XY.classList.add("i-amphtml-ghost");const e=i.left-t.left,r=i.top-t.top,o=0!=t.width?i.width/t.width:1,a=N(Math.abs(r)/250*.8,.2,.8);s.add(0,z(n,{transform:Y([Z($(0,e),$(0,r)),L($(1,o))])}),a,Rt),D(this.fn,{opacity:0}),s.add(.8,z(this.fn,{opacity:$(0,1)}),.1,Rt),s.add(.9,z(h,{opacity:$(1,.01)}),.1,Vt)}return s.start(500).thenAlways((()=>{this.DY=!1,D(this.element,{opacity:""}),D(this.fn,{opacity:""}),h&&this.getAmpDoc().getBody().removeChild(h)}))}G_(){const t=this.YY.getImage(),i=this.YY.getImageBoxWithOffset(),s=new rt(this.element);let h=500;s.add(0,z(this.element,{opacity:$(1,0)}),.9,Vt);let n=null;if(at(t)&&t.src&&this.XY){n=this.element.ownerDocument.createElement("div"),n.classList.add("i-amphtml-image-lightbox-trans"),this.getAmpDoc().getBody().appendChild(n);const e=P(this.XY.getBoundingClientRect()),r=t.cloneNode(!0);D(r,{position:"absolute",top:k(i.top),left:k(i.left),width:k(i.width),height:k(i.height),transform:"",transformOrigin:"top left",willChange:"transform"}),n.appendChild(r),s.add(0,z(this.fn,{opacity:$(1,0)}),.1,Vt);const o=e.left-i.left,a=e.top-i.top,c=0!=i.width?e.width/i.width:1,u=z(r,{transform:Y([Z($(0,o),$(0,a)),L($(1,c))])}),l=N(Math.abs(a)/250*.8,.2,.8);s.add(Math.min(.8-l,.2),((t,i)=>{u(t),i&&this.XY.classList.remove("i-amphtml-ghost")}),l,Vt),s.add(.8,z(n,{opacity:$(1,.01)}),.2,Vt),h=N(Math.abs(a)/250*h,300,h)}return s.start(h).thenAlways((()=>{this.XY&&this.XY.classList.remove("i-amphtml-ghost"),this.collapse(),D(this.element,{opacity:""}),D(this.fn,{opacity:""}),n&&this.getAmpDoc().getBody().removeChild(n),this.Qs()}))}WY(){return function(t,i){return Q(K(J(t)),"history")}(this.getAmpDoc())}};t.registerElement("amp-image-lightbox",yt,"amp-image-lightbox{position:fixed!important;top:0!important;left:0!important;bottom:0!important;right:0!important;margin:0!important;padding:0!important;overflow:hidden!important;transform:translateZ(0)!important;-ms-touch-action:none!important;touch-action:none!important;z-index:1000;background:rgba(0,0,0,0.95);color:#f2f2f2}.i-amphtml-image-lightbox-container{position:absolute;z-index:0;top:0;left:0;right:0;bottom:0;overflow:hidden;transform:translateZ(0)}.i-amphtml-image-lightbox-trans{pointer-events:none!important;position:fixed;z-index:1001;top:0;left:0;bottom:0;right:0}.i-amphtml-image-lightbox-caption{position:absolute!important;z-index:2;bottom:0!important;left:0!important;right:0!important}.i-amphtml-image-lightbox-caption.i-amphtml-empty,.i-amphtml-image-lightbox-view-mode .i-amphtml-image-lightbox-caption{visibility:hidden}.amp-image-lightbox-caption{background:rgba(0,0,0,0.5);max-height:25%;padding:8px}.i-amphtml-image-lightbox-viewer{position:absolute;z-index:1;top:0;left:0;right:0;bottom:0;overflow:hidden;transform:translateZ(0)}.i-amphtml-image-lightbox-viewer-image{position:absolute;z-index:1;display:block;transform-origin:50% 50%}\n/*# sourceURL=/extensions/amp-image-lightbox/0.1/amp-image-lightbox.css*/")})();
/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */}});
//# sourceMappingURL=amp-image-lightbox-0.1.mjs.map