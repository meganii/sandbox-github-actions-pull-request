;
(self.AMP=self.AMP||[]).push({m:1,v:"2301041800000",n:"amp-access-laterpay",ev:"0.2",l:!0,f:function(t,e){(()=>{var{hasOwnProperty:e,toString:n}=Object.prototype;self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var s,i=self.__AMP_LOG;function r(t){return i.user||(i.user=a()),function(t,e){return e&&e.ownerDocument.defaultView!=t}(i.user.win,t)?i.userForEmbed||(i.userForEmbed=a()):i.user}function a(t){return function(t,e){throw new Error("failed to call initLogConstructor")}()}function c(t,e,n,s,i,r,a,c,o,l,u){return t}function o(t,e,n,s,i,a,c,o,l,u,h){return r().assert(t,e,n,s,i,a,c,o,l,u,h)}function l(){return s||(s=Promise.resolve(void 0))}function u(t,e){return f(t=function(t){return t.__AMP_TOP||(t.__AMP_TOP=t)}(t),e)}function h(t,e){return m(d(t),e)}function p(t){return t.nodeType?(n=t,e=(n.ownerDocument||n).defaultView,u(e,"ampdoc")).getAmpDoc(t):t;var e,n}function d(t){const e=p(t);return e.isSingleDoc()?e.win:e}function f(t,e){c(function(t,e){const n=t.__AMP_SERVICES&&t.__AMP_SERVICES[e];return!(!n||!n.ctor)}(t,e));const n=y(t)[e];return n.obj||(c(n.ctor),c(n.context),n.obj=new n.ctor(n.context),c(n.obj),n.context=null,n.resolve&&n.resolve(n.obj)),n.obj}function m(t,e){const n=y(t)[e];return n?n.promise?n.promise:(f(t,e),n.promise=Promise.resolve(n.obj)):null}function y(t){let e=t.__AMP_SERVICES;return e||(e=t.__AMP_SERVICES={}),e}function _(t,e,n,s){return function(t,e,n,s){const i=h(t,e);if(i)return i;const r=p(t);return r.whenExtensionsKnown().then((()=>{const t=r.getExtensionVersion(n);return t?u(r.win,"extensions").waitForExtension(n,t):null})).then((n=>n?s?h(t,e):function(t,e){return function(t,e){const n=m(t,e);if(n)return n;const s=y(t);return s[e]=function(){const t=new class{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}},{promise:e,reject:n,resolve:s}=t;return e.catch((()=>{})),{obj:null,promise:e,resolve:s,reject:n,context:null,ctor:null}}(),s[e].promise}(d(t),e)}(t,e):null))}(t,e,n,s).then((t=>function(t,e,n){return o(t,"Service %s was requested to be provided through %s, but %s is not loaded in the current page. To fix this problem load the JavaScript file for %s in this page.",e,n,n,n)}(t,e,n)))}var b;function P(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function g(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,s)}return n}function x(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?g(Object(n),!0).forEach((function(e){P(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function A(t,e,n,s){return function(t,e,n,s){let i=t,r=n,a=t=>{try{return r(t)}catch(t){var e,n;throw null===(e=(n=self).__AMP_REPORT_ERROR)||void 0===e||e.call(n,t),t}};const c=function(){if(void 0!==b)return b;b=!1;try{const t={get capture(){return b=!0,!1}};self.addEventListener("test-options",null,t),self.removeEventListener("test-options",null,t)}catch(t){}return b}(),o=!(null==s||!s.capture);return i.addEventListener(e,a,c?s:o),()=>{null==i||i.removeEventListener(e,a,c?s:o),r=null,i=null,a=null}}(t,e,n,s)}function v(t,e,n){if(e[n])return e[n];const s=t.querySelector(`style[${n}], link[${n}]`);return s?(e[n]=s,s):null}function w(t,e){const n=t.styleSheets;for(let t=0;t<n.length;t++)if(n[t].ownerNode==e)return!0;return!1}var R="amp-access-laterpay",I={live:{eu:"https://connector.laterpay.net",us:"https://connector.uselaterpay.com"},sandbox:{eu:"https://connector.sandbox.laterpaytest.net",us:"https://connector.sandbox.uselaterpaytest.com"}},E={payLaterButton:"Buy Now, Pay Later",payNowButton:"Buy Now",defaultButton:"Buy Now",alreadyPurchasedLink:"I already bought this",sandbox:"Site in test mode. No payment required.",laterpayBadgePrefix:"Powered by ",laterpayBadgeSuffix:""};t.registerServiceForDoc("laterpay",(function(t){return(e=t.getHeadNode(),_(e,"access","amp-access")).then((t=>{const e=t.getVendorSource("laterpay"),n=new class{constructor(t,e){this.ampdoc=t.ampdoc,this.u$=e,this.Tc=function(t,e){return f(d(p(t)),"viewport")}(this.ampdoc),this.nut=this.u$.getAdapterConfig(),this.sut=null,this.oft=null,this.iut=null,this.xft=null,this.rut=[],this.dft=!0,this.tft=null,this.aut=null,this.cut=null,this.out=this.nut.locale||"en",this.sft=x(x({},E),this.nut.localeMessages||{}),this.lut=this.uut()+"/api/v2/fetch/amp/?article_url=CANONICAL_URL&amp_reader_id=READER_ID&return_url=RETURN_URL";const n=this.nut.articleId;n&&(this.lut+="&article_id="+encodeURIComponent(n));const s=this.nut.jwt;s&&(this.lut+="&jwt="+encodeURIComponent(s)),this.Qe=f(this.ampdoc.win,"timer"),this.Xh=(t=>u(this.ampdoc.win,"vsync"))(),this.f$=(t=>u(this.ampdoc.win,"xhr"))(),function(t,e,n,s,i){const r=t.getHeadNode(),a=function(t,e,n,s){let i=t.__AMP_CSS_SM;i||(i=t.__AMP_CSS_SM=Object.create(null));const r=`amp-extension=${s}`;if(r){const n=v(t,i,r);if(n)return"STYLE"==n.tagName&&n.textContent!==e&&(n.textContent=e),n}const a=(t.ownerDocument||t).createElement("style");a.textContent=e;let c=null;return a.setAttribute("amp-extension",s),c=v(t,i,"amp-runtime"),function(t,e,n=null){if(!n)return void function(t,e){t.insertBefore(e,t.firstChild)}(t,e);const s=n.nextSibling;t.insertBefore(e,s)}(t,a,c),r&&(i[r]=a),a}(r,function(t,e){const n=t.__AMP_CSS_TR;return n?n(e):e}(r,".amp-access-laterpay{position:relative}@media (min-width:420px){.amp-access-laterpay{width:420px}}.amp-access-laterpay ul{width:100%;padding:0;margin:0 0 40px}.amp-access-laterpay li{list-style:none;display:-ms-flexbox;display:flex;margin-bottom:20px}.amp-access-laterpay label{display:-ms-flexbox;display:flex;padding-right:10px}.amp-access-laterpay input{width:20px}.amp-access-laterpay-container{padding:16px 24px 16px 16px;display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;-ms-flex-align:center;align-items:center;border-radius:12px;box-shadow:0 0 10px -1px rgba(0,0,0,.25)}.amp-access-laterpay-sandbox{width:112%;padding:15px 10px;background-color:#f2902a;color:#fff;font-weight:700;text-align:center}.amp-access-laterpay-badge{text-align:center;color:#999}.amp-access-laterpay-badge a{color:#8db444}.amp-access-laterpay-header{font-size:1.2em;margin-bottom:40px}.amp-access-laterpay-metadata{width:92%}.amp-access-laterpay-title{font-size:1.1em;margin:0;padding:0}.amp-access-laterpay-description{font-size:0.9em;margin:0;padding:0}.amp-access-laterpay-price-container{margin-top:0;margin-left:auto}.amp-access-laterpay-price{font-size:1.5em}.amp-access-laterpay-currency{font-size:0.7em}.amp-access-laterpay-purchase-button{font-size:1.1em;padding:0.5em 0.8em;background-color:#8db444;border-radius:4px;border:0;color:#fff;width:70%}.amp-access-laterpay-already-purchased-link-container{font-size:0.9em}\n/*# sourceURL=/extensions/amp-access-laterpay/0.2/amp-access-laterpay.css*/"),0,"amp-access-laterpay");if(n){const e=t.getRootNode();if(w(e,a))return a;const n=setInterval((()=>{w(e,a)&&clearInterval(n)}),4)}}(this.ampdoc,0,(()=>{}))}uut(){const t=this.nut.region||"eu";return this.nut.sandbox?I.sandbox[t]:I.live[t]}authorize(){return this.hut().then((t=>{if(204===t.status)throw r().createError("No merchant domains have been matched for this article, or no paid content configurations are setup.");return this.nut.scrollToTopAfterAuth&&this.Xh.mutate((()=>this.Tc.setScrollTop(0))),this.fft(),{access:t.access}}),(t=>{if(!t||!t.response)throw t;const{response:e}=t;if(402!==e.status)throw t;return e.json().catch((()=>{})).then((t=>(this.sut=t,this.oft=this.dut(t.purchase_options),this.fft().then(this.hft.bind(this)),{access:!1})))}))}hut(){const t=this.lut+"&article_title="+encodeURIComponent(this.fut());return this.u$.buildUrl(t,!1).then((t=>this.u$.getLoginUrl(t))).then((t=>this.Qe.timeoutPromise(3e3,this.f$.fetchJson(t,{credentials:"include"})).then((t=>t.json()))))}dut(t){const e=this.fut(),n={};return n.singlePurchases=t.filter((t=>"single_purchase"===t.sales_model)),n.singlePurchases.forEach((t=>t.description=e)),n.timepasses=t.filter((t=>"timepass"===t.sales_model)),n.subscriptions=t.filter((t=>"subscription"===t.sales_model)),n}mut(t){return this.ampdoc.win.document.createElement(t)}fut(){const t=this.ampdoc.getRootNode().querySelector(this.nut.articleTitleSelector);return o(t,"No article title element found with selector %s",this.nut.articleTitleSelector),t.textContent.trim()}E$(){const t=R+"-dialog",e=this.ampdoc.getElementById(t);return r().assertElement(e,"No element found with id "+t)}fft(){if(this.dft)return l();let t;for(;t=this.rut.shift();)t();return this.iut&&(this.iut(),this.iut=null),this.xft&&(this.xft(),this.xft=null),this.Xh.mutatePromise((()=>{this.dft=!0,this.tft=null,function(t){for(;t.firstChild;)t.removeChild(t.firstChild)}(this.E$())}))}hft(){const t=this.E$();this.tft=this.mut("div"),this.tft.className=R+"-container",this.nut.sandbox&&this.yut("sandbox"),this.yut("header");const e=this.mut("ul");this.oft.singlePurchases.forEach((t=>{e.appendChild(this._ut(t))})),this.oft.timepasses.forEach((t=>{e.appendChild(this._ut(t))})),this.oft.subscriptions.forEach((t=>{e.appendChild(this._ut(t))}));const n=this.mut("button");n.className=R+"-purchase-button",n.textContent=this.sft.defaultButton,this.cut=n,this.iut=A(n,"click",(t=>{const{value:e}=this.aut,n=this.aut.dataset.purchaseType;this.Pft(t,e,n)})),this.tft.appendChild(e),this.tft.appendChild(n),this.tft.appendChild(this.but(this.sut.identify_url)),this.yut("footer"),t.appendChild(this.tft),t.appendChild(this.Put()),this.dft=!1,this.gut(e.firstElementChild)}gut(t){const e=t.querySelector('input[type="radio"]');e.checked=!0,this.xut(e)}yut(t){if(this.sft[t]){const e=this.mut("p");e.className=R+"-"+t,e.textContent=this.sft[t],this.tft.appendChild(e)}}Put(){const t=this.mut("a");t.href="https://blog.laterpay.net/laterpay-academy/what-is-laterpay",t.target="_blank",t.textContent="LaterPay";const e=this.mut("p"),n=this.mut("span");n.textContent=this.sft.laterpayBadgePrefix;const s=this.mut("span");return s.textContent=this.sft.laterpayBadgeSuffix,e.className=R+"-badge",e.appendChild(n),e.appendChild(t),e.appendChild(s),e}_ut(t){const e=this.mut("li"),n=this.mut("label");n.for=t.title,n.appendChild(this.Aut(t));const s=this.mut("div");s.className=R+"-metadata";const i=this.mut("span");i.className=R+"-title",i.textContent=t.title,s.appendChild(i);const r=this.mut("p");return r.className=R+"-description",r.textContent=t.description,s.appendChild(r),n.appendChild(s),e.appendChild(n),e.appendChild(this.vut(t.price)),e}Aut(t){const e=this.mut("input");e.name="purchaseOption",e.type="radio",e.id=t.title,e.value=t.purchase_url;const n="pay_later"===t.price.payment_model?"payLater":"payNow",s=this.sft[n+"Button"];return e.setAttribute("data-purchase-action-label",s),e.setAttribute("data-purchase-type",n),this.rut.push(A(e,"change",this.wut.bind(this))),e}vut(t){const e=this.Rut(t.amount),n=this.mut("span");n.className=R+"-price",n.textContent=e;const s=this.mut("sup");s.className=R+"-currency",s.textContent=t.currency;const i=this.mut("p");return i.className=R+"-price-container",i.appendChild(n),i.appendChild(s),i}Rut(t){return(t/100).toLocaleString(this.out,{style:"decimal",minimumFractionDigits:0})}but(t){const e=this.mut("p");e.className=R+"-already-purchased-link-container";const n=this.mut("a");return n.href=t,n.textContent=this.sft.alreadyPurchasedLink,this.xft=A(n,"click",(e=>{this.Pft(e,t,"alreadyPurchased")})),e.appendChild(n),e}wut(t){t.preventDefault(),this.xut(t.target)}xut(t){const e=R+"-selected",n=this.aut,s=t.dataset.purchaseActionLabel;n&&n.classList.contains(e)&&n.classList.remove(e),this.aut=t,this.aut.classList.add(e),this.cut.textContent=s}Pft(t,e,n){return t.preventDefault(),this.u$.buildUrl(e,!1).then((t=>{this.u$.loginWithUrl(t,n)}))}pingback(){return l()}}(t,e);return e.getAdapter().registerVendor(n),n}));var e}))})();
/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */}});
//# sourceMappingURL=amp-access-laterpay-0.2.mjs.map