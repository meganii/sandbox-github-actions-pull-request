;
(self.AMP=self.AMP||[]).push({m:1,v:"2301041800000",n:"amp-access-poool",ev:"0.1",l:!0,f:function(t,n){(()=>{var{isArray:n}=Array,{hasOwnProperty:r,toString:o}=Object.prototype;function i(t,n){try{return function(t){return JSON.parse(t)}(t)}catch(t){return null==n||n(t),null}}function e(t){const n=Object.getOwnPropertyDescriptor(t,"message");if(null!=n&&n.writable)return t;const{message:r,stack:o}=t,i=new Error(r);for(const n in t)i[n]=t[n];return i.stack=o,i}function s(t){let n=null,r="";for(const t of arguments)t instanceof Error&&!n?n=e(t):(r&&(r+=" "),r+=t);return n?r&&(n.message=r+": "+n.message):n=new Error(r),n}function u(t){var n,r;null===(n=(r=self).__AMP_REPORT_ERROR)||void 0===n||n.call(r,t)}self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var c,l=self.__AMP_LOG;function f(t){return l.user||(l.user=h()),function(t,n){return n&&n.ownerDocument.defaultView!=t}(l.user.win,t)?l.userForEmbed||(l.userForEmbed=h()):l.user}function h(t){return function(t,n){throw new Error("failed to call initLogConstructor")}()}function a(t,n,r,o,i,e,s,u,c,l,f){return t}function p(t,n,r,o,i,e,s,u,c,l,h){return f().assert(t,n,r,o,i,e,s,u,c,l,h)}function d(t,n){return P(t=function(t){return t.__AMP_TOP||(t.__AMP_TOP=t)}(t),n)}function m(t,n){return P(A(_(t)),n)}function v(t,n){return w(A(t),n)}function _(t){return t.nodeType?(r=t,n=(r.ownerDocument||r).defaultView,d(n,"ampdoc")).getAmpDoc(t):t;var n,r}function A(t){const n=_(t);return n.isSingleDoc()?n.win:n}function P(t,n){a(function(t,n){const r=t.__AMP_SERVICES&&t.__AMP_SERVICES[n];return!(!r||!r.ctor)}(t,n));const r=E(t)[n];return r.obj||(a(r.ctor),a(r.context),r.obj=new r.ctor(r.context),a(r.obj),r.context=null,r.resolve&&r.resolve(r.obj)),r.obj}function w(t,n){const r=E(t)[n];return r?r.promise?r.promise:(P(t,n),r.promise=Promise.resolve(r.obj)):null}function E(t){let n=t.__AMP_SERVICES;return n||(n=t.__AMP_SERVICES={}),n}function R(t,n,r,o){return function(t,n,r,o){const i=v(t,n);if(i)return i;const e=_(t);return e.whenExtensionsKnown().then((()=>{const t=e.getExtensionVersion(r);return t?d(e.win,"extensions").waitForExtension(r,t):null})).then((r=>r?o?v(t,n):function(t,n){return function(t,n){const r=w(t,n);if(r)return r;const o=E(t);return o[n]=function(){const t=new class{constructor(){this.promise=new Promise(((t,n)=>{this.resolve=t,this.reject=n}))}},{promise:n,reject:r,resolve:o}=t;return n.catch((()=>{})),{obj:null,promise:n,resolve:o,reject:r,context:null,ctor:null}}(),o[n].promise}(A(t),n)}(t,n):null))}(t,n,r,o).then((t=>function(t,n,r){return p(t,"Service %s was requested to be provided through %s, but %s is not loaded in the current page. To fix this problem load the JavaScript file for %s in this page.",n,r,r,r)}(t,n,r)))}var g,b,I=["Webkit","webkit","Moz","moz","ms","O","o"];function M(t,n,r,o,i){const e=function(t,n,r){if(n.startsWith("--"))return n;g||(g=Object.create(null));let o=g[n];if(!o||r){if(o=n,void 0===t[n]){const r=function(t){return t.charAt(0).toUpperCase()+t.slice(1)}(n),i=function(t,n){for(let r=0;r<I.length;r++){const o=I[r]+n;if(void 0!==t[o])return o}return""}(t,r);void 0!==t[i]&&(o=i)}r||(g[n]=o)}return o}(t.style,n,i);if(!e)return;const s=o?r+o:r;t.style.setProperty(function(t){const n=t.replace(/[A-Z]/g,(t=>"-"+t.toLowerCase()));return I.some((t=>n.startsWith(t+"-")))?`-${n}`:n}(e),s)}function T(t,n){for(const r in n)M(t,r,n[r])}function O(t){return"string"==typeof t&&t.startsWith("amp-")&&-1!=t.indexOf("{")}function $(t){return t.data}function k(t,n,r){if(!n)return t;const o=t.split("#",2),i=o[0].split("?",2);let e=i[0]+(i[1]?r?`?${n}&${i[1]}`:`?${i[1]}&${n}`:`?${n}`);return e+=o[1]?`#${o[1]}`:"",e}function C(t,n){return`${encodeURIComponent(t)}=${encodeURIComponent(n)}`}new Set(["c","v","a","ad"]);var j="unlisten";function x(t,n,r){const o=function(t,n){let{listeningFors:r}=t;return!r&&n&&(r=t.listeningFors=Object.create(null)),r||null}(t,r);if(!o)return o;let i=o[n];return!i&&r&&(i=o[n]=[]),i||null}function y(t,n){for(let r=n;r&&r!=r.parent;r=r.parent)if(r==t)return!0;return!1}function D(t){const n={"sentinel":j};for(let r=t.length-1;r>=0;r--){const o=t[r];if(!o.frame.contentWindow){t.splice(r,1);const{events:i}=o;for(const t in i)i[t].splice(0,1/0).forEach((t=>{t(n)}))}}}function V(t,n,r,o,e,c){a(t.src),a(!t.parentNode),a(r);const l=t.ownerDocument.defaultView;!function(t){t.listeningFors||t.addEventListener("message",(function(n){if(!$(n))return;const r=function(t){return"string"==typeof t&&(t="{"==t.charAt(0)?i(t,(t=>{}))||null:O(t)?function(t){if(!O(t))return null;const n=t.indexOf("{");return i(t.substr(n),(n=>{!function(t){const n=s.apply(null,arguments);setTimeout((()=>{throw u(n),n}))}(new Error(`MESSAGING: Failed to parse message: ${t}\n${n.message}`))}))}(t):null),t}($(n));if(!r||!r.sentinel)return;const o=function(t,n,r,o){const i=x(t,n);if(!i)return i;let e;for(let t=0;t<i.length;t++){const n=i[t],{contentWindow:r}=n.frame;if(r){if(o==r||y(r,o)){e=n;break}}else setTimeout(D,0,i)}return e?e.events:null}(t,r.sentinel,n.origin,n.source);if(!o)return;let e=o[r.type];if(e){e=e.slice();for(let t=0;t<e.length;t++)(0,e[t])(r,n.source,n.origin,n)}}))}(l);const f=function(t,n,r){const o=function(t,n){return n?t.getAttribute("data-amp-3p-sentinel"):"amp"}(n,r),i=x(t,o,!0);let e;for(let t=0;t<i.length;t++){const r=i[t];if(r.frame===n){e=r;break}}return e||(e={frame:n,events:Object.create(null)},i.push(e)),e.events}(l,t,o),h=(p=t.src,b||(b=self.document.createElement("a")),function(t,n,r){return t.href="",new URL(n,t.href)}(b,p)).origin;var p;let d,m=f[n]||(f[n]=[]),v=function(n,o,i,s){if("amp"==n.sentinel){if(o!=t.contentWindow)return;const n="null"==i&&c;if(h!=i&&!n)return}(e||o==t.contentWindow)&&(n.sentinel!=j?r(n,o,i,s):d())};return m.push(v),d=function(){if(v){const t=m.indexOf(v);t>-1&&m.splice(t,1),v=null,m=null,r=null}}}t.registerServiceForDoc("poool",(function(t){return(r=t.getHeadNode(),R(r,"access","amp-access")).then((t=>{const r=t.getVendorSource("poool"),o=new class{constructor(t,n){this.ampdoc=t.ampdoc,this.u$=n,this.ja=m(this.ampdoc,"mutator"),this.c$="https://api.poool.fr/api/v3/amp/access?rid=READER_ID",this.l$="https://assets.poool.fr/amp.html?rid=READER_ID&c=CANONICAL_URL&o=AMPDOC_URL&r=DOCUMENT_REFERRER",this.Qe=P(this.ampdoc.win,"timer"),this.f$=(t=>d(this.ampdoc.win,"xhr"))(),this.h$=(t=>m(this.ampdoc,"navigation"))(),this.p$=this.u$.getAdapterConfig(),this.d$=this.p$.bundleID||"",this.m$="",this.v$=this.p$.itemID||"",this.Lv=this.ampdoc.win.document.createElement("iframe"),this._$(),this.A$()}authorize(){return this.P$().then((t=>({access:t.access})),(t=>{if(!t||!t.response)throw t;const{response:n}=t;if(402!==n.status)throw t;return this.w$(),{access:!1}}))}_$(){this.Lv.setAttribute("id","poool-iframe"),this.Lv.setAttribute("scrolling","no"),this.Lv.setAttribute("frameborder","0"),M(this.Lv,"width","100%"),"unlock"==this.p$.forceWidget?T(this.Lv,{"height":"250px","position":"fixed","bottom":"0"}):T(this.Lv,{"height":"500px","transform":"translateY(-70px)"})}A$(){p(this.d$,"BundleID is incorrect or not provided."),p(this.v$,"ItemID is not provided.")}P$(){const t=function(t,n,r,o){return k(t,C("iid",r),void 0)}(this.c$,0,this.v$);return this.u$.buildUrl(t,!1).then((t=>this.u$.getLoginUrl(t))).then((t=>this.Qe.timeoutPromise(3e3,this.f$.fetchJson(t)).then((t=>t.json()))))}E$(){const t=this.ampdoc.getElementById("poool");return f().assertElement(t,"No element with id #poool found to render paywall into, got")}w$(){const t=this.E$();return this.u$.buildUrl((r=this.l$,o={"bi":this.p$.bundleID,"iid":this.p$.itemID,"ce":this.p$.cookiesEnabled,"d":void 0!==this.p$.debug&&null!==this.p$.debug&&this.p$.debug,"fw":this.p$.forceWidget,"cs":this.p$.customSegment,"lo":this.p$.locale,"co":this.p$.context},k(r,function(t){const r=[];for(const i in t){let e=t[i];if(null!=e){e=n(o=e)?o:[o];for(let t=0;t<e.length;t++)r.push(C(i,e[t]))}}var o;return r.join("&")}(o))),!1).then((n=>{this.Lv.src=n,V(this.Lv,"release",this.R$.bind(this)),V(this.Lv,"resize",this.Xw.bind(this)),V(this.Lv,"click",this.Iw.bind(this)),t.appendChild(this.Lv)}));var r,o}R$(){const t=this.ampdoc.getRootNode().querySelector("[poool-access-preview]");t&&this.ja.mutateElement(t,(()=>{t.setAttribute("amp-access-hide","")}));const n=this.ampdoc.getRootNode().querySelector("[poool-access-content]");n&&this.ja.mutateElement(n,(()=>{n.removeAttribute("amp-access-hide")})),function(t,n){for(let r=0;r<n.length;r++)M(t,n[r],null)}(this.Lv,["transform"])}Xw(t){M(this.Lv,"height",t.height)}Iw(t){t.url&&this.h$.navigateTo(this.ampdoc.win,t.url)}pingback(){return c||(c=Promise.resolve(void 0))}}(t,r);return r.getAdapter().registerVendor(o),o}));var r}))})();
/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */}});
//# sourceMappingURL=amp-access-poool-0.1.mjs.map