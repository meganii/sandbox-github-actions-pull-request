;
var e=(e,t,r)=>new Promise(((o,n)=>{var a=e=>{try{s(r.next(e))}catch(e){n(e)}},l=e=>{try{s(r.throw(e))}catch(e){n(e)}},s=e=>e.done?o(e.value):Promise.resolve(e.value).then(a,l);s((r=r.apply(e,t)).next())}));import{PreactBaseElement as t}from"../bento.mjs";function r(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function n(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}import{createElement as a}from"../bento.mjs";import{Fragment as l,cloneElement as s,isValidElement as i,useEffect as u,useImperativeHandle as c,useMemo as f,useRef as m}from"../bento.mjs";import{forwardRef as d}from"../bento.mjs";import{ContainWrapper as p}from"../bento.mjs";var{hasOwnProperty:b,toString:g}=Object.prototype;function h(e){return(e.ownerDocument||e).defaultView}function v(e,t,r={}){const{needsRootBounds:o,rootMargin:n,threshold:a}=r,l=function(e){return e.parent&&e.parent!=e}(t)&&(o||n)?t.document:void 0;return new t.IntersectionObserver(e,{threshold:a,root:l,rootMargin:n})}var j=new WeakMap,M=new WeakMap;function y(e){const t=new Set;for(let r=e.length-1;r>=0;r--){const o=e[r],{target:n}=o;if(t.has(n))continue;t.add(n);const a=M.get(n);if(a)for(let e=0;e<a.length;e++)(0,a[e])(o)}}import{useCallback as P,useEffect as w,useRef as O,useState as k}from"../bento.mjs";import{useAmpContext as x}from"../bento.mjs";import{useCallback as T,useRef as B}from"../bento.mjs";import{useValueRef as S}from"../bento.mjs";import{useCallback as I,useEffect as R,useRef as L,useState as N}from"../bento.mjs";var C={loading:!1,error:null,pages:[],hasMore:!0},E={fetchJson(e,t){return this.fetch(e,t).then((e=>e.json()))},fetch(t,r){return e(this,null,(function*(){const e=yield self.fetch(t,r);if(!e.ok)throw new Error(e.statusText);return e}))}},J={loadMoreSpinner:"load-more-spinner-cc33818",loadMoreIcon:"load-more-icon-cc33818"},K=["src","fetchJson","itemsKey","maxItems","loadMore","loadMoreBookmark","viewportBuffer","template","wrapperTemplate","loadMoreTemplate","loadingTemplate","errorTemplate"],W=e=>a("div",null,String(e)),A=e=>a("div",null,e),H=(e,t)=>a("div",null,"Unable to Load More ",a("button",{"load-more-retry":!0},a("label",null,a("span",{class:e.loadMoreIcon})," Retry"))),U=()=>a("div",null,a("button",{"load-more-button":!0},a("label",null,"See More"))),$=e=>a("div",null,a("span",{"aria-label":"Loading",class:e.loadMoreSpinner}));function q(e,t){return t.split(".").reduce(((e,t)=>e&&""!==t?e[t]:e),e)}var z=d((function(t,r){let{src:o=null,fetchJson:s=E.fetchJson,itemsKey:i="items",maxItems:d=0,loadMore:b="none",loadMoreBookmark:g="load-more-src",viewportBuffer:P=2,template:O=W,wrapperTemplate:z=A,loadMoreTemplate:F=U,loadingTemplate:G=$,errorTemplate:Q=H}=t,V=function(e,t){if(null==e)return{};var r,o,n={},a=Object.keys(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||(n[r]=e[r]);return n}(t,K);const{renderable:X}=x(),Y=f((()=>({rootMargin:`0% 0% ${Math.floor(100*P)}% 0%`,threshold:0})),[P]),Z=m(null),_=function(e,t){const[r,o]=k(!1);return w((()=>{const r=e.current;if(r)return function(e,t,r){const o=h(e);if(r){const n=v((e=>{t(e[e.length-1])}),o,r);return n.observe(e),()=>{n.unobserve(e)}}let n=j.get(o);n||j.set(o,n=v(y,o));let a=M.get(e);return a||(a=[],M.set(e,a)),a.push(t),n.observe(e),()=>{!function(e,t){const r=M.get(e);if(!r)return;if(!function(e,t){const r=e.indexOf(t);return-1!=r&&(e.splice(r,1),!0)}(r,t))return;if(r.length)return;const o=h(e),n=j.get(o);null==n||n.unobserve(e),M.delete(e)}(e,t)}}(r,(e=>{o(e.isIntersecting)}),t)}),[e,t]),r}(Z,Y),{error:ee,hasMore:te,loadMore:re,loading:oe,pages:ne,reset:ae}=function({fetchPage:t,getNextPageParam:r}){const[o,a]=function(e){const t=L(!1);R((()=>(t.current=!0,()=>{t.current=!1})),[]);const[r,o]=N(e);return[r,I((e=>{t.current&&o(e)}),[o])]}(C),l=S({fetchPage:t,getNextPageParam:r,state:o}),s=B(0),i=T(((t=!1)=>e(this,null,(function*(){const{fetchPage:e,getNextPageParam:r,state:o}=l.current;if(!t&&o.loading)return;const i=++s.current;a((e=>n(n({},e),{},{loading:!0})));const u=t?[]:o.pages,c=u.length?u[u.length-1]:void 0;try{const t=yield e({pageParam:c?r(c):void 0});if(i!==s.current)return;const o=r(t);a({loading:!1,error:null,pages:[...u,t],hasMore:null!=o})}catch(e){if(i!==s.current)return;a((t=>n(n({},t),{},{loading:!1,error:e})))}}))),[l,a]),u=T((()=>i(!0)),[i]);return n(n({},o),{},{loadMore:i,reset:u})}({fetchPage:t=>e(this,[t],(function*({pageParam:e=o}){return X?yield s(e):null})),getNextPageParam:e=>function(e,t){return q(e,t)}(e,g)});u((()=>{ae()}),[o,X,g,ae]);const le=X&&"auto"===b&&_&&!oe&&te;u((()=>{le&&re()}),[le,re]);const se=f((()=>{let e=ne.flatMap((e=>function(e,t){if(!e)return[];let r=q(e,t);return r?(Array.isArray(r)||(r=[r]),r):[]}(e,i)));return d>0&&e.length>d&&(e=e.slice(0,d)),e.map(((e,t)=>{let r=O(e);return r&&"object"==typeof r&&"string"==typeof r.__html&&(r=a("span",{dangerouslySetInnerHTML:r})),D(r,{"key":t,"role":"listitem"})}))}),[ne,i,d,O]),ie=oe,ue=0!==se.length,ce="manual"===b&&te&&!oe;c(r,(()=>({refresh:ae})),[ae]);const fe=J;return a(p,n(n({"aria-live":"polite"},V),{},{onClick:e=>{e.target.closest("[load-more-button], [load-more-retry]")&&re()}}),a(l,{"test-id":"contents"},ue&&D(z(se),{"role":"list"}),ie&&G(fe),ce&&F(fe),ee&&Q(fe,ee),"auto"===b&&a("span",{ref:Z})))}));function D(e,t){return i(e)?s(e,n(n({},t),e.props)):e}z.displayName="List";var F=class extends t{};F.Component=z,F.props={"src":{attr:"src"},"itemsKey":{attr:"items"},"maxItems":{attr:"max-items",type:"number"},"loadMore":{attr:"load-more"},"loadMoreBookmark":{attr:"load-more-bookmark"},"viewportBuffer":{attr:"viewport-buffer",type:"number"}},F.layoutSizeDefined=!0,F.usesShadowDom=!0,F.usesTemplate=!0;import{defineBentoElement as G}from"../bento.mjs";G("bento-list",F,void 0);
/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */
//# sourceMappingURL=bento-list-1.0.mjs.map