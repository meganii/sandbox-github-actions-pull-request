;
!function(){Array.isArray;var t=Object.prototype;function i(t){var i=Object.create(null);return t&&Object.assign(i,t),i}t.hasOwnProperty,t.toString;var n=/(\0)|^(-)$|([\x01-\x1f\x7f]|^-?[0-9])|([\x80-\uffff0-9a-zA-Z_-]+)|[^]/g;function e(t,i,n,e,r){return r||(i?"ï¿½":e?t.slice(0,-1)+"\\"+t.slice(-1).charCodeAt(0).toString(16)+" ":"\\"+t)}var r=/(?:^[#?]?|&)([^=&]+)(?:=([^&]*))?/g;function s(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";try{return decodeURIComponent(t)}catch(t){return i}}var o="amp-web-push";function a(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var h=self.__AMP_LOG;function c(){return h.dev||(h.dev=function(t,i){throw new Error("failed to call initLogConstructor")}())}function u(t){return t.data}var f,l,d=function(){function t(t){this.Lt=t,this.Wt=0,this.Kt=0,this.Qt=i()}var n=t.prototype;return n.has=function(t){return!!this.Qt[t]},n.get=function(t){var i=this.Qt[t];if(i)return i.access=++this.Kt,i.payload},n.put=function(t,i){this.has(t)||this.Wt++,this.Qt[t]={payload:i,access:this.Kt},this.Xt()},n.Xt=function(){if(!(this.Wt<=this.Lt)){var t,i=this.Qt,n=this.Kt+1;for(var e in i){var r=i[e].access;r<n&&(n=r,t=e)}void 0!==t&&(delete i[t],this.Wt--)}},t}();function v(t,i){return f||(f=self.document.createElement("a"),l=self.__AMP_URL_CACHE||(self.__AMP_URL_CACHE=new d(100))),function(t,i,n){if(n&&n.has(i))return n.get(i);t.href=i,t.protocol||(t.href=t.href);var e,r={href:t.href,protocol:t.protocol,host:t.host,hostname:t.hostname,port:"0"==t.port?"":t.port,pathname:t.pathname,search:t.search,hash:t.hash,origin:null};"/"!==r.pathname[0]&&(r.pathname="/"+r.pathname),("http:"==r.protocol&&80==r.port||"https:"==r.protocol&&443==r.port)&&(r.port="",r.host=r.hostname),e=t.origin&&"null"!=t.origin?t.origin:"data:"!=r.protocol&&r.host?r.protocol+"//"+r.host:r.href,r.origin=e;var s=r;return n&&n.put(i,s),s}(f,t,i?null:l)}new Set(["c","v","a","ad"]);var w=function(){function t(t){t||(t={debug:!1,windowContext:window}),this.St={},this.Rr={},this.Or=t.debug,this.Cr=!1,this.Pr=!1,this.Tr=!1,this._r=null,this.jr=null,this.kr=null,this.Nr=null,this.Ur=null,this.Lr=t.windowContext||window}var i,n,e=t.prototype;return e.listen=function(i){var n=this;return new Promise((function(t,e){n.Tr?e(new Error("Already connected.")):n.Cr?e(new Error("Already listening for connections.")):Array.isArray(i)?(n.kr=n.Wr.bind(n,i,t,e),n.Lr.addEventListener("message",n.kr),n.Or&&c().fine(o,"Listening for a connection message...")):e(new Error("allowedOrigins should be a string array of allowed origins to accept messages from. Got:",i))})).then((function(){n.send(t.Topics.CONNECT_HANDSHAKE,null),n.Tr=!0}))},e.Dr=function(t,i){for(var n=v(t).origin,e=0;e<i.length;e++)if(v(i[e]).origin===n)return!0;return!1},e.Wr=function(i,n,e,r){var s=u(r),a=r.origin,h=r.ports;this.Or&&c().fine(o,"Window message for listen() connection received:",s),this.Dr(a,i)?s&&s.topic===t.Topics.CONNECT_HANDSHAKE?(c().fine(o,"Received expected connection handshake message:",s),this.Lr.removeEventListener("message",this.kr),this.jr=h[0],this.Ur=this.Fr.bind(this),this.jr.addEventListener("message",this.Ur,!1),this.jr.start(),n()):c().fine(o,"Discarding connection message because it did not contain our expected handshake:",s):c().fine(o,"Discarding connection message from ".concat(a," ")+"because it isn't an allowed origin:",s," (allowed  origins are)",i)},e.connect=function(i,n){var e=this;return new Promise((function(r,s){i||s(new Error("Provide a valid Window context to connect to.")),n||s(new Error("Provide an expected origin for the remote Window or provide the wildcard *.")),e.Tr?s(new Error("Already connected.")):e.Pr?s(new Error("Already connecting.")):(e._r=new MessageChannel,e.jr=e._r.port1,e.Nr=e.Gr.bind(e,e.jr,n,r),e.jr.addEventListener("message",e.Nr),e.jr.start(),i.postMessage({topic:t.Topics.CONNECT_HANDSHAKE},"*"===n?"*":v(n).origin,[e._r.port2]),c().fine(o,"Opening channel to ".concat(n,"...")))}))},e.Gr=function(t,i,n){this.Tr=!0,this.Or&&c().fine(o,"Messenger channel to ".concat(i," established.")),t.removeEventListener("message",this.Nr),this.Ur=this.Fr.bind(this),t.addEventListener("message",this.Ur,!1),n()},e.Fr=function(t){var i=u(t);if(this.St[i.id]&&i.isReply){var n=this.St[i.id];delete this.St[i.id];var e=n.promiseResolver;n.message=i.data,this.Or&&c().fine(o,"Received reply for topic '%s': %s",i.topic,i.data),e([i.data,this.Kr.bind(this,i.id,n.topic)])}else{var r=this.Rr[i.topic];if(!r)return;this.Or&&c().fine(o,"Received new message for "+"topic '".concat(i.topic,"': ").concat(i.data));for(var s=0;s<r.length;s++)(0,r[s])(i.data,this.Kr.bind(this,i.id,i.topic))}},e.on=function(t,i){this.Rr[t]?this.Rr[t].push(i):this.Rr[t]=[i]},e.off=function(t,i){if(i){var n=this.Rr[t].indexOf(i);-1!==n&&this.Rr[t].splice(n,1)}else this.Rr[t]&&delete this.Rr[t]},e.Kr=function(t,i,n){var e=this,r={id:t,topic:i,data:n,isReply:!0};return this.jr.postMessage(r),new Promise((function(t){e.St[r.id]={message:n,topic:i,promiseResolver:t}}))},e.send=function(t,i){var n=this,e={id:crypto.getRandomValues(new Uint8Array(10)).join(""),topic:t,data:i};return this.Or&&c().fine(o,"Sending %s: %s",t,i),this.jr.postMessage(e),new Promise((function(r){n.St[e.id]={message:i,topic:t,promiseResolver:r}}))},i=t,(n=[{key:"Topics",get:function(){return{CONNECT_HANDSHAKE:"topic-connect-handshake",NOTIFICATION_PERMISSION_STATE:"topic-notification-permission-state",SERVICE_WORKER_STATE:"topic-service-worker-state",SERVICE_WORKER_REGISTRATION:"topic-service-worker-registration",SERVICE_WORKER_QUERY:"topic-service-worker-query",STORAGE_GET:"topic-storage-get"}}}])&&a(i,n),t}(),g=function(){function t(t){this.Or=t&&t.debug,this.Lr=t.windowContext||window,this.Vr=new w({debug:this.Or,windowContext:this.Lr})}var o=t.prototype;return o.isCurrentDialogPopup=function(){return!!this.Lr.opener&&this.Lr.opener!==this.Lr},o.requestNotificationPermission=function(){var t=this;return new Promise((function(i,n){try{t.Lr.Notification.requestPermission((function(t){return i(t)}))}catch(t){n(t)}}))},o.run=function(){this.tw(),this.iw(),this.nw(),this.ew(),"denied"!==this.Lr.Notification.permission?this.rw():this.sw()},o.tw=function(){var t=this,i=this.Lr.document.querySelector("#close");i&&i.addEventListener("click",(function(){t.closeDialog()}))},o.closeDialog=function(){if(this.isCurrentDialogPopup())this.Lr.close();else{var t=function(t){var n,e=i();if(!t)return e;for(;n=r.exec(t);){var o=s(n[1],n[1]),a=n[2]?s(n[2].replace(/\+/g," "),n[2]):"";e[o]=a}return e}((this.Lr.fakeLocation||this.Lr.location).search);if(!t.return)throw new Error("Missing required parameter.");var n=s(t.return);this.redirectToUrl(n)}},o.sw=function(){var t=this;navigator.permissions.query({name:"notifications"}).then((function(i){i.onchange=function(){switch(t.iw(),t.Lr.Notification.permission){case"default":case"granted":t.rw()}}}))},o.iw=function(){this.Lr.localStorage.setItem("amp-web-push-notification-permission",this.Lr.Notification.permission)},o.nw=function(){for(var t=this.Lr.document.querySelectorAll("[permission]"),i=0;i<t.length;i++){var r=t[i];this.ow(r,!1)}var s,o=this.Lr.document.querySelector("[permission=".concat((s=this.Lr.Notification.permission,String(s).replace(n,e)),"]"));o&&this.ow(o,!0)},o.ew=function(){var t=this.Lr.document.querySelector("#preload"),i=this.Lr.document.querySelector("#postload");t&&i&&(this.ow(t,!1),this.ow(i,!0))},o.ow=function(t,i){if(t){var n="invisible";i?t.classList.remove(n):t.classList.add(n)}},o.rw=function(){var t=this;return this.requestNotificationPermission().then((function(i){if(t.iw(),t.isCurrentDialogPopup())return t.Vr.connect(opener,"*"),t.Vr.send(w.Topics.NOTIFICATION_PERMISSION_STATE,i).then((function(i){var n=i[0];n&&n.closeFrame&&t.closeDialog()}));t.closeDialog()}))},o.redirectToUrl=function(t){var i=v(t);!i||"http:"!==i.protocol&&"https:"!==i.protocol||(this.Lr.location.href=t)},t}();window._ampWebPushPermissionDialog=new g({debug:!1}),window._ampWebPushPermissionDialog.run()}();
/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */
//# sourceMappingURL=amp-web-push-permission-dialog.js.map