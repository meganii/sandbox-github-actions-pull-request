;
(self.AMP=self.AMP||[]).push({m:0,v:"2301041800000",n:"amp-iframely",ev:"0.1",l:!0,f:function(t,n){!function(){function n(t,i){return(n=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(t,i)}function i(t){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function e(t,n){if(n&&("object"===r(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}var o=Array.isArray,u=Object.prototype;function a(t,n,i,r,e,o,u,a,s,f,l){return t}function s(t){return t.parent&&t.parent!=t}function f(t,n){t.classList.add("i-amphtml-fill-content"),n&&t.classList.add("i-amphtml-replaced-content")}u.hasOwnProperty,u.toString;var l,c,h,d=function(){var t=this;this.promise=new Promise((function(n,i){t.resolve=n,t.reject=i}))};new WeakMap,new WeakMap;var v,m=["Webkit","webkit","Moz","moz","ms","O","o"];self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var y=self.__AMP_LOG;function p(t){return function(t,n){throw new Error("failed to call initLogConstructor")}()}function b(t,n,i,r,e,o,u,a,s,f,l){return(y.user||(y.user=p()),void y.user.win?y.userForEmbed||(y.userForEmbed=p()):y.user).assert(t,n,i,r,e,o,u,a,s,f,l)}function w(t,n){return function(t,n,i){if(!n)return t;var r=t.split("#",2),e=r[0].split("?",2);return e[0]+(e[1]?"?".concat(e[1],"&").concat(n):"?".concat(n))+(r[1]?"#".concat(r[1]):"")}(t,function(t){var n,i,r,e=[];for(var u in t){var a=t[u];if(null!=a){a=o(r=a)?r:[r];for(var s=0;s<a.length;s++)e.push((n=u,i=a[s],"".concat(encodeURIComponent(n),"=").concat(encodeURIComponent(i))))}}return e.join("&")}(n))}new Set(["c","v","a","ad"]);var g="amp-iframely",k=function(t){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&n(t,i)}(y,t);var r,o,u=(r=y,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,n=i(r);if(o){var u=i(this).constructor;t=Reflect.construct(n,arguments,u)}else t=n.apply(this,arguments);return e(this,t)});function y(t){var n;return(n=u.call(this,t)).yk=null,n.tb=null,n.bk=null,n.wk=null,n.Pi=null,n.gk=null,n.si=null,n}var p=y.prototype;return p.isLayoutSupported=function(t){return function(t){return"fixed"==t||"fixed-height"==t||"responsive"==t||"fill"==t||"flex-item"==t||"fluid"==t||"intrinsic"==t}(t)},p.buildCallback=function(){this.bk=this.element.getAttribute("data-id"),this.Pi=this.element.getAttribute("data-url"),this.gk=this.element.getAttribute("data-key"),this.si=this.kk();var t="cdn.iframe.ly",n=this.element.getAttribute("data-domain");n&&this.Ok(n)&&(t=n),this.wk="https://".concat(t,"/"),this.jk()},p.preconnectCallback=function(t){this.preconnect&&this.preconnect.Pi&&this.preconnect.url(this.wk,t)},p.createPlaceholderCallback=function(){var t,n=this.getLayout();if(this.element.hasAttribute("data-img")||"responsive"===n&&!this.element.hasAttribute("resizable")){var i=(t={"src":w(this.Mk("/thumbnail"),this.si),"loading":"lazy","placeholder":""},function(t,n){for(var i in n)t.setAttribute(i,n[i]);return t}(this.element.ownerDocument.createElement("img"),t));return f(i),i}return null},p.layoutCallback=function(){var t,n,i,r,e,o,u,a=this;return this.tb=this.element.ownerDocument.createElement("iframe"),function(t,n,i,r,e){var o=function(t,n,i){if(n.startsWith("--"))return n;var r;h||(r=Object.create(null),h=r);var e=h[n];if(!e||i){if(e=n,void 0===t[n]){var o=function(t){return t.charAt(0).toUpperCase()+t.slice(1)}(n),u=function(t,n){for(var i=0;i<m.length;i++){var r=m[i]+n;if(void 0!==t[r])return r}return""}(t,o);void 0!==t[u]&&(e=u)}i||(h[n]=e)}return e}(t.style,n,e);if(o){var u,a=r?i+r:i;t.style.setProperty((u=o.replace(/[A-Z]/g,(function(t){return"-"+t.toLowerCase()})),m.some((function(t){return u.startsWith(t+"-")}))?"-".concat(u):u),a)}}(this.tb,"border","0px"),this.tb.setAttribute("sandbox","allow-scripts allow-same-origin allow-popups allow-forms allow-presentation"),this.yk=w(this.yk,this.si),this.tb.src=this.yk,f(this.tb),this.element.appendChild(this.tb),this.Rk=(t=this.win,n="message",i=void 0,r=t,e=function(t){t.source===a.tb.contentWindow&&a.Sk(t)},o=function(t){try{return e(t)}catch(t){var n,i;throw null===(n=(i=self).__AMP_REPORT_ERROR)||void 0===n||n.call(i,t),t}},u=function(){if(void 0!==v)return v;v=!1;try{var t={get capture(){return v=!0,!1}};self.addEventListener("test-options",null,t),self.removeEventListener("test-options",null,t)}catch(t){}return v}(),r.addEventListener(n,o,!!u&&i),function(){null==r||r.removeEventListener(n,o,!!u&&i),e=null,r=null,o=null}),this.loadPromise(this.tb)},p.Sk=function(t){var n=this,i=function(t,n){try{return function(t){return JSON.parse(t)}(t)}catch(t){return null}}(function(t){return t.data}(t));if(i){if("resize"===i.method&&i.height>50)this.attemptChangeHeight(i.height).catch((function(){}));else if("setIframelyEmbedData"===i.method){var r=i.data.media||null;r&&r["aspect-ratio"]&&function(t){var n,i,r=null===(n=l)||void 0===n?void 0:n.get(t);if(!r){var e=function(t){l||(l=new WeakMap,c=new WeakMap),a(c);var n=c.get(t);return n||(n=function(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=i.needsRootBounds,e=i.rootMargin,o=i.threshold,u=s(n)&&(r||e)?n.document:void 0;return new n.IntersectionObserver(t,{threshold:o,root:u,rootMargin:e})}((function(t){for(var i=new Set,r=t.length-1;r>=0;r--){var e,o=t[r].target;i.has(o)||(i.add(o),a(n),n.unobserve(o),a(l),null===(e=l.get(o))||void 0===e||e.resolve(t[r]),l.delete(o))}}),t,{needsRootBounds:!0}),c.set(t,n)),n}(((i=t).ownerDocument||i).defaultView);a(l),e.observe(t),r=new d,l.set(t,r)}return r.promise}(this.element).then((function(t){if(r["padding-bottom"]){var i=t.boundingClientRect.width/r["aspect-ratio"]+r["padding-bottom"];n.attemptChangeHeight(Math.round(i)).catch((function(){}))}else{var e=t.boundingClientRect.width/r["aspect-ratio"];Math.abs(t.boundingClientRect.height-e)>1&&n.attemptChangeHeight(Math.round(e)).catch((function(){}))}}))}"cancelWidget"===i.method&&this.attemptCollapse().catch((function(){}))}},p.Mk=function(t){return this.bk?"".concat(this.wk).concat(this.bk).concat("/iframe"!==t?t:"","?amp=1"):w("".concat(this.wk,"api").concat(t),{"url":this.Pi,"key":this.gk,"amp":"1"})},p.jk=function(){b(this.element.getAttribute("data-id")||this.element.getAttribute("data-url"),'<%s> requires either "data-id" or a pair of "data-url" and "data-key" attributes for %s',g,this.element),this.bk||(this.Pi&&b(this.gk,"Iframely data-key must also be set when you specify data-url parameter at <%s> %s",g,this.element),this.gk&&b(this.Pi,"Iframely data-url must also be set when you specify data-key parameter at <%s> %s",g,this.element),(this.gk||this.Pi)&&b(!this.bk,"Iframely data-id should not be set when there is already a pair of data-url and data-key for <%s> %s",g,this.element)),(this.bk&&this.Pi||this.bk&&this.gk)&&b(!this.bk,"Only one way of setting either data-id or data-url and data-key supported for <%s> %s",g,this.element),this.yk=this.Mk("/iframe")},p.kk=function(){return t=this.element.dataset,n=["id","domain","key","url","img"],Object.keys(t).reduce((function(i,r){return n.includes(r)||(i[r]=t[r]),i}),{});var t,n},p.unlayoutCallback=function(){var t,n;return this.tb&&(null===(n=(t=this.tb).parentElement)||void 0===n||n.removeChild(t),this.tb=null),this.ib&&(this.ib(),this.ib=null),!0},p.Ok=function(t){return[/^(?:[^\.\/]+\.)?iframe\.ly$/i,/^if\-cdn\.com$/i,/^iframely\.net$/i,/^oembed\.vice\.com$/i,/^iframe\.nbcnews\.com$/i].reduce((function(n,i){return n||i.test(t)}),!1)},y}(t.BaseElement);t.registerElement(g,k)}();
/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */}});
//# sourceMappingURL=amp-iframely-0.1.js.map