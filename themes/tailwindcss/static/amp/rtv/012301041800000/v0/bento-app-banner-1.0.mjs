;
import{PreactBaseElement as t}from"../bento.mjs";function n(t,n,r){return n in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t}function r(t,n){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(t);n&&(e=e.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),r.push.apply(r,e)}return r}function e(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?r(Object(o),!0).forEach((function(r){n(t,r,o[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(o,n))}))}return t}var{hasOwnProperty:o,toString:i}=Object.prototype;function s(t,n){return t.querySelector(function(t,n){return t.replace(/^|,/g,"$&:scope ")}(n))}function a(t,n){return t.matches(n)}import{createElement as l}from"../bento.mjs";import{useEffect as u,useMemo as p,useRef as c}from"../bento.mjs";import{ContainWrapper as d}from"../bento.mjs";import{useCallback as f,useState as h}from"../bento.mjs";var b={info:console.info,warn:console.warn,error:console.error},m={isAndroid:()=>/Android/i.test(self.navigator.userAgent),isIos:()=>/iPhone|iPad|iPod/i.test(self.navigator.userAgent),isSafari(){return/Safari/i.test(self.navigator.userAgent)&&!this.isChrome()&&!this.isEdge()&&!this.isFirefox()&&!this.isOpera()},isChrome(){return/Chrome|CriOS/i.test(self.navigator.userAgent)&&!this.isEdge()&&!this.isOpera()},isFirefox(){return/Firefox|FxiOS/i.test(self.navigator.userAgent)&&!this.isEdge()},isOpera:()=>/OPR\/|Opera|OPiOS/i.test(self.navigator.userAgent),isEdge:()=>/Edge/i.test(self.navigator.userAgent),isWebKit(){return/WebKit/i.test(self.navigator.userAgent)&&!this.isEdge()},isWindows:()=>/Windows/i.test(self.navigator.userAgent),isStandalone(){return this.isIos()&&self.navigator.standalone||this.isChrome()&&self.matchMedia("(display-mode: standalone)").matches},isBot:()=>/bot/i.test(self.navigator.userAgent),getMajorVersion(){return this.isSafari()?this.isIos()?this.getIosMajorVersion()||0:this.eu(/\sVersion\/(\d+)/,1):this.isChrome()?this.eu(/(Chrome|CriOS)\/(\d+)/,2):this.isFirefox()?this.eu(/(Firefox|FxiOS)\/(\d+)/,2):this.isOpera()?this.eu(/(OPR|Opera|OPiOS)\/(\d+)/,2):this.isEdge()?this.eu(/Edge\/(\d+)/,1):0},eu(t,n){if(!self.navigator.userAgent)return 0;const r=self.navigator.userAgent.match(t);return!r||n>=r.length?0:parseInt(r[n],10)},getIosVersionString(){var t,n,r;return this.isIos()&&(null===(t=self.navigator.userAgent)||void 0===t||null===(n=t.match(/OS ([0-9]+[_.][0-9]+([_.][0-9]+)?)\b/))||void 0===n||null===(r=n[1])||void 0===r?void 0:r.replace(/_/g,"."))||""},getIosMajorVersion(){const t=this.getIosVersionString();return""===t?null:Number(t.split(".")[0])}},g=["javascript:","data:","vbscript:"],v={tOt(){return this.qu||(this.qu=self.document.createElement("a")),this.qu},parse(t){const n=this.tOt();return n.href="",new URL(t,n.href)},isProtocolValid(t){const n=this.parse(t);return!g.includes(n.protocol)},assertHttpsUrl(t,n="url"){if(!this.isSecureUrl(t))throw new Error(`${n} must start with "https://" or "//" or be relative and served from either https or from localhost. Invalid value: ${t}`)},isSecureUrl(t){var n;const r=this.parse(t);return"https:"===r.protocol||"localhost"===r.hostname||"127.0.0.1"===r.hostname||(null===(n=r.hostname)||void 0===n?void 0:n.endsWith(".localhost"))}},O={getMetaByName(t){var n;const r=self.document.head.querySelectorAll("meta[name]");return(null===(n=Array.from(r).find((n=>n.getAttribute("name")===t&&n.getAttribute("content"))))||void 0===n?void 0:n.getAttribute("content"))||null},get sourceUrl(){return self.location.href},get canonicalUrl(){var t;const n=self.document,r=null==n||null===(t=n.AMP)||void 0===t?void 0:t.canonicalUrl;if(r)return r;const e=n.querySelector("link[rel=canonical]");return e?v.parse(e.href).href:this.sourceUrl}},A={fetchJson(t,n){return this.fetch(t,n).then((t=>t.json()))},fetch(t,n){return r=this,e=function*(){const r=yield self.fetch(t,n);if(!r.ok)throw new Error(r.statusText);return r},new Promise(((t,n)=>{var o=t=>{try{s(e.next(t))}catch(t){n(t)}},i=t=>{try{s(e.throw(t))}catch(t){n(t)}},s=n=>n.done?t(n.value):Promise.resolve(n.value).then(o,i);s((e=e.apply(r,null)).next())}));var r,e}};self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var N=self.__AMP_LOG;function w(t,n,r,e){let o;try{o=t.open(n,r,e)}catch(t){(N.dev||(N.dev=function(t,n){throw new Error("failed to call initLogConstructor")}())).error("DOM","Failed to open url on target: ",r,t)}var i,s;return!o&&"_top"!=r&&("number"!=typeof s&&(s=0),s+"noopener".length>(i=e||"").length||-1===i.indexOf("noopener",s))&&(o=t.open(n,"_top")),o}function x(){if(m.isAndroid()&&m.isChrome())return b.info("BENTO-APP-BANNER","Not rendering bento-app-banner:","Browser supports builtin banners."),null;const t=self.document.head.querySelector("link[rel=manifest],link[rel=origin-manifest]");if(!t)return null;const n=t.getAttribute("href");v.assertHttpsUrl(n,void 0,"manifest href");const r=A.fetchJson(n).then(P);return{promise:r,openOrInstall:()=>r.then((t=>{if(!t)return;const{installAppUrl:n,openInAppUrl:r}=t;setTimeout((()=>{(class{static getTop(t){return t.top}static getLocation(t){return t.location}static getDocumentReferrer(t){return t.document.referrer}static getHostname(t){return t.location.hostname}static getUserAgent(t){return t.navigator.userAgent}static getUserLanguage(t){return t.navigator.userLanguage||t.navigator.language}static getDevicePixelRatio(){return self.devicePixelRatio||1}static getSendBeacon(t){if(t.navigator.sendBeacon)return t.navigator.sendBeacon.bind(t.navigator)}static getXMLHttpRequest(t){return t.XMLHttpRequest}static getImage(t){return t.Image}}).getTop(window).location.assign(n)}),1500),w(window,r,"_top")}))}}function P(t){const n=t.related_applications;if(!n)return b.error("BENTO-APP-BANNER","Invalid manifest:","related_applications is missing from manifest.json file"),null;const r=n.find((t=>"play"===t.platform));return r?{installAppUrl:`https://play.google.com/store/apps/details?id=${r.id}`,openInAppUrl:function(t){const n=v.parse(O.canonicalUrl),r=n.protocol.replace(":",""),{host:e,pathname:o}=n;return`android-app://${t}/${r}/${e}${o}`}(r.id)}:(b.error("BENTO-APP-BANNER","Invalid manifest:","Could not find a platform=play app in manifest"),null)}function B(){if(m.isSafari())return b.info("BENTO-APP-BANNER","Not rendering bento-app-banner:","Browser supports builtin banners."),null;const t=O.getMetaByName("apple-itunes-app");if(!t)return b.error("BENTO-APP-BANNER","Not rendering bento-app-banner:",'could not find a <meta name="apple-itunes-app" /> tag'),null;const{installAppUrl:n,openInAppUrl:r}=function(t){const n=function(t){return t.replace(/\s/,"").split(",").reduce(((t,n)=>{const[r,e]=n.split("=");return t[r]=e,t}),{})}(t),r=n["app-id"];let e=n["app-argument"];e?v.isProtocolValid(e)||(b.warn("BENTO-APP-BANNER",`The url in app-argument has invalid protocol: ${e}`),e=""):b.warn("BENTO-APP-BANNER",'<meta name="apple-itunes-app">\'s content should contain app-argument to allow opening an already installed application on iOS.');const o=`https://itunes.apple.com/us/app/id${r}`;return{installAppUrl:o,openInAppUrl:e||o}}(t);return{installAppUrl:n,openInAppUrl:r,openOrInstall:()=>{setTimeout((()=>{w(window,n,"_top")}),1500),w(window,r,"_top")}}}var E=["children","dismissButtonAriaLabel","onDismiss","onInstall"];function j(t){let{children:n,dismissButtonAriaLabel:r="Dismiss",onDismiss:o,onInstall:i}=t,p=function(t,n){if(null==t)return{};var r,e,o={},i=Object.keys(t);for(e=0;e<i.length;e++)r=i[e],n.indexOf(r)>=0||(o[r]=t[r]);return o}(t,E);const f=c(null);return u((()=>{let t=f.current.querySelector("button[open-button]");if(!t){const n=f.current.querySelector("slot");n&&(t=function(t,n){const r=t.assignedElements();for(let t=0;t<r.length;t++){const e=r[t];if(a(e,n))return e;const o=s(e,n);if(o)return o}return null}(n,"button[open-button]"))}if(t)return t.addEventListener("click",i),()=>t.removeEventListener("click",i);b.error("BENTO-APP-BANNER","Component children should contain a <button open-button>")}),[i]),l(d,e({},p),l("div",{class:"banner-dd356a4",ref:f},l("div",{class:"banner-padding-dd356a4"}),l("button",{class:"dismiss-dd356a4","aria-label":r,onClick:o}),n))}function I(t){const n=p(B,[]);return n?l(j,e(e({},t),{},{onInstall:n.openOrInstall})):null}function S(t){const n=p(x,[]);return n?l(j,e(e({},t),{},{onInstall:n.openOrInstall})):null}var R=class extends t{};R.Component=function(t){t.id||b.warn("BENTO-APP-BANNER","component should have an id");const[n,r]=function(t,n){const[r,e]=h((()=>{try{var n;const r=null===(n=self.localStorage)||void 0===n?void 0:n.getItem(t);return!!r&&JSON.parse(r)}catch(t){return!1}}));return[r,f((n=>{try{var r;const e=JSON.stringify(n);null===(r=self.localStorage)||void 0===r||r.setItem(t,e)}catch(n){b.warn("useLocalStorage","Could not write value to local storage",t,n)}e(n)}),[t])]}("bento-app-banner:"+t.id);if(n)return null;const o=m.isIos()?I:m.isAndroid()?S:null;return o?l(o,e(e({},t),{},{onDismiss:()=>r(!0)})):(b.info("BENTO-APP-BANNER","Component not rendered:","OS not supported"),null)},R.props={"children":{passthrough:!0},"dismissButtonAriaLabel":{attr:"dismiss-button-aria-label"},"id":{attr:"id"}},R.layoutSizeDefined=!0,R.usesShadowDom=!0,R.shadowCss='.banner-dd356a4{left:0;width:100%;bottom:0!important;z-index:13;position:fixed!important;background:#fff;box-shadow:0 0 5px 0 rgba(0,0,0,0.2)!important;box-sizing:border-box;max-height:100px!important}.banner-padding-dd356a4{top:0;left:0;right:0;height:4px;z-index:15;position:absolute;background:#fff}.dismiss-dd356a4{top:-28px;right:0;width:28px;border:none;height:28px;z-index:14;position:absolute;box-shadow:0 -1px 1px 0 rgba(0,0,0,0.2);border-radius:12px 0 0 0;background-size:13px 13px;background-color:#fff;background-image:url(\'data:image/svg+xml;charset=utf-8,<svg width="13" height="13" viewBox="341 8 13 13" xmlns="http://www.w3.org/2000/svg"><path fill="%234F4F4F" d="M354 9.31 352.69 8l-5.19 5.19L342.31 8 341 9.31l5.19 5.19-5.19 5.19 1.31 1.31 5.19-5.19 5.19 5.19 1.31-1.31-5.19-5.19z" fill-rule="evenodd"/></svg>\');background-repeat:no-repeat;background-position:9px}.dismiss-dd356a4:before{top:-20px;left:-20px;right:0;bottom:0;content:"";position:absolute}[dir=rtl] .dismiss-dd356a4{left:0;right:auto;background-position:6px;border-top-left-radius:0;border-top-right-radius:12px}[dir=rtl] .dismiss-dd356a4:before{left:0;right:-20px}';import{defineBentoElement as U}from"../bento.mjs";U("bento-app-banner",R,void 0);
/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */
//# sourceMappingURL=bento-app-banner-1.0.mjs.map