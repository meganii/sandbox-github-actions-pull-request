;
function e(e,t){if(null==e)return{};var n,o,l={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(l[n]=e[n]);return l}function t(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function n(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function o(e){for(var o=1;o<arguments.length;o++){var l=null!=arguments[o]?arguments[o]:{};o%2?n(Object(l),!0).forEach((function(n){t(e,n,l[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(l)):n(Object(l)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(l,t))}))}return e}var{hasOwnProperty:l,toString:r}=Object.prototype;function i(e,t,n,o,l,r,i,s,a,u,c){return e}function s(e){try{e.focus()}catch(e){}}function a(e,t,n){const o=e.hasAttribute(t),l=void 0!==n?n:!o;return l!==o&&(l?e.setAttribute(t,""):e.removeAttribute(t)),l}import{createElement as u}from"../bento.mjs";import{useCallback as c,useLayoutEffect as d,useRef as m}from"../bento.mjs";import{PreactBaseElement as b}from"../bento.mjs";import{useCallback as f,useLayoutEffect as p}from"../bento.mjs";import{useAmpContext as v}from"../bento.mjs";function y(e,t=0){var n,o;return null!==(n=null!==(o=e.tabindex)&&void 0!==o?o:e.tabIndex)&&void 0!==n?n:t}function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function j(e){var t=function(e,t){if("object"!==h(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,"string");if("object"!==h(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===h(t)?t:String(t)}import{createContext as O,createElement as w}from"../bento.mjs";import{useCallback as S,useContext as k,useEffect as g,useImperativeHandle as x,useLayoutEffect as E,useMemo as D,useRef as C,useState as M}from"../bento.mjs";import{forwardRef as R}from"../bento.mjs";var K=["as","disabled","defaultValue","form","keyboardSelectMode","value","multiple","name","onChange","role","children"],A=O({selected:[]}),F={NONE:"none",FOCUS:"focus",SELECT:"select"},L=R((function(t,n){let{as:l="div",disabled:r,defaultValue:i=[],form:s,keyboardSelectMode:a=F.NONE,value:u,multiple:c,name:d,onChange:m,role:b="listbox",children:f}=t,p=e(t,K);const v=y(p,a===F.SELECT?0:-1),[h,j]=M(null!=u?u:i),O=C([]),k=C({active:null,focusMap:{}}),E=null!=u?u:h,R=S((e=>{if(!e)return;let t=null;t=c?E.includes(e)?E.filter((t=>t!=e)):E.concat(e):[e],t&&(j(t),m&&m({value:t,option:e}))}),[c,m,E]),L=D((()=>({disabled:r,focusRef:k,keyboardSelectMode:a,multiple:c,optionsRef:O,selected:E,selectOption:R})),[r,k,a,c,E,R]);g((()=>{if(!c&&E.length>1){const e=E.pop();j([e]),m&&m({value:[e],option:e})}}),[m,c,E]);const V=S(((e,t)=>{const n=E.includes(e);t&&n||((null!=t?t:!n)?R(e):j((t=>{const n=t.filter((t=>t!=e));return m&&m({value:n,option:e}),n})))}),[m,j,R,E]),B=S((()=>{j([]),m&&m({value:[],option:u})}),[j,m,u]),N=S(((e,t,n)=>{if(!O.current.length)return;const o=O.current.filter((e=>null!=e));if(!o.length)return;const l=o.indexOf(t);var r,i;n(o[(r=-1===l&&e<0?e:l+e,i=o.length,r>0&&i>0?r%i:(r%i+i)%i)])}),[]),P=S((e=>N(e,E.shift(),R)),[N,E,R]),T=S((e=>N(e,k.current.active,(e=>{const t=k.current.focusMap[e];t&&t()}))),[N]);x(n,(()=>({clear:B,selectBy:P,toggle:V})),[B,P,V]);const U=S((e=>{const{key:t}=e;let n;switch(t){case"ArrowLeft":case"ArrowUp":n=-1;break;case"ArrowRight":case"ArrowDown":n=1}n&&(a===F.SELECT?P(n):a===F.FOCUS&&T(n))}),[a,T,P]);return w(l,o(o({},p),{},{role:b,"aria-disabled":r,"aria-multiselectable":c,disabled:r,form:s,multiple:c,name:d,onKeyDown:U,tabindex:v,value:E}),w("input",{hidden:!0,defaultValue:E,name:d,form:s}),w(A.Provider,{value:L},f))}));function V(t){let n="class",{as:l="div",disabled:r=!1,focus:i,index:a,option:u,role:c="option",[n]:d=""}=t,m=e(t,["as","disabled","focus","index","option","role",n].map(j));const b=C(null),{disabled:f,focusRef:p,keyboardSelectMode:v,multiple:h,optionsRef:O,selectOption:g,selected:x}=k(A),D=y(m,v===F.SELECT?-1:0),M=S((()=>{null==i||i(),b.current&&s(b.current)}),[i]);E((()=>{const e=O;if(e&&e.current)return null==a||r||(e.current[a]=u),()=>delete e.current[a]}),[r,a,u,O]),E((()=>{if(!p)return;const e=p.current;return e&&e.focusMap?(e.focusMap[u]=M,()=>delete e.focusMap[u]):void 0}),[M,p,u]);const R=S((()=>{f||r||g(u)}),[r,u,g,f]),K=S((()=>{R()}),[R]),L=S((e=>{"Enter"!==e.key&&" "!==e.key||R()}),[R]),V=x.includes(u);return w(l,o(o({},m),{},{"aria-disabled":String(r),"aria-selected":String(V),class:(d||"")+" option-9237376"+(V&&!h?" selected-9237376":"")+(V&&h?" multiselected-9237376":"")+(r||f?" disabled-9237376":""),disabled:r,onClick:K,onFocus:()=>p.current.active=u,onKeyDown:L,ref:b,role:c,selected:V,tabindex:D,value:u}))}L.displayName="BentoSelector";var B=["disabled","onClick","onFocus","onKeyDown","role","selected","shimDomElement"],N=["children","disabled","form","multiple","name","onKeyDown","role","shimDomElement","value"],P=class extends b{init(){const{element:e}=this;this.optionState=[];const t=new MutationObserver((()=>{if(this.isExpectedMutation)return void(this.isExpectedMutation=!1);const{children:n,options:o}=T(e,t);this.optionState=o,this.mutateProps({children:n,options:o})}));t.observe(e,{attributeFilter:["option","selected","disabled"],childList:!0,subtree:!0});const{children:n,options:o,value:l}=T(e,t);return this.optionState=o,{"as":q,"shimDomElement":e,"children":n,"value":l,"options":o,"onChange":e=>{const{option:t,value:n}=e;this.triggerEvent(this.element,"select",{"targetOption":t,"selectedOptions":n}),this.isExpectedMutation=!0,this.mutateProps({"value":n})}}}};function T(e,t){const n=[],l=[],r=[];var a;return((a=e.querySelectorAll("[option]"))?Array.prototype.slice.call(a):[]).filter((e=>{var t;return!function(e,t){return e.closest("[option]")}(i(1==(null===(t=e.parentElement)||void 0===t?void 0:t.nodeType)))})).forEach(((e,i)=>{const a=e.getAttribute("option")||i.toString(),c=e.hasAttribute("selected"),d={as:U,option:a,disabled:e.hasAttribute("disabled"),index:i,focus:()=>s(e),role:e.getAttribute("role")||"option",shimDomElement:e,postRender:()=>{t.takeRecords()},selected:c};c&&r.push(a);const m=u(V,o(o({},d),{},{tabindex:e.getAttribute("tabindex")}));l.push(a),n.push(m)})),{value:r,children:n,options:l}}function U(t){let{disabled:n,onClick:o,onFocus:l,onKeyDown:r,role:s="option",selected:m,shimDomElement:b}=t;const f=y(e(t,B)),p=c(((e,t)=>{if(t)return b.addEventListener(e,t),()=>b.removeEventListener(e,i(t))}),[b]);return d((()=>p("click",o)),[o,p]),d((()=>p("focus",l)),[l,p]),d((()=>p("keydown",r)),[r,p]),d((()=>{a(b,"selected",!!m)}),[b,m]),d((()=>{a(b,"disabled",!!n),b.setAttribute("aria-disabled",!!n)}),[b,n]),d((()=>{b.setAttribute("role",s)}),[b,s]),d((()=>{null!=f&&b.setAttribute("tabindex",f)}),[b,f]),u("div",null)}function q(t){let{children:n,disabled:o,form:l,multiple:r,name:s,onKeyDown:b,role:f="listbox",shimDomElement:p,value:v}=t;const h=y(e(t,N)),j=m(null);var O;j.current||(j.current=(O={"hidden":""},function(e,t){for(const n in t)e.setAttribute(n,t[n]);return e}(p.ownerDocument.createElement("input"),O))),d((()=>{const e=j.current;return p.insertBefore(e,p.firstChild),()=>p.removeChild(e)}),[p]);const w=c(((e,t)=>{t?j.current.setAttribute(e,t):j.current.removeAttribute(e)}),[]);return d((()=>w("form",l)),[l,w]),d((()=>w("name",s)),[s,w]),d((()=>w("value",v)),[v,w]),d((()=>{if(b)return p.addEventListener("keydown",b),()=>p.removeEventListener("keydown",i(b))}),[p,b]),d((()=>{a(p,"multiple",!!r),p.setAttribute("aria-multiselectable",!!r)}),[p,r]),d((()=>{a(p,"disabled",!!o),p.setAttribute("aria-disabled",!!o)}),[p,o]),d((()=>{p.setAttribute("role",f)}),[p,f]),d((()=>{null!=h&&p.setAttribute("tabindex",h)}),[p,h]),u("div",{children:n})}P.Component=L,P.detached=!0,P.props={"disabled":{attr:"disabled",type:"boolean"},"form":{attr:"form"},"multiple":{attr:"multiple",type:"boolean"},"name":{attr:"name"},"role":{attr:"role"},"tabindex":{attr:"tabindex"},"keyboardSelectMode":{attr:"keyboard-select-mode",media:!0}};import{defineBentoElement as z}from"../bento.mjs";z("bento-selector",P,void 0);
/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */
//# sourceMappingURL=bento-selector-1.0.mjs.map