;
(self.AMP=self.AMP||[]).push({m:1,v:"2301041800000",n:"amp-subscriptions",ev:"0.1",l:!0,f:function(t,s){(()=>{var s;function i(){return s||(s=Promise.resolve(void 0))}var e=class{constructor(){this.promise=new Promise(((t,s)=>{this.resolve=t,this.reject=s}))}},{hasOwnProperty:n,toString:r}=Object.prototype;function o(t){const s=Object.create(null);return t&&Object.assign(s,t),s}function h(t,s){return n.call(t,s)}function c(t,s){if("."==s)return t;const i=s.split(".");let e=t;for(const t of i){if(!(t&&e&&void 0!==e[t]&&"object"==typeof e&&h(e,t))){e=void 0;break}e=e[t]}return e}var{isArray:u}=Array;function l(t){return JSON.parse(t)}function a(t,s){try{return l(t)}catch(t){return null==s||s(t),null}}function f(t,s,i,e,n,r,o,h,c,u,l){return t}function d(t){return(t.ownerDocument||t).defaultView}function p(t,s,i){return function(t,s){for(const i in s)t.setAttribute(i,s[i]);return t}(t.createElement(s),i)}var m=/(?:^[#?]?|&)([^=&]+)(?:=([^&]*))?/g;function g(t,s=""){try{return decodeURIComponent(t)}catch(t){return s}}self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var b=self.__AMP_LOG;function _(t,s){throw new Error("failed to call initLogConstructor")}function P(t){return b.user||(b.user=A()),function(t,s){return s&&s.ownerDocument.defaultView!=t}(b.user.win,t)?b.userForEmbed||(b.userForEmbed=A()):b.user}function A(t){return _()}function y(){return b.dev||(b.dev=_())}function v(t,s,i,e,n,r,o,h,c,u,l){return t}function E(t,s,i,e,n,r,o,h,c,u,l){return P().assert(t,s,i,e,n,r,o,h,c,u,l)}function w(t,s){return M(t=function(t){return t.__AMP_TOP||(t.__AMP_TOP=t)}(t),s)}function R(t,s){return M(k(S(t)),s)}function I(t,s){return function(t,s){const i=V(t,s);if(i)return i;const n=x(t);return n[s]=function(){const t=new e,{promise:s,reject:i,resolve:n}=t;return s.catch((()=>{})),{obj:null,promise:s,resolve:n,reject:i,context:null,ctor:null}}(),n[s].promise}(k(t),s)}function T(t,s){return V(k(t),s)}function S(t){return t.nodeType?(s=d(t),w(s,"ampdoc")).getAmpDoc(t):t;var s}function k(t){const s=S(t);return s.isSingleDoc()?s.win:s}function M(t,s){v(O(t,s));const i=x(t)[s];return i.obj||(v(i.ctor),v(i.context),i.obj=new i.ctor(i.context),v(i.obj),i.context=null,i.resolve&&i.resolve(i.obj)),i.obj}function V(t,s){const i=x(t)[s];return i?i.promise?i.promise:(M(t,s),i.promise=Promise.resolve(i.obj)):null}function x(t){let s=t.__AMP_SERVICES;return s||(s=t.__AMP_SERVICES={}),s}function O(t,s){const i=t.__AMP_SERVICES&&t.__AMP_SERVICES[s];return!(!i||!i.ctor)}var C=t=>M(t,"timer"),L=t=>R(t,"viewer"),U=t=>R(t,"viewport");function D(t){const s=function(t){return t.readyState}(t);return"loading"!=s&&"uninitialized"!=s}var N=class{constructor(t,s){let i,e,n;const r=t.indexOf(":");-1!=r?(e=t,i=e.substring(0,r),n=e.substring(r+1)):(i=t,e=null,n=null),this.publicationId_=i,this.productId_=e,this.label_=n,this.locked_=s}getPublicationId(){return this.publicationId_}getProductId(){return this.productId_}getLabel(){return this.label_}isLocked(){return this.locked_}};function j(t){console.log.apply(console,arguments)}function F(t,s){let i=t;do{if(i.nextSibling)return!0}while((i=i.parentNode)&&i!=s);return!1}function $(t){const s=Object.getOwnPropertyDescriptor(t,"message");if(s&&s.writable)return t;const{message:i,stack:e}=t,n=new Error(i);for(const s in t)n[s]=t[s];return n.stack=e,n}function z(t){let s=null,i="";for(let t=0;t<arguments.length;t++){const e=arguments[t];e instanceof Error&&!s?s=$(e):(i&&(i+=" "),i+=e)}return s?i&&(s.message=i+": "+s.message):s=new Error(i),s}var K=class{constructor(t=""){this.suffix_=t}prepareError_(t){this.suffix_&&(t.message?-1===t.message.indexOf(this.suffix_)&&(t.message=this.suffix_):t.message=this.suffix_)}createError(t){const s=z.apply(null,Array.prototype.slice.call(arguments));return this.prepareError_(s),s}createExpectedError(t){const s=z.apply(null,Array.prototype.slice.call(arguments));return this.prepareError_(s),s.expected=!0,s}error(t){throw this.createError.apply(this,arguments)}expectedError(t){throw this.createExpectedError.apply(this,arguments)}},G=new K(self.__AMP_TOP?"​​​":"");new K;var B="__SWG-SEEN__",W=["CreativeWork","Article","NewsArticle","Blog","Comment","Course","HowTo","Message","Review","WebPage"],J=new RegExp(W.join("|")),Y=class{constructor(){}checkValue(t,s){return!!t&&this.checkArray(this.toArray_(t),s)}checkString(t,s){return!!t&&this.checkArray(t.split(/\s+/),s)}checkArray(t,s){for(const i of t){const t=i.replace(/^http:\/\/schema.org\//i,"");if(s.includes(t))return!0}return!1}toArray_(t){return Array.isArray(t)?t:[t]}};function H(t,s){const i=t.querySelector(`meta[name="${s}"]`);return i?i.getAttribute("content"):null}function Q(t,s,i){return s in t?Object.defineProperty(t,s,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[s]=i,t}function Z(t,s){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(t);s&&(e=e.filter((function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable}))),i.push.apply(i,e)}return i}function X(t){for(var s=1;s<arguments.length;s++){var i=null!=arguments[s]?arguments[s]:{};s%2?Z(Object(i),!0).forEach((function(s){Q(t,s,i[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Z(Object(i)).forEach((function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))}))}return t}var q="subscriptions-action",tt="started",st={IS_READY_TO_PAY:"isReadyToPay",SUPPORTS_VIEWER:"supportsViewer"},it={};function et(t){if("undefined"!=typeof TextDecoder)return new TextDecoder("utf-8").decode(t);const s=function(t){const s=new Array(t.length);for(let i=0;i<t.length;i++)s[i]=String.fromCharCode(t[i]);return s.join("")}(new Uint8Array(t.buffer||t));return decodeURIComponent(escape(s))}function nt(t){const s=new Uint8Array(t.length);for(let i=0;i<t.length;i++){const e=t.charCodeAt(i);f(e<=255),s[i]=e}return s}function rt(t){return"function"==typeof t.then?t:new Promise(((s,i)=>{t.oncomplete=i=>{s(t.result)},t.onerror=i}))}function ot(t){const s=atob(t),i=s.length,e=new Uint8Array(i);for(let t=0;t<i;t++)e[t]=s.charCodeAt(t);return e}var ht,ct=["Webkit","webkit","Moz","moz","ms","O","o"];function ut(t){const s=t.replace(/[A-Z]/g,(t=>"-"+t.toLowerCase()));return ct.some((t=>s.startsWith(t+"-")))?`-${s}`:s}function lt(t,s,i){if(s.startsWith("--"))return s;ht||(ht=o());let e=ht[s];if(!e||i){if(e=s,void 0===t[s]){const i=function(t){return t.charAt(0).toUpperCase()+t.slice(1)}(s),n=function(t,s){for(let i=0;i<ct.length;i++){const e=ct[i]+s;if(void 0!==t[e])return e}return""}(t,i);void 0!==t[n]&&(e=n)}i||(ht[s]=e)}return e}function at(t,s){const{style:i}=t;for(const t in s)i.setProperty(ut(lt(i,t)),String(s[t]),"important")}function ft(t,s){void 0===s&&(s=t.hasAttribute("hidden")),s?t.removeAttribute("hidden"):t.setAttribute("hidden","")}var dt,pt,mt="SUBSCRIBER",gt="METERING",bt="UNLOCKED",_t=class{static empty(t){return new _t({source:"",raw:"",service:t,granted:!1})}constructor(t){const{dataObject:s,decryptedDocumentKey:i,grantReason:e="",granted:n=!1,raw:r="",service:o,source:h}=t;this.raw=r,this.source=h,this.service=o,this.granted=n,this.grantReason=e,this.data=s,this.decryptedDocumentKey=i}json(){return{"source":this.source,"service":this.service,"granted":this.granted,"grantReason":this.grantReason,"data":this.data}}jsonForPingback(){return X({"raw":this.raw},this.json())}static parseFromJson(t,s=null){t||(t={});const i=s||JSON.stringify(t),e=t.source||"",n=t.granted||!1,r=t.grantReason,o=t.data||null,h=t.decryptedDocumentKey||null;return new _t({source:e,raw:i,service:"",granted:n,grantReason:r,dataObject:o,decryptedDocumentKey:h})}isSubscriber(){return this.granted&&this.grantReason===mt}isFree(){return this.granted&&this.grantReason===bt}},Pt=(()=>self.AMP.config.urls)(),At=new Set(["c","v","a","ad"]),yt=t=>"string"==typeof t?Et(t):t;function vt(t){return t.origin||Et(t.location.href).origin}function Et(t,s){return dt||(dt=self.document.createElement("a")),function(t,s,i){return t.href="",new URL(s,t.href)}(dt,t)}function wt(t,s,i,e){return function(t,s,i){if(!s)return t;const e=t.split("#",2),n=e[0].split("?",2);let r=n[0]+(n[1]?i?`?${s}&${n[1]}`:`?${n[1]}&${s}`:`?${s}`);return r+=e[1]?`#${e[1]}`:"",r}(t,function(t,s){return`${encodeURIComponent(t)}=${encodeURIComponent(s)}`}(s,i),e)}function Rt(t,s,i="source"){var e;return E(null!=t,"%s %s must be available",s,i),E("https:"==(e=yt(e=t)).protocol||"localhost"==e.hostname||"127.0.0.1"==e.hostname||function(t,s){const i=t.length-s.length;return i>=0&&t.indexOf(s,i)==i}(e.hostname,".localhost")||/^\/\//.test(t),'%s %s must start with "https://" or "//" or be relative and served from either https or from localhost. Invalid value: %s',s,i,t),t}function It(t,s,i,e){let n=t,r=i,o=t=>{try{return r(t)}catch(t){var s,i;throw null===(s=(i=self).__AMP_REPORT_ERROR)||void 0===s||s.call(i,t),t}};const h=function(){if(void 0!==pt)return pt;pt=!1;try{const t={get capture(){return pt=!0,!1}};self.addEventListener("test-options",null,t),self.removeEventListener("test-options",null,t)}catch(t){}return pt}(),c=!(null==e||!e.capture);return n.addEventListener(s,o,h?e:c),()=>{null==n||n.removeEventListener(s,o,h?e:c),r=null,n=null,o=null}}function Tt(t){return t.data}function St(t,s,i,e){let n;try{n=t.open(s,i,e)}catch(t){y().error("DOM","Failed to open url on target: ",i,t)}var r,o;return!n&&"_top"!=i&&("number"!=typeof o&&(o=0),o+"noopener".length>(r=e||"").length||-1===r.indexOf("noopener",o))&&(n=t.open(s,"_top")),n}var kt=(()=>self.AMP.config.urls)(),Mt=new RegExp("RETURN_URL");function Vt(t,s){return function(t,s){const i=L(t);return parseInt(t.getParam("dialog"),10)?new xt(i,s):new Ot(t.win,i,s)}(t,s).open()}var xt=class{constructor(t,s){this.viewer=t,this.urlOrPromise=s}getLoginUrl(){let t;return t="string"==typeof this.urlOrPromise?Promise.resolve(this.urlOrPromise):this.urlOrPromise,t.then((t=>Ct(t,"RETURN_URL")))}open(){return this.getLoginUrl().then((t=>this.viewer.sendMessageAwaitResponse("openDialog",{"url":t})))}},Ot=class{constructor(t,s,i){this.win=t,this.viewer=s,this.urlOrPromise=i,this.Sn=null,this.no=null,this.uAt=null,this.aAt=null,this.lAt=null,this.fAt=null}open(){return E(!this.Sn,"Dialog already opened"),new Promise(((t,s)=>{this.Sn=t,this.no=s,this.dAt()})).then((t=>(this.Qt(),t)),(t=>{throw this.Qt(),t}))}Qt(){if(this.Sn=null,this.no=null,this.uAt){try{this.uAt.close()}catch(t){}this.uAt=null}this.lAt&&(this.win.clearInterval(this.lAt),this.lAt=null),this.fAt&&(this.fAt(),this.fAt=null)}getLoginUrl(){let t;return t="string"==typeof this.urlOrPromise?Promise.resolve(this.urlOrPromise):this.urlOrPromise,t.then((t=>Ct(t,this.pAt())))}dAt(){const{screen:t}=this.win,s=Math.floor(Math.min(700,.9*t.width)),e=Math.floor(Math.min(450,.9*t.height)),n=`height=${e},width=${s},left=${Math.floor((t.width-s)/2)},top=${Math.floor((t.height-e)/2)},resizable=yes,scrollbars=yes`,r=this.pAt();if(this.aAt=null,"string"==typeof this.urlOrPromise){const t=Ct(this.urlOrPromise,r);this.uAt=St(this.win,t,"_blank",n),this.uAt&&(this.aAt=i())}else this.uAt=St(this.win,"","_blank",n),this.uAt&&(this.aAt=this.urlOrPromise.then((t=>{const s=Ct(t,r);this.uAt.location.replace(s)}),(t=>{throw new Error("failed to resolve url: "+t)})));this.aAt?this.aAt.then((()=>{this._At(r)}),(t=>{this.mAt(null,t)})):this.mAt(null,new Error("failed to open dialog"))}_At(t){const s=Et(t).origin;this.lAt=this.win.setInterval((()=>{this.uAt.closed&&(this.win.clearInterval(this.lAt),this.lAt=null,this.win.setTimeout((()=>{this.mAt("")}),3e3))}),500),this.fAt=It(this.win,"message",(t=>{t.origin==s&&Tt(t)&&"amp"==Tt(t).sentinel&&"result"==Tt(t).type&&(this.uAt&&this.uAt.postMessage({"sentinel":"amp","type":"result-ack"},s),this.mAt(Tt(t).result))}),void 0)}mAt(t,s){this.Sn&&(s?this.no(s):this.Sn(t),this.Qt())}pAt(){const t=this.viewer.getResolvedViewerUrl();let s;return s=`${kt.cdn}/v0/amp-login-done-0.1.html`,s+"?url="+encodeURIComponent(t)}};function Ct(t,s){return Mt.test(t)?t.replace(Mt,encodeURIComponent(s)):t+(-1==t.indexOf("?")?"?":"&")+"return="+encodeURIComponent(s)}var Lt="local",Ut=function(){var t=function(t,s,i,e){for(i=i||{},e=t.length;e--;i[t[e]]=s);return i},s=[1,3],i=[1,4],e=[1,18],n=[1,19],r=[1,14],o=[1,15],h=[1,16],c=[1,17],u=[1,21],l=[1,22],a=[5,6,7,10],f=[5,6,7,10,15,16,17,18,19,20,21],d=[5,6,7,10,15,16,17,18,19,20,21,25,27],p={trace:function(){},yy:{},F2:{"error":2,"result":3,"search_condition":4,"EOF":5,"OR":6,"AND":7,"NOT":8,"(":9,")":10,"predicate":11,"comparison_predicate":12,"truthy_predicate":13,"scalar_exp":14,"EQ":15,"DEQ":16,"NEQ":17,"LT":18,"LTE":19,"GT":20,"GTE":21,"atom":22,"field_ref":23,"literal":24,"DOT":25,"field_name":26,"[":27,"string":28,"]":29,"NAME":30,"STRING":31,"NUMERIC":32,"TRUE":33,"FALSE":34,"NULL":35,"$accept":0,"$end":1},H2:{2:"error",5:"EOF",6:"OR",7:"AND",8:"NOT",9:"(",10:")",15:"EQ",16:"DEQ",17:"NEQ",18:"LT",19:"LTE",20:"GT",21:"GTE",25:"DOT",27:"[",29:"]",30:"NAME",31:"STRING",32:"NUMERIC",33:"TRUE",34:"FALSE",35:"NULL"},D2:[0,[3,2],[4,3],[4,3],[4,2],[4,3],[4,1],[11,1],[11,1],[12,3],[12,3],[12,3],[12,3],[12,3],[12,3],[12,3],[13,1],[14,1],[14,1],[22,1],[23,3],[23,4],[23,1],[26,1],[28,1],[24,1],[24,1],[24,1],[24,1],[24,1]],performAction:function(t,s,i,e,n,r,o){var h=r.length-1;switch(n){case 1:return r[h-1];case 2:this.$=r[h-2]||r[h];break;case 3:this.$=r[h-2]&&r[h];break;case 4:this.$=!r[h];break;case 5:this.$=r[h-1];break;case 6:case 7:case 8:case 17:case 18:case 19:this.$=r[h];break;case 9:this.$=r[h-2]===r[h];break;case 10:throw new Error('"==" is not allowed, use "="');case 11:this.$=r[h-2]!==r[h];break;case 12:this.$=typeof r[h-2]==typeof r[h]&&r[h-2]<r[h];break;case 13:this.$=typeof r[h-2]==typeof r[h]&&r[h-2]<=r[h];break;case 14:this.$=typeof r[h-2]==typeof r[h]&&r[h-2]>r[h];break;case 15:this.$=typeof r[h-2]==typeof r[h]&&r[h-2]>=r[h];break;case 16:this.$=void 0!==r[h]&&null!==r[h]&&""!==r[h]&&0!==r[h]&&!1!==r[h];break;case 20:this.$="[object Object]"==Object.prototype.toString.call(r[h-2])&&r[h-2].hasOwnProperty(r[h])?r[h-2][r[h]]:null;break;case 21:this.$="[object Object]"==Object.prototype.toString.call(r[h-3])&&r[h-3].hasOwnProperty(r[h-1])?r[h-3][r[h-1]]:null;break;case 22:this.$=void 0!==e[r[h]]?e[r[h]]:null;break;case 23:this.$=t;break;case 24:this.$=t.substring(1,t.length-1);break;case 26:this.$=Number(t);break;case 27:this.$=!0;break;case 28:this.$=!1;break;case 29:this.$=null}},table:[{3:1,4:2,8:s,9:i,11:5,12:6,13:7,14:8,22:9,23:10,24:11,26:12,28:13,30:e,31:n,32:r,33:o,34:h,35:c},{1:[3]},{5:[1,20],6:u,7:l},{4:23,8:s,9:i,11:5,12:6,13:7,14:8,22:9,23:10,24:11,26:12,28:13,30:e,31:n,32:r,33:o,34:h,35:c},{4:24,8:s,9:i,11:5,12:6,13:7,14:8,22:9,23:10,24:11,26:12,28:13,30:e,31:n,32:r,33:o,34:h,35:c},t(a,[2,6]),t(a,[2,7]),t(a,[2,8]),t(a,[2,16],{15:[1,25],16:[1,26],17:[1,27],18:[1,28],19:[1,29],20:[1,30],21:[1,31]}),t(f,[2,17]),t(f,[2,18],{25:[1,32],27:[1,33]}),t(f,[2,19]),t(d,[2,22]),t(f,[2,25]),t(f,[2,26]),t(f,[2,27]),t(f,[2,28]),t(f,[2,29]),t(d,[2,23]),t([5,6,7,10,15,16,17,18,19,20,21,29],[2,24]),{1:[2,1]},{4:34,8:s,9:i,11:5,12:6,13:7,14:8,22:9,23:10,24:11,26:12,28:13,30:e,31:n,32:r,33:o,34:h,35:c},{4:35,8:s,9:i,11:5,12:6,13:7,14:8,22:9,23:10,24:11,26:12,28:13,30:e,31:n,32:r,33:o,34:h,35:c},t(a,[2,4]),{6:u,7:l,10:[1,36]},{14:37,22:9,23:10,24:11,26:12,28:13,30:e,31:n,32:r,33:o,34:h,35:c},{14:38,22:9,23:10,24:11,26:12,28:13,30:e,31:n,32:r,33:o,34:h,35:c},{14:39,22:9,23:10,24:11,26:12,28:13,30:e,31:n,32:r,33:o,34:h,35:c},{14:40,22:9,23:10,24:11,26:12,28:13,30:e,31:n,32:r,33:o,34:h,35:c},{14:41,22:9,23:10,24:11,26:12,28:13,30:e,31:n,32:r,33:o,34:h,35:c},{14:42,22:9,23:10,24:11,26:12,28:13,30:e,31:n,32:r,33:o,34:h,35:c},{14:43,22:9,23:10,24:11,26:12,28:13,30:e,31:n,32:r,33:o,34:h,35:c},{26:44,30:e},{28:45,31:n},t([5,6,10],[2,2],{7:l}),t(a,[2,3]),t(a,[2,5]),t(a,[2,9]),t(a,[2,10]),t(a,[2,11]),t(a,[2,12]),t(a,[2,13]),t(a,[2,14]),t(a,[2,15]),t(d,[2,20]),{29:[1,46]},t(d,[2,21])],defaultActions:{20:[2,1]},parseError:function(t,s){if(!s.recoverable){var i=new Error(t);throw i.hash=s,i}this.trace(t)},parse:function(t){var s=this,i=[0],e=[null],n=[],r=this.table,o="",h=0,c=0,u=0,l=2,a=1,f=n.slice.call(arguments,1),d=Object.create(this.lexer),p={yy:{}};for(var m in this.yy)Object.prototype.hasOwnProperty.call(this.yy,m)&&(p.yy[m]=this.yy[m]);d.setInput(t,p.yy),p.yy.lexer=d,p.yy.parser=this,void 0===d.yylloc&&(d.yylloc={});var g=d.yylloc;n.push(g);var b=d.options&&d.options.ranges;"function"==typeof p.yy.parseError?this.parseError=p.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;for(var _,P,A,y,v,E,w,R,I,T=function(){var t;return"number"!=typeof(t=d.lex()||a)&&(t=s.F2[t]||t),t},S={};;){if(A=i[i.length-1],this.defaultActions[A]?y=this.defaultActions[A]:(null==_&&(_=T()),y=r[A]&&r[A][_]),void 0===y||!y.length||!y[0]){var k="";for(E in I=[],r[A])this.H2[E]&&E>l&&I.push("'"+this.H2[E]+"'");k=d.showPosition?"Parse error on line "+(h+1)+":\n"+d.showPosition()+"\nExpecting "+I.join(", ")+", got '"+(this.H2[_]||_)+"'":"Parse error on line "+(h+1)+": Unexpected "+(_==a?"end of input":"'"+(this.H2[_]||_)+"'"),this.parseError(k,{text:d.match,token:this.H2[_]||_,line:d.yylineno,loc:g,expected:I})}if(y[0]instanceof Array&&y.length>1)throw new Error("Parse Error: multiple actions possible at state: "+A+", token: "+_);switch(y[0]){case 1:i.push(_),e.push(d.yytext),n.push(d.yylloc),i.push(y[1]),_=null,P?(_=P,P=null):(c=d.yyleng,o=d.yytext,h=d.yylineno,g=d.yylloc,u>0&&u--);break;case 2:if(w=this.D2[y[1]][1],S.$=e[e.length-w],S._$={first_line:n[n.length-(w||1)].first_line,last_line:n[n.length-1].last_line,first_column:n[n.length-(w||1)].first_column,last_column:n[n.length-1].last_column},b&&(S._$.range=[n[n.length-(w||1)].range[0],n[n.length-1].range[1]]),void 0!==(v=this.performAction.apply(S,[o,c,h,p.yy,y[1],e,n].concat(f))))return v;w&&(i=i.slice(0,-1*w*2),e=e.slice(0,-1*w),n=n.slice(0,-1*w)),i.push(this.D2[y[1]][0]),e.push(S.$),n.push(S._$),R=r[i[i.length-2]][i[i.length-1]],i.push(R);break;case 3:return!0}}return!0}},m={EOF:1,parseError:function(t,s){if(!this.yy.parser)throw new Error(t);this.yy.parser.parseError(t,s)},setInput:function(t,s){return this.yy=s||this.yy||{},this._input=t,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var t=this._input[0];return this.yytext+=t,this.yyleng++,this.offset++,this.match+=t,this.matched+=t,t.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),t},unput:function(t){var s=t.length,i=t.split(/(?:\r\n?|\n)/g);this._input=t+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-s),this.offset-=s;var e=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),i.length-1&&(this.yylineno-=i.length-1);var n=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:i?(i.length===e.length?this.yylloc.first_column:0)+e[e.length-i.length].length-i[0].length:this.yylloc.first_column-s},this.options.ranges&&(this.yylloc.range=[n[0],n[0]+this.yyleng-s]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(t){this.unput(this.match.slice(t))},pastInput:function(){var t=this.matched.substr(0,this.matched.length-this.match.length);return(t.length>20?"...":"")+t.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var t=this.match;return t.length<20&&(t+=this._input.substr(0,20-t.length)),(t.substr(0,20)+(t.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var t=this.pastInput(),s=new Array(t.length+1).join("-");return t+this.upcomingInput()+"\n"+s+"^"},test_match:function(t,s){var i,e,n;if(this.options.backtrack_lexer&&(n={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(n.yylloc.range=this.yylloc.range.slice(0))),(e=t[0].match(/(?:\r\n?|\n).*/g))&&(this.yylineno+=e.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:e?e[e.length-1].length-e[e.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(t[0].length),this.matched+=t[0],i=this.performAction.call(this,this.yy,this,s,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),i)return i;if(this._backtrack){for(var r in n)this[r]=n[r];return!1}return!1},next:function(){if(this.done)return this.EOF;var t,s,i,e;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var n=this._currentRules(),r=0;r<n.length;r++)if((i=this._input.match(this.rules[n[r]]))&&(!s||i[0].length>s[0].length)){if(s=i,e=r,this.options.backtrack_lexer){if(!1!==(t=this.test_match(i,n[r])))return t;if(this._backtrack){s=!1;continue}return!1}if(!this.options.flex)break}return s?!1!==(t=this.test_match(s,n[e]))&&t:""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){return this.next()||this.lex()},begin:function(t){this.conditionStack.push(t)},popState:function(){return this.conditionStack.length-1>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(t){return(t=this.conditionStack.length-1-Math.abs(t||0))>=0?this.conditionStack[t]:"INITIAL"},pushState:function(t){this.begin(t)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(t,s,i,e){switch(i){case 0:break;case 1:return 7;case 2:return 6;case 3:return 8;case 4:return 35;case 5:case 6:return 33;case 7:case 8:return 34;case 9:return 9;case 10:return 10;case 11:return 27;case 12:return 29;case 13:return"|";case 14:return 19;case 15:return 18;case 16:return 21;case 17:return 20;case 18:return 17;case 19:return 16;case 20:return 15;case 21:return 32;case 22:return 30;case 23:case 24:return 31;case 25:return 25;case 26:return"INVALID";case 27:return 5}},rules:[/^(?:\s+)/,/^(?:AND\b)/,/^(?:OR\b)/,/^(?:NOT\b)/,/^(?:NULL\b)/,/^(?:TRUE\b)/,/^(?:true\b)/,/^(?:FALSE\b)/,/^(?:false\b)/,/^(?:\()/,/^(?:\))/,/^(?:\[)/,/^(?:\])/,/^(?:\|)/,/^(?:<=)/,/^(?:<)/,/^(?:>=)/,/^(?:>)/,/^(?:!=)/,/^(?:==)/,/^(?:=)/,/^(?:-?[0-9]+(\.[0-9]+)?\b)/,/^(?:[a-zA-Z_][a-zA-Z0-9_]*)/,/^(?:'[^\']*')/,/^(?:"[^\"]*")/,/^(?:\.)/,/^(?:.)/,/^(?:$)/],conditions:{"INITIAL":{"rules":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27],"inclusive":!0}}};function g(){this.yy={}}return p.lexer=m,g.prototype=p,p.Parser=g,new g}(),Dt=Ut;function Nt(t,s){return function(t,s){try{return Dt.yy=s,!!Dt.parse(t)}finally{Dt.yy=null}}(t,s)}var jt="_AMP_SUBSCRIPTIONS_CLICK_HANDLED",Ft=class{constructor(t,s,i){this.ji=t,this.od=t.getRootNode(),this.xot=s,this.sbt=!!this.xot.pingbackAllEntitlements,this.cst=i,this.lot=new class{constructor(t,s){const i=t.getHeadNode();this.Ty=function(t,s){const i=k(S(t));return O(i,s)?M(i,s):null}(i,"url-replace"),this.hot=s,this.uot=null}setAuthResponse(t){this.uot=t}buildUrl(t,s){return this.cot(s).then((s=>this.Ty.expandUrlAsync(t,s)))}collectUrlVars(t,s){return this.cot(s).then((s=>this.Ty.collectVars(t,s)))}cot(t){return this.hot.then((s=>{const i={"READER_ID":s,"ACCESS_READER_ID":s};return t&&(i.AUTHDATA=t=>{if(this.uot)return c(this.uot,t)}),i}))}}(this.ji,this.cst.getReaderId("local")),this.Jit=i.getAnalytics(),E(this.xot.actions,"Actions have not been defined in the service config"),this.R_=new class{constructor(t,s,i,e){for(const t in e)Rt(e[t],`action ${t}`);this.ibt=e,this.nbt={},this.lot=s,this.JU=i,this.rbt=null,this.obt=0,this.hbt=Vt.bind(null,t),this.build()}build(){if(0==Object.keys(this.ibt).length)return null;const t=[];for(const s in this.ibt)t.push(this.lot.buildUrl(this.ibt[s],!0).then((t=>{this.nbt[s]=t})));return Promise.all(t).then((()=>this.nbt))}execute(t){E(this.ibt[t],"Action URL is not configured: %s",t);const s=E(this.nbt[t],"Action URL is not ready: %s",t);return this.Ps(s,t)}Ps(t,s){const i=Date.now();if(this.rbt&&i-this.obt<1e3)return this.rbt;this.JU.actionEvent(Lt,s,tt);const e=this.hbt(t).then((t=>{this.rbt=null;const i=function(t){const s=o();if(!t)return s;let i;for(;i=m.exec(t);){const t=g(i[1],i[1]),e=i[2]?g(i[2].replace(/\+/g," "),i[2]):"";s[t]=e}return s}(t).success,e="true"==i||"yes"==i||"1"==i;return e?this.JU.actionEvent(Lt,s,"success"):this.JU.actionEvent(Lt,s,"rejected"),e||!i})).catch((t=>{throw this.JU.actionEvent(Lt,s,"failed"),this.rbt==e&&(this.rbt=null),t}));return this.rbt=e,this.obt=i,this.rbt}}(this.ji,this.lot,this.Jit,this.validateActionMap(this.xot.actions)),this.tp=new class{constructor(t,s,i){this.ji=t,this.od=t.getRootNode(),this.uAt=s,this.tM=R(t,"templates"),this.cst=i}render(t){return Promise.all([this.cbt(t),this.ubt(t)])}reset(){return this.uAt.close(),this.lbt({},this.od,(()=>!1))}cbt(t){this.lbt(t,this.od,Nt)}ubt(t){return this.ji.whenReady().then((()=>{const s=this.ji.getRootNode().querySelectorAll("[subscriptions-dialog][subscriptions-display]");for(let i=0;i<s.length;i++){const e=s[i],n=e.getAttribute("subscriptions-display");if(n&&Nt(n,t))return e}})).then((s=>{if(!s)return;if("TEMPLATE"==s.tagName)return this.tM.renderTemplate(s,t).then((s=>{const i=t;return this.lbt(i,s,Nt)}));const i=s.cloneNode(!0);return i.removeAttribute("subscriptions-dialog"),i.removeAttribute("subscriptions-display"),i})).then((t=>{if(t)return this.uAt.open(t,!0)}))}lbt(t,s,i){return this.ji.whenReady().then((()=>{const e=s.querySelectorAll('[subscriptions-action], [subscriptions-section="actions"], [subscriptions-actions]');for(let s=0;s<e.length;s++){const n=e[s],r=n.getAttribute("subscriptions-display");r&&i(r,t)?(n.classList.add("i-amphtml-subs-display"),n.getAttribute("subscriptions-service")&&n.getAttribute("subscriptions-action")&&"false"!==n.getAttribute("subscriptions-decorate")&&!n.hasAttribute("i-amphtml-subs-decorated")&&(this.cst.decorateServiceAction(n,n.getAttribute("subscriptions-service"),n.getAttribute("subscriptions-action"),null),n.setAttribute("i-amphtml-subs-decorated",!0))):n.classList.remove("i-amphtml-subs-display")}return s}))}}(this.ji,i.getDialog(),this.cst)}getPlatformKey(){return"local"}validateActionMap(t){return E(t.login,'Action "login" is not present in action map'),E(t.subscribe,'Action "subscribe" is not present in action map'),t}Uy(){const t=t=>{if(t[jt])return;t[jt]=!0;const s=function(t,s){return t.closest("[subscriptions-action]")}(t.target);this.Td(s)};this.od.addEventListener("click",t),this.od.body&&this.od.body.addEventListener("click",t)}Td(t){if(t){const s=t.getAttribute("subscriptions-action"),i=t.getAttribute("subscriptions-service");if("local"==i)this.executeAction(s,t.id);else if("auto"==(i||"auto"))if("login"==s){const i=this.cst.selectPlatformForLogin();this.cst.delegateActionToService(s,i.getPlatformKey(),t.id)}else this.executeAction(s,t.id);else i&&this.cst.delegateActionToService(s,i,t.id)}}activate(t){this.abt(t).then((t=>{this.tp.render(t)}))}abt(t){const s=t.json();return this.cst.getScoreFactorStates().then((t=>(s.factors=t,this.lot.setAuthResponse(s)))).then((()=>this.R_.build())).then((()=>s))}reset(){this.tp.reset()}executeAction(t){return this.R_.execute(t).then((t=>(t&&this.cst.resetPlatforms(),!!t)))}isPrerenderSafe(){return!1}getSupportedScoreFactor(t){return 0}getBaseScore(){return this.xot.baseScore||0}getEntitlements(){}pingback(t){}pingbackReturnsAllEntitlements(){return this.sbt}isPingbackEnabled(){return!1}decorateUI(t,s,i){}},$t="__AMP__",zt=class extends Ft{constructor(t,s,i){super(t,s,i),v("iframe"==this.xot.type),this.av=E(this.xot.iframeSrc,'"iframeSrc" URL must be specified'),Rt(this.av,"iframe Url"),this.HAt=this.xot.iframeVars||null,this.HAt&&E(u(this.HAt),'"iframeVars" must be an array'),this.Wv=Et(this.av).origin,this.WAt=null,this.BAt=null,this.Lv=t.win.document.createElement("iframe"),ft(this.Lv,!1),this.XAt=new class{constructor(t,s,i){this.i=t,this.YAt=s,this.Wv=i,this.o=null,this.ZAt=null,this.tPt=this.YF.bind(this),this.iPt=0,this.sPt={}}connect(t){if(this.ZAt)throw new Error("already connected");this.ZAt=t,this.i.addEventListener("message",this.tPt)}disconnect(){this.ZAt&&(this.ZAt=null,this.i.removeEventListener("message",this.tPt))}isConnected(){return null!=this.Wv}getTarget(){const t=this.ePt();if(!t)throw new Error("not connected");return t}ePt(){return this.ZAt&&!this.o&&("function"==typeof this.YAt?this.o=this.YAt():this.o=this.YAt),this.o}getTargetOrigin(){if(null==this.Wv)throw new Error("not connected");return this.Wv}sendCommand(t,s){this.wb(void 0,t,s)}sendCommandRsvp(t,s){const i=String(++this.iPt);let e=null;const n=new Promise((t=>{e=t}));return this.sPt[i]={promise:n,resolver:e},this.wb(i,t,s),n}wb(t,s,i){const e=this.getTarget(),n="connect"==s?null!=this.Wv?this.Wv:"*":this.getTargetOrigin();e.postMessage({"sentinel":$t,"_rsvp":t,"cmd":s,"payload":i||null},n)}YF(t){const s=t,{data:i}=s;if(!i||i.sentinel!=$t)return;const e=s.origin,n=i.cmd,r=i.payload||null;if(null==this.Wv&&"start"==n&&(this.Wv=e),null==this.Wv&&s.source&&this.ePt()==s.source&&(this.Wv=e),e!=this.Wv)return;const o=i._rsvp,h=!!o&&"rsvp"!=n,c=this.nPt(o,n,r);h&&Promise.resolve(c).then((t=>{this.wb(o,"rsvp",{"result":t})}),(t=>{this.wb(o,"rsvp",{"error":String(t)})}))}nPt(t,s,i){if("rsvp"!=s)return this.ZAt(s,i);{const s=t&&this.sPt[t];s&&("error"in i?s.resolver(Promise.reject(new Error(i.error))):s.resolver(i.result),delete this.sPt[t])}}}(this.ji.win,(()=>this.Lv.contentWindow),this.Wv),this.UA=null,this.Uy()}getEntitlements(){return this.connect().then((()=>this.XAt.sendCommandRsvp("authorize",{}).then((t=>(t.source="local-iframe",t))).then((t=>_t.parseFromJson(t)))))}isPingbackEnabled(){return!0}pingback(t){return this.connect().then((()=>this.XAt.sendCommandRsvp("pingback",{entitlement:t})))}connect(){if(!this.BAt){const t=new e;this.BAt=t.promise,this.WAt=t.resolve,this.UA=this.cPt(),this.XAt.connect(this.nPt.bind(this)),this.ji.getBody().appendChild(this.Lv),this.Lv.src=this.av}return this.BAt}cPt(){return new Promise((t=>{const s=l(JSON.stringify(this.xot)),i=this.cst.getPageConfig();if(s.pageConfig={publicationId:i.getPublicationId(),productId:i.getProductId(),encryptedDocumentKey:this.cst.getEncryptedDocumentKey("local")||null},this.HAt){const i=this.HAt.join("&");this.lot.collectUrlVars(i,!1).then((i=>{s.iframeVars=i,t(s)}))}else t(s)}))}nPt(t,s){"connect"===t&&this.UA.then((t=>{this.XAt.sendCommandRsvp("start",{"protocol":"amp-subscriptions","config":t}).then((()=>{this.WAt&&(this.WAt(),this.WAt=null)}))}))}},Kt=class extends Ft{constructor(t,s,i){super(t,s,i),this.apt=Rt(E(this.xot.authorizationUrl,"Service config does not have authorization Url"),"Authorization Url"),this.f$=w(this.ji.win,"xhr"),this.ppt=this.xot.pingbackUrl||null,this.Uy()}getEntitlements(){const t=this.lot.buildUrl(this.apt,!1),s=this.cst.loadMeteringState();return Promise.all([t,s]).then((t=>{let s=t[0];const i=t[1];i&&(s=wt(s,"meteringState",btoa(JSON.stringify(i))));const e=this.cst.getEncryptedDocumentKey("local");return e&&(s=wt(s,"crypt",e)),this.f$.fetchJson(s,{credentials:"include"}).then((t=>t.json())).then((t=>{const s=[];return t.metering&&t.metering.state&&s.push(this.cst.saveMeteringState(t.metering.state)),Promise.all(s).then((()=>_t.parseFromJson(t)))}))}))}isPingbackEnabled(){return!!this.ppt}fbt(t){if(u(t)){const s=[];return t.forEach((t=>{s.push(t.jsonForPingback())})),JSON.stringify(s)}return JSON.stringify(t.jsonForPingback())}pingback(t){if(!this.isPingbackEnabled)return;const s=v(this.ppt);return this.lot.buildUrl(s,!0).then((s=>this.f$.sendSignal(s,{method:"POST",credentials:"include",headers:{"Content-Type":"text/plain"},body:this.fbt(t)})))}};function Gt(t,s,i){return"iframe"===s.type?new zt(t,s,i):new Kt(t,s,i)}var Bt=class{constructor(){this.Fn=null}add(t){return this.Fn||(this.Fn=[]),this.Fn.push(t),()=>{this.remove(t)}}remove(t){this.Fn&&function(t,s){const i=t.indexOf(s);-1!=i&&t.splice(i,1)}(this.Fn,t)}removeAll(){this.Fn&&(this.Fn.length=0)}fire(t){if(this.Fn)for(const s of this.Fn.slice())s(t)}getHandlerCount(){var t,s;return null!==(t=null===(s=this.Fn)||void 0===s?void 0:s.length)&&void 0!==t?t:0}},Wt=class{constructor(t,s,i,n,r){this.dbt=n||{},this.pbt=t,this.mbt={},this.gbt={},t.forEach((t=>{this.gbt[t]=new e})),this.bbt=new Bt,this._bt=new Bt,this.Pbt=null,this.Abt=null,this.ybt=null,this.vbt=null,this.Ebt=[],this.wbt=i,this.Rbt=Object.assign(it,s),this.Ibt=r||new Bt}resolvePlatform(t,s){this.dbt[t]=s,this._bt.fire({platformKey:t})}resetPlatformStore(){for(const t in this.dbt)this.dbt[t].reset();return new Wt(this.pbt,this.Rbt,this.wbt,this.dbt,this.Ibt)}resetPlatform(t){delete this.mbt[t],this.gbt[t]=new e,this.dbt[t].reset(),this.Pbt=null,this.Abt=null,this.ybt=null,this.vbt=null}onPlatformResolves(t,s){const i=this.dbt[t];i?s(i):this._bt.add((i=>{i.platformKey===t&&s(this.getPlatform(t))}))}getPlatform(t){const s=this.dbt[t];return v(s),s}Tbt(){return this.getPlatform("local")}getAvailablePlatforms(){const t=[];for(const s in this.dbt){const i=this.dbt[s];t.push(i)}return t}onChange(t){this.bbt.add(t)}addOnEntitlementResolvedCallback(t){this.Ibt.add(t)}resolveEntitlement(t,s){s&&(s.service=t),this.mbt[t]=s;const i=this.gbt[t];i&&i.resolve(s),-1!==this.Ebt.indexOf(t)&&this.Ebt.splice(this.Ebt.indexOf(t),1),s.granted&&this.Sbt(s),this.bbt.fire({platformKey:t,entitlement:s}),this.Ibt.fire({platformKey:t,entitlement:s})}getResolvedEntitlementFor(t){return v(this.mbt[t]),this.mbt[t]}getEntitlementPromiseFor(t){return v(this.gbt[t]),this.gbt[t].promise}getScoreFactorStates(){const t={};return Promise.all(this.pbt.map((s=>(t[s]={},Promise.all(Object.values(st).map((i=>this.kbt(s,i).then((e=>{t[s][i]=e}))))))))).then((()=>t))}kbt(t,s){return this.getEntitlementPromiseFor(t).then((()=>this.dbt[t].getSupportedScoreFactor(s)))}getGrantStatus(){if(null!==this.Pbt)return this.Pbt.promise;this.Pbt=new e;for(const t in this.mbt){const s=this.mbt[t];s.granted&&(this.Sbt(s),this.Pbt.resolve(!0))}return this.Mbt()?this.Pbt.resolve(!1):this.onChange((t=>{const{entitlement:s}=t;s.granted?this.Pbt.resolve(!0):this.Mbt()&&this.Pbt.resolve(!1)})),this.Pbt.promise}Sbt(t){(!this.Abt&&t.granted||this.Abt&&!this.Abt.isSubscriber()&&t.isSubscriber())&&(this.Abt=t)}getGrantEntitlement(){const t=()=>this.Abt&&(this.Abt.isSubscriber()||this.Abt.isFree()),s=()=>t()||this.Mbt();return this.ybt||(this.ybt=new e,s()?this.ybt.resolve(this.Abt):this.bbt.add((()=>{s()&&this.ybt.resolve(this.Abt)}))),this.ybt.promise}reset(){this.Pbt=null}getAllPlatformsEntitlements(){return this.vbt||(this.vbt=new e,this.Mbt()?this.vbt.resolve(this.Vbt()):this.onChange((()=>{this.Mbt()&&this.vbt.resolve(this.Vbt())}))),this.vbt.promise}Vbt(){const t=[];for(const s in this.mbt)h(this.mbt,s)&&t.push(this.mbt[s]);return t}selectPlatform(){return this.getAllPlatformsEntitlements().then((()=>this.xbt()))}Mbt(){return Object.keys(this.mbt).length===this.pbt.length}Obt(t,s){const i=s.getSupportedScoreFactor(t);return"number"!=typeof i?0:this.Rbt[t]*Math.min(1,Math.max(-1,i))}xbt(){v(this.Mbt());const t=this.getAvailablePlatforms();for(;t.length;){const s=t.pop(),i=this.getResolvedEntitlementFor(s.getPlatformKey());if(i.isSubscriber()||i.isFree())return s}return this.Cbt(this.Lbt())}Lbt(){return this.getAvailablePlatforms().map((t=>({platform:t,weight:this.Ubt(t)})))}Ubt(t){const s=[0],i=t.getBaseScore();for(const i in this.Rbt)h(this.Rbt,i)&&s.push(this.Obt(i,t));return i+s.reduce(((t,s)=>t+s))}Cbt(t){const s=this.Tbt();return t.sort(((t,i)=>i.weight===t.weight&&t.platform===s?-1:i.weight-t.weight)),t[0].platform}Dbt(t){const s=this.getAvailablePlatforms().map((s=>{const i=s.getSupportedScoreFactor(t);return{platform:s,weight:"number"==typeof i?i:0}}));return this.Cbt(s)}reportPlatformFailureAndFallback(t){if(t===this.Tbt().getPlatformKey()&&this.wbt)this.resolveEntitlement(this.Tbt().getPlatformKey(),this.wbt);else if(-1===this.Ebt.indexOf(t)){const s=_t.empty(t);this.resolveEntitlement(t,s),this.Ebt.push(t)}}selectPlatformForLogin(){return this.Dbt(st.SUPPORTS_VIEWER)}},Jt="i-amphtml-subs",Yt={"-":"+","_":"/",".":"="};function Ht(t){return nt(atob(t.replace(/[-_.]/g,(t=>Yt[t]))))}function Qt(t,s,i){if(s[i])return s[i];const e=t.querySelector(`style[${i}], link[${i}]`);return e?(s[i]=e,e):null}function Zt(t,s){const i=t.styleSheets;for(let t=0;t<i.length;t++)if(i[t].ownerNode==s)return!0;return!1}var Xt=self.__AMP_ERRORS||[];self.__AMP_ERRORS=Xt;var qt="amp-subscriptions";t.registerServiceForDoc("subscriptions",(function(t){return new class{constructor(t){const s=t.getElementById(qt);this.ji=t,function(t,s,i,e,n){const r=t.getHeadNode(),h=function(t,s,i,e){let n=t.__AMP_CSS_SM;n||(n=t.__AMP_CSS_SM=o());const r=`amp-extension=${e}`;if(r){const i=Qt(t,n,r);if(i)return"STYLE"==i.tagName&&i.textContent!==s&&(i.textContent=s),i}const h=(t.ownerDocument||t).createElement("style");h.textContent=s;let c=null;return h.setAttribute("amp-extension",e),c=Qt(t,n,"amp-runtime"),function(t,s,i=null){if(!i)return void function(t,s){t.insertBefore(s,t.firstChild)}(t,s);const e=i.nextSibling;t.insertBefore(s,e)}(t,h,c),r&&(n[r]=h),h}(r,function(t,s){const i=t.__AMP_CSS_TR;return i?i(s):s}(r,'[subscriptions-action]:not(.i-amphtml-subs-display),[subscriptions-actions]:not(.i-amphtml-subs-display),[subscriptions-section=actions]:not(.i-amphtml-subs-display),body.i-amphtml-subs-delegated [subscriptions-section=actions],body.i-amphtml-subs-grant-unk [subscriptions-action],body.i-amphtml-subs-grant-unk [subscriptions-section=actions],body:not(.i-amphtml-subs-grant-no) [subscriptions-section=content-not-granted],body:not(.i-amphtml-subs-grant-yes) [subscriptions-section=content],body:not(.i-amphtml-subs-loading) [subscriptions-section=loading]{display:none!important}amp-subscriptions-dialog{display:block!important;position:fixed!important;bottom:0!important;left:0!important;margin-left:0!important;width:100%!important;z-index:2147483641!important;max-height:90vh;box-sizing:border-box;opacity:1;background-image:none;background-color:#fff;box-shadow:0 0 5px 0 rgba(0,0,0,0.2);margin-bottom:0;transition:transform 0.3s ease-in}.i-amphtml-subs-dialog-close-button{position:absolute;width:28px;height:28px;top:-28px;right:0;background-image:url(\'data:image/svg+xml;charset=utf-8,<svg width="13" height="13" viewBox="341 8 13 13" xmlns="http://www.w3.org/2000/svg"><path fill="%234F4F4F" d="M354 9.31 352.69 8l-5.19 5.19L342.31 8 341 9.31l5.19 5.19-5.19 5.19 1.31 1.31 5.19-5.19 5.19 5.19 1.31-1.31-5.19-5.19z" fill-rule="evenodd"/></svg>\');background-size:13px 13px;background-position:9px;background-color:#fff;background-repeat:no-repeat;box-shadow:0 -1px 1px 0 rgba(0,0,0,0.2);border:none;border-radius:12px 0 0 0;cursor:pointer}body:not(.i-amphtml-subs-grant-yes) .i-amphtml-subs-dialog-close-button{display:none}.i-amphtml-subs-progress{height:2px;background-color:#ccc;position:relative;margin:8px;overflow:hidden}.i-amphtml-subs-progress:after{content:"";background-color:#2196f3;height:2px;position:absolute;left:0;top:0;width:20%;animation:i-amphtml-subs-loading-progress 1500ms ease-in-out infinite}@keyframes i-amphtml-subs-loading-progress{0%{transform:translateX(-100%)}to{transform:translateX(500%)}}@media (min-width:480px){amp-subscriptions-dialog{width:480px!important;left:-240px!important;margin-left:50vw!important}}\n/*# sourceURL=/extensions/amp-subscriptions/0.1/amp-subscriptions.css*/'),0,"amp-subscriptions");if(i){const s=t.getRootNode();if(Zt(s,h))return h;const i=setInterval((()=>{Zt(s,h)&&clearInterval(i)}),4)}}(t,0,(()=>{})),this.Aa=null,this.tp=new class{constructor(t){this.ji=t,this.ja=R(t,"mutator"),this.setGrantState(null),this.Nbt().classList.add(`${Jt}-ready`),this.addLoadingBar()}Nbt(){return this.ji.getBody()}cR(t,s){this.ja.mutateElement(this.ji.getBody(),(()=>{this.Nbt().classList.toggle(`${Jt}-${t}-unk`,null===s),this.Nbt().classList.toggle(`${Jt}-${t}-yes`,!0===s),this.Nbt().classList.toggle(`${Jt}-${t}-no`,!1===s)}))}addLoadingBar(){return this.ji.whenReady().then((()=>{const t=this.ji.getBody();if(!t.querySelector("[subscriptions-section=loading]")){const i=p(this.ji.win.document,"div",{"class":"i-amphtml-subs-progress","subscriptions-section":"loading"});t.insertBefore(i,(s=t,f(/^[\w-]+$/.test("footer")),"> footer",s.querySelector(function(t,s){return t.replace(/^|,/g,"$&:scope ")}("> footer"))))}var s}))}jbt(t,s){this.ja.mutateElement(this.ji.getBody(),(()=>{this.Nbt().classList.toggle(`${Jt}-${t}`,s)}))}setGrantState(t){this.cR("grant",t)}toggleLoading(t){this.jbt("loading",t)}}(t),this.Fbt=null,this.$bt=null,this.zbt=null,this.Kbt=P().assertElement(s),this.Jit=new class{constructor(t){this._n=t,this.te=[]}registerEventListener(t){this.te.push(t)}serviceEvent(t,s,i,e){this.event(t,X({"serviceId":s},i),e)}event(t,s,i){i=i||{};const e=t!==q?t:t+`-${i.action}-${i.status}`;s=s||{},function(t,s,i={},e=!0){var n;(n=t,function(t,s,i,e){const n=T(t,s);if(n)return n;const r=S(t);return r.whenExtensionsKnown().then((()=>{const t=r.getExtensionVersion(i);return t?w(r.win,"extensions").waitForExtension(i,t):null})).then((i=>i?I(t,s):null))}(n,"amp-analytics-instrumentation","amp-analytics")).then((n=>{n&&n.triggerEventForTarget(t,s,i,e)}))}(this._n,e,s,!1);for(let e=0;e<this.te.length;e++)this.te[e](t,s,i)}actionEvent(t,s,i,e){this.serviceEvent(q,t,e,{"action":s,"status":i})}}(this.Kbt),this.cst=new class{constructor(t){this.i4=t}getAnalytics(){return this.i4.getAnalytics()}getDialog(){return this.i4.getDialog()}getEncryptedDocumentKey(t){return this.i4.getEncryptedDocumentKey(t)}getPageConfig(){return this.i4.getPageConfig()}getReaderId(t){return this.i4.getReaderId(t)}getScoreFactorStates(){return this.i4.getScoreFactorStates()}delegateActionToLocal(t,s){return this.delegateActionToService(t,"local",s)}delegateActionToService(t,s,i){return this.i4.delegateActionToService(t,s,i)}decorateServiceAction(t,s,i,e){this.i4.decorateServiceAction(t,s,i,e)}resetPlatforms(){this.i4.resetPlatforms()}selectPlatformForLogin(){return this.i4.selectPlatformForLogin()}loadMeteringState(){return this.i4.Gbt?this.i4.Gbt.loadMeteringState():Promise.resolve(null)}saveMeteringState(t){return this.i4.Gbt?this.i4.Gbt.saveMeteringState(t):i()}rememberMeteringEntitlementsWereFetched(){this.i4.Gbt&&(this.i4.Gbt.entitlementsWereFetchedWithCurrentMeteringState=!0)}}(this),this.uAt=new class{constructor(t){this.ji=t,this.Xh=w(t.win,"vsync"),this.Qe=C(t.win),this.Tc=U(t),this.Fo=!1,this._N=null,this.Bbt=i();const s=this.ji.win.document;this.lo=p(s,"amp-subscriptions-dialog",{"role":"dialog"}),ft(this.lo,!1),this._B=p(s,"button",{"class":"i-amphtml-subs-dialog-close-button"}),this.showCloseAction(!1),this.lo.appendChild(this._B),this._B.addEventListener("click",(()=>{this.close()})),this.ji.getBody().appendChild(this.lo),at(this.lo,{transform:"translateY(100%)"})}getRoot(){return this.lo}isVisible(){return this.Fo}open(t,s=!0){return this.Da((()=>this.RL(t,s)))}close(){return this.Da((()=>this.gR()))}Da(t){return this.Bbt=this.Bbt.then(t)}RL(t,s=!0){return this._N?this.lo.replaceChild(t,this._N):this.lo.appendChild(t),this._N=t,this.Fo?i():(this.Fo=!0,this.Xh.mutatePromise((()=>{ft(this.lo,!0),this.showCloseAction(s)})).then((()=>this.Xh.mutatePromise((()=>{at(this.lo,{transform:"translateY(0)"})})).then((()=>this.Qe.promise(300))))).then((()=>{let t;return this.Xh.runPromise({measure:()=>{t=this.lo.offsetHeight},mutate:()=>{this.Tc.updatePaddingBottom(t),this.Tc.addToFixedLayer(this.lo,!0)}})})))}gR(){return this.Fo?this.Xh.mutatePromise((()=>{at(this.lo,{transform:"translateY(100%)"})})).then((()=>this.Qe.promise(300))).then((()=>this.Xh.mutatePromise((()=>{ft(this.lo,!1),this.Tc.updatePaddingBottom(0),this.Fo=!1})))):i()}showCloseAction(t){ft(this._B,t)}}(t),this.Wbt=new class{constructor(t){this.ji=t,this.yAt=null,this.Qe=C(t.win),this.Tc=U(t)}scheduleView(t){return this.yAt=null,this.ji.whenReady().then((()=>new Promise((t=>{this.ji.isVisible()&&t(),this.ji.onVisibilityChanged((()=>{this.ji.isVisible()&&t()}))})).then((()=>this.VPt(t)))))}VPt(t){return this.yAt||(this.yAt=this.SPt(t).catch((t=>{throw this.yAt=null,t}))),this.yAt}SPt(t){if(0==t)return i();const s=[];return new Promise(((i,e)=>{s.push(this.ji.onVisibilityChanged((()=>{this.ji.isVisible()||e(new Error("CANCELLED"))})));const n=this.Qe.delay(i,t);s.push((()=>this.Qe.cancel(n))),s.push(this.Tc.onScroll(i)),s.push(function(t,s,i,e){let n=i;const r=It(t,"click",(t=>{try{n(t)}finally{n=null,r()}}),void 0);return r}(this.ji.getRootNode(),0,i))})).then((()=>{s.forEach((t=>t()))}),(t=>{throw s.forEach((t=>t())),t}))}}(t),this.br=L(t),this.Jbt=null,this.Qe=C(t.win),this.Ybt=this.br.hasCapability("auth"),this.Hbt=this.Ybt&&this.br.hasCapability("paywall"),this.gAt=I(t,"cid"),this.Qbt={},this.Zbt=new class{constructor(t){this.ji=t,this.Xbt=null;const s=this.ji.getRootNode().querySelector("script[cryptokeys]");this.qbt=null,s&&s.hasAttribute("sha-256-hash")&&(this.qbt=s.getAttribute("sha-256-hash")),this.xPt=s&&a(s.textContent)||null}isDocumentEncrypted(){return!!this.xPt&&Object.keys(this.xPt).length>0}getEncryptedKeys(){return this.xPt}getEncryptedDocumentKey(t){const s=this.getEncryptedKeys();return s&&s[t]||null}tryToDecryptDocument(t){if(!this.qbt)return this.CPt(t);const s=(i=t,"undefined"!=typeof TextEncoder?(new TextEncoder).encode(i):nt(unescape(encodeURIComponent(i))));var i;return crypto.subtle.digest("SHA-256",s).then((s=>{var i;return((i=new Uint8Array(s))?Array.prototype.slice.call(i):[]).map((t=>function(t,s,i){if(t.length>=s)return t;s-=t.length;let e="0";for(;s>e.length;)e+="0";return e.slice(0,s)+t}(t.toString(16),2))).join("")!=this.qbt?Promise.reject(new Error("Invalid Document Key")):this.CPt(t)}))}CPt(t){return this.Xbt||(this.Xbt=this.ji.whenReady().then((()=>{return(s=ot(t).buffer,rt((self.msCrypto?self.msCrypto.subtle:self.crypto.subtle).importKey("raw",s,"AES-GCM",!0,["decrypt"]))).then((t=>{const s=this.ji.getRootNode().querySelectorAll("script[ciphertext]"),i=[];return s.forEach((s=>{const e=ot(s.textContent.replace(/\s+/g,"")).buffer,n=e.slice(0,12),r=e.slice(12);i.push(function(t,s,i){const e=!!self.msCrypto;return rt((e?self.msCrypto.subtle:self.crypto.subtle).decrypt({name:"AES-GCM",iv:s,tag:e?i.slice(i.byteLength-16):void 0,tagLength:128},t,e?i.slice(0,i.byteLength-16):i)).then((t=>function(t){if("undefined"!=typeof TextDecoder)return new TextDecoder("utf-8").decode(t);const s=new Uint8Array(t.buffer||t),i=new Array(s.length);for(let t=0;t<s.length;t++)i[t]=String.fromCharCode(s[t]);const e=i.join("");return decodeURIComponent(escape(e))}(new Uint8Array(t))))}(t,n,r).then((t=>{s.outerHTML=t})))})),Promise.all(i)}));var s}))),this.Xbt}}(t),this.Gbt=null}start(){return this.He().then((()=>{if(this.Jit.event("subscriptions-started"),this.tp.toggleLoading(!0),E(this.Fbt,"Page config is null"),this.Ybt)return this.LPt(),void this.UPt(!1);E(this.$bt.services,"Services not configured in service config");const t=this.$bt.services.map((t=>t.serviceId||"local"));this.DPt(t),this.$bt.services.forEach((t=>{this.NPt(t)})),this.zbt.getAvailablePlatforms().forEach((t=>{this.jPt(t)})),function(t){return t.waitForBodyOpen().then((()=>{const s=t.getBody(),i=(e=s,n=()=>!!s.firstElementChild,new Promise((t=>{!function(t,s,i){if(s(t))i();else{const e=new(d(t).MutationObserver)((()=>{s(t)&&(e.disconnect(),i())}));e.observe(t,{childList:!0})}}(e,n,t)})));var e,n;return C(t.win).timeoutPromise(2e3,i).then((()=>"AMP-STORY"===s.firstElementChild.tagName),(()=>!1))}))}(this.ji).then((t=>{t&&this.uAt.getRoot().classList.add("i-amphtml-story-subscriptions-dialog-wrapper"),this.UPt(!t)}))})),this}getAccessReaderId(){return this.He().then((()=>this.getReaderId("local")))}getAnalytics(){return this.Jit}getAuthdataField(t){return this.He().then((()=>this.zbt.getEntitlementPromiseFor("local"))).then((s=>c(s.json(),t)))}getDialog(){return this.uAt}maybeRenderDialogForSelectedPlatform(){return this.He().then((()=>{if(!this.Ybt&&!this.$bt.alwaysGrant)return this.FPt()}))}getGrantStatus(){return this.zbt.getGrantStatus()}addOnEntitlementResolvedCallback(t){this.zbt.addOnEntitlementResolvedCallback(t)}getEncryptedDocumentKey(t){return this.Zbt.getEncryptedDocumentKey(t)}getPageConfig(){return v(this.Fbt)}getReaderId(t){let s=this.Qbt[t];if(!s){const e=i(),n="amp-access"+("local"==t?"":"-"+t);s=this.gAt.then((t=>t.get({scope:n,createCookieIfNotPresent:!0},e))),this.Qbt[t]=s}return s}getScoreFactorStates(){return this.zbt.getScoreFactorStates()}registerPlatform(t,s){return this.He().then((()=>{if(this.Ybt)return;const i=E(this.$bt.services.filter((s=>(s.serviceId||"local")===t))[0],"No matching services for the ID found"),e=s(i,this.cst);this.zbt.resolvePlatform(e.getPlatformKey(),e),this.Jit.serviceEvent("subscriptions-service-registered",e.getPlatformKey()),this.Jit.serviceEvent("subscriptions-platform-registered",e.getPlatformKey()),this.jPt(e)}))}selectPlatformForLogin(){return this.zbt.selectPlatformForLogin()}He(){if(!this.Aa){const t=new class{constructor(t){this.ji=t,this.Tc=U(this.ji)}getWin(){return this.ji.win}getRootNode(){return this.ji.getRootNode()}getRootElement(){const t=this.ji.getRootNode();return t.documentElement||t.body||t}getHead(){return this.ji.getHeadNode()}getBody(){return this.ji.isBodyAvailable()?this.ji.getBody():null}isReady(){return this.ji.isReady()}whenReady(){return this.ji.whenReady()}addToFixedLayer(t){return this.Tc.addToFixedLayer(t,!0)}}(this.ji),s=new class{constructor(t){var s;this.doc_=9===(s=t).nodeType||s.document?new class{constructor(t){const s=!!t.document;this.win_=s?t:t.defaultView,this.doc_=s?t.document:t}getWin(){return this.win_}getRootNode(){return this.doc_}getRootElement(){return this.doc_.documentElement}getHead(){return this.doc_.head}getBody(){return this.doc_.body}isReady(){return D(this.doc_)}whenReady(){return t=this.doc_,new Promise((s=>{!function(t,s){!function(t,s,i){if(s(t))return void i(t);let e=!1;const n=()=>{s(t)&&!e&&(i(t),e=!0,t.removeEventListener("readystatechange",n))};t.addEventListener("readystatechange",n)}(t,D,s)}(t,s)}));var t}addToFixedLayer(t){return i()}}(s):s,this.configResolver_=null,this.configPromise_=new Promise((t=>{this.configResolver_=t})),this.metaParser_=new class{constructor(t){this.doc_=t}check(){if(!this.doc_.getBody())return null;const t=H(this.doc_.getRootNode(),"subscriptions-product-id");if(!t)return null;const s=H(this.doc_.getRootNode(),"subscriptions-accessible-for-free"),i=!(!s||"false"!==s.toLowerCase());return new N(t,i)}}(this.doc_),this.ldParser_=new class{constructor(t){this.doc_=t,this.checkType_=new Y}check(){if(!this.doc_.getBody())return null;const t=this.doc_.isReady(),s=this.doc_.getRootNode().querySelectorAll('script[type="application/ld+json"]');for(let i=0;i<s.length;i++){const e=s[i];if(e[B]||!e.textContent||!t&&!F(e))continue;if(e[B]=!0,!J.test(e.textContent))continue;const n=this.tryExtractConfig_(e);if(n)return n}return null}tryExtractConfig_(t){let s=function(t,s){try{return function(t){return JSON.parse(t)}(t)}catch(t){return}}(t.textContent);if(!s)return null;Array.isArray(s)||(s=[s]);let i=s;for(let t=0;t<i.length;t++){const s=i[t];if(s["@graph"]&&Array.isArray(s["@graph"])&&(i=i.concat(s["@graph"])),!this.checkType_.checkValue(s["@type"],W))continue;let e=null;const n=this.valueArray_(s,"isPartOf");if(n)for(let t=0;t<n.length&&(e=this.discoverProductId_(n[t]),!e);t++);if(!e)continue;const r=this.bool_(this.singleValue_(s,"isAccessibleForFree"),!0);return new N(e,!r)}return null}bool_(t,s){if("boolean"==typeof t)return t;if("string"==typeof t){const s=t.toLowerCase();if("false"===s)return!1;if("true"===s)return!0}return s}discoverProductId_(t){return this.checkType_.checkValue(t["@type"],["Product"])?this.singleValue_(t,"productID"):null}valueArray_(t,s){const i=t[s];return null==i||""===i?null:Array.isArray(i)?i:[i]}singleValue_(t,s){const i=this.valueArray_(t,s),e=i&&i[0];return null==e||""===e?null:e}}(this.doc_),this.microdataParser_=new class{constructor(t){this.doc_=t,this.access_=null,this.productId_=null,this.checkType_=new Y}discoverAccess_(t){const s=t.querySelectorAll("[itemprop='isAccessibleForFree']");for(let i=0;s[i];i++){const e=s[i],n=e.getAttribute("content")||e.textContent;if(n&&this.isValidElement_(e,t,"alreadySeenForAccessInfo")){let t=null;return"true"==n.toLowerCase()?t=!0:"false"==n.toLowerCase()&&(t=!1),t}}return null}isValidElement_(t,s,i){for(let s=t;s&&!s[i];s=s.parentNode)if(s[i]=!0,s.hasAttribute&&s.hasAttribute("itemscope")){const t=s.getAttribute("itemtype");return this.checkType_.checkString(t,W)}return!1}discoverProductId_(t){const s=t.querySelectorAll('[itemprop="productID"]');for(let i=0;s[i];i++){const e=s[i],n=e.getAttribute("content")||e.textContent,r=e.closest("[itemtype][itemscope]");if(!(r.getAttribute("itemtype").indexOf("http://schema.org/Product")<=-1)&&this.isValidElement_(r.parentElement,t,"alreadySeenForProductInfo"))return n}return null}getPageConfig_(){let t=null;return null!=this.access_?t=!this.access_:this.doc_.isReady()&&(t=!1),null!=this.productId_&&null!=t?new N(this.productId_,t):null}tryExtractConfig_(){let t=this.getPageConfig_();if(t)return t;const s=Array.prototype.slice.call(this.doc_.getRootNode().querySelectorAll("[itemscope][itemtype]")).filter((t=>this.checkType_.checkString(t.getAttribute("itemtype"),W)));for(let i=0;s[i]&&null==t;i++){const e=s[i];null==this.access_&&(this.access_=this.discoverAccess_(e)),this.productId_||(this.productId_=this.discoverProductId_(e)),t=this.getPageConfig_()}return t}check(){return this.doc_.getBody()?this.tryExtractConfig_():null}}(this.doc_)}resolveConfig(){return i().then(this.check.bind(this)),this.doc_.whenReady().then(this.check.bind(this)),this.configPromise_}check(){if(!this.configResolver_)return null;const t=this.metaParser_.check()||this.ldParser_.check()||this.microdataParser_.check();return t?(this.configResolver_(t),this.configResolver_=null):this.doc_.isReady()&&(this.configResolver_(Promise.reject(G.createError("No config could be discovered in the page"))),this.configResolver_=null),function(t){if(/swg.debug=1/.test(self.location.hash)){const t=Array.prototype.slice.call(arguments,0);t.unshift("[Subscriptions]"),j.apply(j,t)}}(t),t}}(t);this.Aa=Promise.all([this.$Pt(),s.resolveConfig()]).then((t=>{this.$bt=t[0],this.Fbt=t[1]})).then((()=>{this.zPt()}))}return this.Aa}NPt(t){"local"==(t.serviceId||"local")&&this.zbt.resolvePlatform("local",Gt(this.ji,t,this.cst))}$Pt(){return new Promise((t=>{t(a(this.Kbt.textContent,(t=>{throw P().createError('Failed to parse "amp-subscriptions" JSON: ',t)})))}))}KPt(t){this.tp.toggleLoading(!1),this.Jbt=this.Wbt.scheduleView(2e3),this.Hbt&&!t||this.tp.setGrantState(t)}GPt(t,s){this.zbt.resolveEntitlement(t,s),s.decryptedDocumentKey&&this.Zbt.tryToDecryptDocument(s.decryptedDocumentKey),this.Jit.serviceEvent("subscriptions-entitlement-resolved",t)}BPt(t){return t.getEntitlements().then((s=>s&&s.granted&&this.Zbt.isDocumentEncrypted()&&!s.decryptedDocumentKey?(("local"==t.getPlatformKey()?P():y()).error(qt,`${t.getPlatformKey()}: Subscription granted and encryption enabled, but no decrypted document key returned.`),null):s))}jPt(t){return this.WPt()?i():(t.isPrerenderSafe()?i():this.ji.whenFirstVisible()).then((()=>this.Qe.timeoutPromise(3e3,this.BPt(t)).then((s=>(s=s||_t.empty(t.getPlatformKey()),this.GPt(t.getPlatformKey(),s),s))).catch((s=>{const i=t.getPlatformKey();throw this.zbt.reportPlatformFailureAndFallback(i),P().createError(`fetch entitlements failed for ${i}`,s)}))))}DPt(t){const s=this.$bt.fallbackEntitlement?_t.parseFromJson(this.$bt.fallbackEntitlement):_t.empty("local");this.zbt=new Wt(t,this.$bt.score,s),this.JPt(this.zbt)}LPt(){const t=vt(this.ji.win);this.DPt(["local"]),this.$bt.services.forEach((s=>{if("local"==(s.serviceId||"local")){const i=new class{constructor(t,s,i,e){this.ji=t,this.cst=i,this.Fbt=i.getPageConfig(),this.Po=Gt(t,s,i),this.br=L(this.ji),this.br.onMessage("subscriptionchange",this.YPt.bind(this)),this.Y_t=new class{constructor(t){this.win=t,this.Z_t=t.crypto&&(t.crypto.subtle||t.crypto.webkitSubtle)||null}decode(t){return this.tAt(t).payload}isVerificationSupported(){return!!this.Z_t}decodeAndVerify(t,s){if(!this.Z_t)throw new Error("Crypto is not supported on this platform");return new Promise((s=>s(this.tAt(t)))).then((t=>{const i=t.header.alg;if(!i||"RS256"!=i)throw new Error("Only alg=RS256 is supported");return this.iAt(s).then((s=>{const i=Ht(t.sig);return this.Z_t.verify({name:"RSASSA-PKCS1-v1_5"},s,i,nt(t.verifiable))})).then((s=>{if(s)return t.payload;throw new Error("Signature verification failed")}))}))}tAt(t){function s(){throw new Error(`Invalid token: "${t}"`)}const i=t.split(".");3!=i.length&&s();const e=Ht(i[0]),n=Ht(i[1]);return{header:a(et(e),s),payload:a(et(n),s),verifiable:`${i[0]}.${i[1]}`,sig:i[2]}}iAt(t){return t.then((t=>this.Z_t.importKey("spki",function(t){const s=t.trim().replace(/^-+BEGIN[^-]*-+/,"").replace(/-+END[^-]*-+$/,"").replace(/[\r\n]/g,"").trim();return nt(atob(s))}(t),{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"])))}}(t.win),this.HPt=this.Fbt.getPublicationId(),this.QPt=this.Fbt.getProductId(),this.h=e,this.Qe=C(t.win)}isPrerenderSafe(){return!0}getEntitlements(){v(this.QPt);const t={"publicationId":this.HPt,"productId":this.QPt,"origin":this.h};let s;const i=this.br.getParam("cryptokeys")||"google.com";if(i){const t=i.split(",");for(let i=0;i!=t.length&&(s=this.cst.getEncryptedDocumentKey(t[i]),!s);i++);}return s&&(t.encryptedDocumentKey=s),this.Qe.timeoutPromise(3e3,this.br.sendMessageAwaitResponse("auth",t)).then((t=>{const s=(t=t||{}).error,i=t.authorization,e=t.decryptedDocumentKey;if(s)throw new Error(s.message);return i?this.ZPt(i,e).catch((t=>{throw this.XPt(t.message),t})):_t.empty("local")}))}ZPt(t,s){return new Promise((i=>{const e=vt(this.ji.win),n=Et(function(t){if(!function(t){return Pt.cdnProxyRegex.test(yt(t).origin)}(t=yt(t)))return t.href;const s=t.pathname.split("/"),i=s[1];E(At.has(i),"Unknown path prefix in url %s",t.href);const e=s[2],n="s"==e?"https://"+decodeURIComponent(s[3]):"http://"+decodeURIComponent(e);return E(n.indexOf(".")>0,"Expected a . in origin %s",n),s.splice(1,"s"==e?3:2),n+s.join("/")+function(t,s){if(!t||"?"==t)return"";const i=new RegExp("[?&](amp_(js[^&=]*|gsa|r|kit)|usqp)\\b[^&]*","g"),e=t.replace(i,"").replace(/^[?&]/,"");return e?"?"+e:""}(t.search)+(t.hash||"")}(this.ji.win.location)).origin,r=this.Y_t.decode(t),o=E(this.Fbt.getProductId(),"Product id is null");if(r.aud!=e&&r.aud!=n)throw P().createError(`The mismatching "aud" field: ${r.aud}`);if(r.exp<Math.floor(Date.now()/1e3))throw P().createError("Payload is expired");const h=r.entitlements;let c,u=_t.empty("local");if(h){if(Array.isArray(h)){for(let t=0;t<h.length;t++)if(-1!==h[t].products.indexOf(o)){c=h[t];break}}else-1!==h.products.indexOf(o)&&(c=h);c&&(u=new _t({source:"viewer",raw:t,granted:!0,grantReason:c.subscriptionToken?mt:"",dataObject:c,decryptedDocumentKey:s}))}r.metering&&!u.granted&&(u=new _t({source:r.iss||"",raw:t,granted:!0,grantReason:gt,dataObject:r.metering,decryptedDocumentKey:s})),u.service="local",i(u)}))}XPt(t){this.br.sendMessage("auth-rejected",{"reason":t})}getPlatformKey(){return this.Po.getPlatformKey()}activate(){}reset(){}isPingbackEnabled(){return this.Po.isPingbackEnabled()}pingbackReturnsAllEntitlements(){return this.Po.pingbackReturnsAllEntitlements()}pingback(t){this.Po.pingback(t)}getSupportedScoreFactor(t){return this.Po.getSupportedScoreFactor(t)}getBaseScore(){return 0}executeAction(t,s){return this.Po.executeAction(t,s)}decorateUI(t,s,i){return this.Po.decorateUI(t,s,i)}YPt(){this.cst.resetPlatforms()}}(this.ji,s,this.cst,t);this.zbt.resolvePlatform("local",i),this.BPt(i).then((t=>{v(t),this.GPt("local",t)})).catch((t=>{this.zbt.reportPlatformFailureAndFallback("local"),y().error(qt,"Viewer auth failed:",t)}))}}))}UPt(t=!0){const s=this.zbt.getGrantStatus(),i=this.zbt.getGrantEntitlement();return Promise.all([s,i]).then((s=>{const i=s[0],e=s[1],n=()=>this.qPt({granted:i,shouldActivatePlatform:t});if(!this.Gbt)return void n();const r=this.zbt.getPlatform(this.Gbt.platformKey);if(i){if(!e||e.grantReason!==gt||e.service!==this.Gbt.platformKey)return void n();const t=()=>{this.qPt({granted:!0,shouldActivatePlatform:!1})};r.activate(e,e,t)}else this.Gbt.entitlementsWereFetchedWithCurrentMeteringState?n():this.Gbt.loadMeteringState().then((t=>{if(t)this.resetPlatform(this.Gbt.platformKey);else{const t=_t.empty("local"),s=()=>this.UPt();r.activate(t,t,s)}}))}))}qPt({granted:t,shouldActivatePlatform:s}){this.KPt(t),this.Eyt(),s&&this.FPt()}FPt(){return Promise.all([this.zbt.getGrantStatus(),this.zbt.selectPlatform(),this.zbt.getGrantEntitlement()]).then((t=>{const s=t[1],i=t[2],e=this.zbt.getResolvedEntitlementFor(s.getPlatformKey()),n=i||e;s.activate(e,i),this.Jit.serviceEvent("subscriptions-service-activated",s.getPlatformKey()),this.Jit.serviceEvent("subscriptions-platform-activated",s.getPlatformKey()),n.granted?this.Jit.serviceEvent("subscriptions-access-granted",n.service):(this.Jit.serviceEvent("subscriptions-paywall-activated",s.getPlatformKey()),this.Jit.serviceEvent("subscriptions-access-denied",s.getPlatformKey()))}))}Eyt(){return this.Jbt?this.Jbt.then((()=>{this.zbt.getAvailablePlatforms().forEach((t=>{t.isPingbackEnabled()&&(t.pingbackReturnsAllEntitlements()?this.zbt.getAllPlatformsEntitlements().then((s=>t.pingback(s))):this.zbt.getGrantEntitlement().then((s=>t.pingback(s||_t.empty("local")))))}))})):null}resetPlatforms(){this.zbt=this.zbt.resetPlatformStore(),this.tp.toggleLoading(!0),this.Gbt&&(this.Gbt.entitlementsWereFetchedWithCurrentMeteringState=!1),this.zbt.getAvailablePlatforms().forEach((t=>{this.jPt(t)})),this.Jit.serviceEvent("subscriptions-service-re-authorized",""),this.Jit.serviceEvent("subscriptions-platform-re-authorized",""),this.UPt()}resetPlatform(t){this.tp.toggleLoading(!0),this.zbt.resetPlatform(t);const s=this.zbt.getPlatform(t);this.jPt(s),this.UPt()}delegateActionToLocal(t,s){return this.delegateActionToService(t,"local",s)}delegateActionToService(t,s,i=null){return new Promise((e=>{this.zbt.onPlatformResolves(s,(n=>{v(n),this.Jit.event("subscriptions-action-delegated",{"action":t,"serviceId":s},{"action":t,"status":tt}),e(n.executeAction(t,i))}))}))}decorateServiceAction(t,s,i,e){this.zbt.onPlatformResolves(s,(s=>{v(s),s.decorateUI(t,i,e)}))}JPt(t){this.WPt()&&t.resolveEntitlement("local",new _t({source:"",raw:"",granted:!0,grantReason:bt,dataObject:{}}))}WPt(){return!this.Fbt.isLocked()||this.$bt.alwaysGrant}zPt(){const{services:t}=this.$bt,s=t.find((t=>t.enableMetering));s&&(this.Gbt=new class{constructor({platformKey:t}){this.entitlementsWereFetchedWithCurrentMeteringState=!1,this.platformKey=t,this.Ryt=""}saveMeteringState(t){const s=JSON.stringify(t);return Promise.resolve(this.Ryt).then((t=>s!==t)).then((t=>{t&&(this.Ryt=s,this.entitlementsWereFetchedWithCurrentMeteringState=!1)}))}loadMeteringState(){return this.Ryt?Promise.resolve(JSON.parse(this.Ryt)):Promise.resolve(null)}}({platformKey:s.serviceId}))}}(t).start()}))})();
/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */}});
//# sourceMappingURL=amp-subscriptions-0.1.mjs.map